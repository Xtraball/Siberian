angular.module("starter").controller("RssListController",function($filter,$scope,$state,$stateParams,Rss,Pages){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id}),Rss.setValueId($stateParams.value_id),Rss.findAll().then(function(data){$scope.collection=data.collection,Rss.collection=angular.copy($scope.collection),data.cover&&Rss.collection.unshift(angular.copy(data.cover)),1===Pages.getLayoutIdForValueId(Rss.value_id)?($scope.cover=angular.copy(data.cover),$scope.page_title=angular.copy(data.page_title)):($scope.collection.unshift(angular.copy(data.cover)),$scope.collection_chunks=$filter("chunk")($scope.collection,2))}).then(function(){$scope.is_loading=!1}),$scope.showItem=function(item){$state.go("rss-view",{value_id:$scope.value_id,feed_id:item.id})}}).controller("RssViewController",function($rootScope,$scope,$stateParams,LinkService,Rss){angular.extend($scope,{is_loading:!1,value_id:$stateParams.value_id}),Rss.setValueId($stateParams.value_id),Rss.feed_id=$stateParams.feed_id,$scope.loadContent=function(){$scope.is_loading=!0,Rss.getFeed($stateParams.feed_id).then(function(feed){$scope.item=feed}).then(function(){$scope.is_loading=!1})},$scope.showItem=function(){$rootScope.isNotAvailableInOverview()||LinkService.openLink($scope.item.url)},$scope.loadContent()}),angular.module("starter").factory("Rss",function($pwaRequest){var factory={value_id:null,extendedOptions:{},collection:[],setValueId:function(value_id){factory.value_id=value_id},setExtendedOptions:function(options){factory.extendedOptions=options},preFetch:function(){factory.findAll()},findAll:function(){return this.value_id?$pwaRequest.get("rss/mobile_feed_list/findall",angular.extend({urlParams:{value_id:this.value_id}},factory.extendedOptions)):$pwaRequest.reject("[Factory::Rss.findAll] missing value_id")},find:function(feed_id){return this.value_id?$pwaRequest.get("rss/mobile_feed_view/find",{urlParams:{value_id:this.value_id,feed_id:feed_id}}):$pwaRequest.reject("[Factory::Rss.find] missing value_id")},getFeed:function(feed_id){if(!this.value_id)return $pwaRequest.reject("[Factory::Rss.getFeed] missing value_id");var feed=_.get(_.filter(factory.collection,function(item){return item.id==feed_id})[0],"embed_payload",!1);return feed?$pwaRequest.resolve(feed):factory.find(feed_id)}};return factory});