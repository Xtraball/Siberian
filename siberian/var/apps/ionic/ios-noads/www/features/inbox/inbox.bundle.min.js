angular.module('starter').controller('InboxListController',function($rootScope,$scope,$state,$stateParams,$timeout,Customer,Inbox,SB){angular.extend($scope,{value_id:Inbox.value_id,factory:Inbox,collection:[],can_load_older_posts:!0,is_logged_in:Customer.isLoggedIn(),pull_to_refresh:!1,module_code:'inbox'});Inbox.setValueId($stateParams.value_id);$scope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.is_logged_in=!0;$scope.loadContent(!1)});$scope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$scope.is_logged_in=!1;$scope.loadContent(!1)});$scope.login=function(scope){$rootScope.loginFeature=!0;Customer.loginModal(scope)};$scope.loadContent=function(loadMore){if(!Customer.isLoggedIn()){return}
$scope.is_loading=!0;Inbox.findAll($scope.collection.length,!0).then(function(data){Inbox.settings=data.settings;$scope.settings=Inbox.settings;$scope.page_title=data.page_title;$scope.collection=$scope.collection.concat(data.collection);$scope.can_load_older_posts=!!data.collection.length}).then(function(){if(loadMore){$scope.$broadcast('scroll.infiniteScrollComplete')}
$scope.is_loading=!1})};$scope.showItem=function(item){$state.go('inbox-view',{customer_message_id:item.customer_message_id,message_id:item.message_id,value_id:$scope.value_id})};$scope.refresh=function(){$scope.is_loading=!0;$scope.can_load_older_posts=!1;Inbox.findAll(0,!0).then(function(data){$scope.collection=data.collection;return data}).then(function(){$timeout(function(){$scope.can_load_older_posts=!!$scope.collection.length},1000);$scope.is_loading=!1})};$scope.loadContent(!1)});angular.module('starter').controller('InboxViewController',function($ionicHistory,$scope,$state,$stateParams,Dialog,Inbox){angular.extend($scope,{is_loading:!0,module_code:'inbox',settings:Inbox.settings,template_header:'features/inbox/assets/templates/l1/view/subheader.html',template_tabs:'features/inbox/assets/templates/l1/view/bottom_bar.html',footer_is_tabs:!0,message:{is_visible_in_editor:!0,is_visible_in_mobile:!0}});$scope.loadContent=function(refresh){if(refresh){$scope.is_loading=!0}
Inbox.findAll(0,refresh);Inbox.find($stateParams.message_id).then(function(data){$scope.message=data.item;$scope.blocks=data.blocks;$scope.page_title=data.page_title;$scope.icon_url=data.icon_url;$scope.delete_message=data.delete_message;$scope.title_delete_message=data.title_delete_message}).then(function(){$scope.is_loading=!1})};$scope.confirmDeleteMessage=function(){Dialog.confirm($scope.title_delete_message,$scope.delete_message,['YES','NO']).then(function(result){if(result){$scope.deleteMessage()}})};$scope.deleteMessage=function(){Inbox.deleteRootMessage($scope.message.message_id).then(function(){$ionicHistory.goBack()})};$scope.viewComments=function(){$state.go('inbox-comment-view',{message_id:$scope.message.message_id,value_id:$stateParams.value_id})};$scope.loadContent(!1)});angular.module('starter').controller('InboxCommentViewController',function($scope,$state,$stateParams,Application,Inbox){angular.extend($scope,{is_loading:!1,module_code:'inbox',settings:Inbox.settings,show_bottom_bar:!0,can_load_older_posts:!0,collection:[],app_name:Application.app_name});$scope.loadContent=function(){$scope.is_loading=!0;Inbox.findComments($stateParams.message_id).then(function(data){$scope.page_title=data.page_title;$scope.icon_url=data.icon_url;$scope.parent_is_deleted=data.parent_is_deleted;$scope.show_bottom_bar=!$scope.parent_is_deleted;$scope.collection=data.collection;return data}).then(function(){$scope.is_loading=!1})};$scope.gotToPost=function(){$state.go('inbox-comment-post',{message_id:$stateParams.message_id,value_id:$stateParams.value_id})};$scope.refresh=function(){$scope.loadContent()};$scope.loadContent()});angular.module('starter').controller('InboxCommentPostController',function($ionicHistory,$scope,$stateParams,Inbox,Loader){angular.extend($scope,{module_code:'inbox',settings:Inbox.settings,reply:{}});$scope.postComment=function(){if($scope.reply.message){Loader.show();var data_to_send={message_id:$stateParams.message_id,message:$scope.reply.message};Inbox.postComment(data_to_send).then(function(){Inbox.findComments($stateParams.message_id).then(function(){Loader.hide().then(function(){$ionicHistory.goBack()})})})}}});angular.module('starter').factory('Inbox',function($pwaRequest){var factory={value_id:null,displayed_per_page:null};factory.setValueId=function(valueId){factory.value_id=valueId};factory.findAll=function(offset,refresh){if(!this.value_id){return $pwaRequest.reject('Inbox::findAll missing value_id')}
var promise=$pwaRequest.get('inbox/mobile_list/findall',{urlParams:{value_id:this.value_id,offset:offset},cache:!refresh});promise.then(function(data){if(data.displayed_per_page){factory.displayed_per_page=data.displayed_per_page}
return data});return promise};factory.find=function(messageId){return $pwaRequest.get('inbox/mobile_view/find',{urlParams:{message_id:messageId}})};factory.deleteRootMessage=function(messageId){return $pwaRequest.get('inbox/mobile_view/deleterootmessage',{urlParams:{message_id:messageId}})};factory.findComments=function(messageId,offset){var promise=$pwaRequest.get('inbox/mobile_comment_view/find',{urlParams:{message_id:messageId,offset:offset},cache:!1});promise.then(function(data){if(data.displayed_per_page){factory.displayed_per_page=data.displayed_per_page}});return promise};factory.postComment=function(message){return $pwaRequest.post('inbox/mobile_comment_view/postcomment',{data:message})};return factory});Features.insertCSS("","inbox")