angular.module("starter").factory("Classifieds",function($q,$rootScope,$sbhttp,$translate,Url){var factory_datas={};var factory={};factory.EVENTS={ADS_UPDATED:"ADS_UPDATED"};factory.load=function(value_id,refresh){if(_.isObject(factory_datas[value_id])&&!refresh){factory.load(value_id,!0);return $q.resolve(factory_datas[value_id])}
return $sbhttp({method:"GET",url:Url.get("classifieds/mobile_application/load",{value_id:value_id}),cache:!$rootScope.isOverview&&!refresh,responseType:'json'}).then(function(req){if(_.isObject(req)&&_.isObject(req.data)){factory_datas[value_id]=req.data;return $q.resolve(req.data)}
return $q.reject(req.data)},function(err){if(!_.isObject(err)||!_.isObject(err.data)){if(!_.isObject(err.data)){err={error:!0,message:$translate.instant("An error occured.")}}else{err=err.data}}
return $q.reject(err)})};factory.save=function(value_id,ad){var q=$q.defer();$sbhttp({method:"POST",url:Url.get("classifieds/mobile_application/save",{value_id:value_id,item_id:ad.id}),cache:!1,responseType:'json',data:ad}).then(function(req){if(_.isObject(req)&&_.isObject(req.data)){if(_.isObject(req.data.ad)){if(_.isArray(_.get(factory_datas,"["+value_id+"].ads"))){var index=_.findIndex(factory_datas[value_id].ads,{id:req.data.ad.id});if(index>=0){factory_datas[value_id].ads[index]=req.data.ad}else{factory_datas[value_id].ads.push(req.data.ad)}}
$rootScope.$broadcast(factory.EVENTS.ADS_UPDATED);return q.resolve(req.data)}}
return q.reject(req.data)},function(err){return q.reject(_.get(err,"data",err))});return q.promise};factory.updateStatus=function(value_id,ad_id,status){var q=$q.defer();$sbhttp({method:"GET",url:Url.get("classifieds/mobile_application/updatestatus",{value_id:value_id,item_id:ad_id,status:status}),cache:!1,responseType:'json'}).then(function(req){if(_.isObject(req)&&_.isObject(req.data)){if(_.isObject(req.data.ad)){if(_.isArray(_.get(factory_datas,"["+value_id+"].ads"))){var index=_.findIndex(factory_datas[value_id].ads,{id:req.data.ad.id});if(index>=0){factory_datas[value_id].ads[index]=req.data.ad}else{factory_datas[value_id].ads.push(req.data.ad)}}
$rootScope.$broadcast(factory.EVENTS.ADS_UPDATED);return q.resolve(req.data)}}
return q.reject(req.data)},function(err){return q.reject(_.get(err,"data",err))});return q.promise};factory.updateBookmark=function(value_id,ad_id,bookmark){var q=$q.defer();$sbhttp({method:"GET",url:Url.get("classifieds/mobile_application/updatebookmark",{value_id:value_id,item_id:ad_id,bookmark:bookmark?1:0}),cache:!1,responseType:'json'}).then(function(req){if(_.isObject(req)&&_.isObject(req.data)){if(_.isObject(req.data.ad)){if(_.isArray(_.get(factory_datas,"["+value_id+"].ads"))){var index=_.findIndex(factory_datas[value_id].ads,{id:req.data.ad.id});if(index>=0){factory_datas[value_id].ads[index]=req.data.ad}else{factory_datas[value_id].ads.push(req.data.ad)}}
$rootScope.$broadcast(factory.EVENTS.ADS_UPDATED);return q.resolve(req.data)}}
return q.reject(req.data)},function(err){return q.reject(_.get(err,"data",err))});return q.promise};factory.flagAd=function(value_id,ad_id){var q=$q.defer();$sbhttp({method:"GET",url:Url.get("classifieds/mobile_application/flag",{value_id:value_id,item_id:ad_id}),cache:!1,responseType:'json'}).then(function(req){if(!!_.get(req,"data.success")){return q.resolve(req.data)}
return q.reject(_.get(req,"data"))},function(err){return q.reject(_.get(err,"data",err))});return q.promise};factory.contact=function(value_id,ad_id,message){var q=$q.defer();$sbhttp({method:"POST",url:Url.get("classifieds/mobile_application/contact",{value_id:value_id,item_id:ad_id}),cache:!1,responseType:'json',data:message}).then(function(req){if(_.isObject(req)&&_.isObject(req.data)&&req.data.success){return q.resolve(req.data)}
return q.reject(req.data)},function(err){return q.reject(_.get(err,"data",err))});return q.promise};return factory});angular.module("starter").controller("ClassifiedsIndexController",function($ionicHistory,$ionicModal,$q,$rootScope,$scope,$state,$stateParams,$timeout,$translate,Classifieds,Customer,Dialog,GoogleMaps,AUTH_EVENTS){var $value_id=$stateParams.value_id;var MAP_OPTIONS={zoom:3,center:{lat:0,lng:0},disableDefaultUI:!0};var CIRCLE_FILL_OPACITY=0.2;var CIRCLE_STROKE_OPACITY=0.4;var DEFAULT_ORDER_BY="date";var DEFAULT_ORDER_DIR="desc";var DEFAULT_ORDER=DEFAULT_ORDER_BY+"_"+DEFAULT_ORDER_DIR;init();angular.extend($scope,{showInfoWindow:!1,currentAd:null,filters:{latitude:0,longitude:0,}});$scope.reloadContent=function(use_cache){$scope.showInfoWindow=!1;$scope.currentAd=null;loadContent(use_cache).then(contentUpdated).finally(function(){$scope.is_loading=!1})};$scope.$on(AUTH_EVENTS.loginStatusChanged,function(){$scope.reloadContent(!1)});$scope.$on("$destroy",$rootScope.$on(Classifieds.EVENTS.ADS_UPDATED,function(){$scope.reloadContent(!1)}));$scope.searchViaEnter=function($event){if($event.keyCode===13){$timeout(function(){$event.target.blur()},0,!1);$scope.launchSearch()}};$scope.launchSearch=function(){$scope.search_expanded=!1;contentUpdated()};$scope.newEditAd=function(ad_id){ad_id=parseInt(ad_id,10);$state.go("classifieds-edit-item",{value_id:$value_id,item_id:isNaN(ad_id)?"new":ad_id})};function init(){$scope.my_shop_title=$translate.instant("My shop");$scope.first_load=!0;$scope.is_loading=!0;$scope.search_expanded=!1;$scope.search_options=cleaned_search_options();$scope.circleOpacity=function(){$scope.circleOpacityTimer=$timeout(function(){if(_.isObject($scope.map)&&_.isObject($scope.mapCircle)&&_.isFunction($scope.mapCircle.getBounds)&&_.isFunction($scope.map.getBounds)){var circleb=$scope.mapCircle.getBounds();var mapb=$scope.map.getBounds();var fillOpacity=$scope.mapCircle.get("fillOpacity");if(_.isObject(circleb)&&_.isObject(mapb)){if(circleb.contains(mapb.getNorthEast())&&circleb.contains(mapb.getSouthWest())){fillOpacity=fillOpacity-0.05}else{fillOpacity=fillOpacity+0.05}
fillOpacity=Math.max(Math.min(fillOpacity,CIRCLE_FILL_OPACITY),0.05);$scope.mapCircle.setOptions({fillOpacity:fillOpacity})}}
$scope.circleOpacity()},100)};$scope.$on("$destroy",function(){$timeout.cancel($scope.circleOpacityTimer)});$scope.circleOpacity();$scope.search_options.queryProxy=function(val){if($scope.search_expanded){if(_.isString(val)){$scope.search_options.query=val}
return $scope.search_options.query}else{var opts=cleaned_search_options();var query=_.trim(opts.query);if(opts.min_price>0){query+=" "+$translate.instant("min: %s").replace("%s",opts.min_price)}
if(opts.max_price>0){query+=" "+$translate.instant("max: %s").replace("%s",opts.max_price)}
if(opts.zip){query+=" "+$translate.instant("zip: %s").replace("%s",opts.zip)}
var withs=[];if(opts.with.pictures)withs.push($translate.instant("pictures"));if(opts.with.phone)withs.push($translate.instant("phone"));if(opts.with.address)withs.push($translate.instant("address"));if(withs.length>0){query+=" "+$translate.instant("with: %s").replace("%s",withs.join(","))}
if(opts.order!=DEFAULT_ORDER){query+=" "+$translate.instant("order: %s").replace("%s",$translate.instant(opts.order))}
if(opts.category){var s={id:opts.category};var cat=_.get((_.find($scope.categories,s)||_.find(_.flatten(_.map($scope.categories,"children")),s)),"name");if(cat){query+=" "+$translate.instant("category: %s").replace("%s",cat)}}
if(opts.bookmarks_only){query+=" "+$translate.instant("#bookmarked")}
return _.trim(query)}};$scope.current_view='map';$scope.updateMax=function(){$timeout(function(){if((+$scope.search_options.min_price||0)>0&&(+$scope.search_options.max_price||0)!==0&&(+$scope.search_options.max_price||0)<=(+$scope.search_options.min_price||0)){$scope.search_options.max_price=((+$scope.search_options.min_price||0)+1)}
if((+$scope.search_options.max_price||0)===0){$scope.search_options.max_price=null}})};$scope.centerMap=function(){$scope.gps_loading=!0;GoogleMaps.setCenter().then(function(){console.log.apply(console,arguments);$scope.map.setZoom(17)},function(){Dialog.alert($translate.instant("Error"),$translate.instant("Could not find your current location"));console.error.apply(console,arguments)}).finally(function(){$scope.gps_loading=!1})};loadContent(!1).then(function(){$scope.current_view=(!$scope.settings.showMap||$scope.settings.defaultView=="list"?"list":"map")},function(data){if(_.isObject(data)&&_.isString(data.message)){Dialog.alert($translate.instant("Error"),data.message)}
$ionicHistory.goBack()}).then(contentUpdated).finally(function(){$scope.is_loading=!1;$scope.first_load=!1})}
function loadContent(use_cache){$scope.is_loading=!0;$scope.filtered_ads=$scope.all_ads=[];return $q(function(resolve,reject){Classifieds.load($value_id,!use_cache).then(function(data){$scope.page_title=data.page_title;$scope.all_ads=data.ads;$scope.categories=data.categories;$scope.settings=data.settings;resetMarkers();if($scope.settings.showMap&&!$scope.map){$scope.markers=[]}else if(!$scope.settings.showMap){$scope.map=null;$scope.markers=null;$scope.current_view="list"}
resolve()},reject)})}
function contentUpdated(){$scope.my_shop_view=$scope.my_shop_view&&(Customer.id>0);filter_ads();if($scope.settings.showMap){$timeout(function(){if($scope.map){showAdsOnMap()}else{$timeout(function(){GoogleMaps.addCallback(function(){$scope.map=GoogleMaps.createMap('map',MAP_OPTIONS);$timeout(function(){showAdsOnMap()},300)})},$scope.first_load?700:0)}})}}
$scope.toggleMyStore=function(){var val=!$scope.my_shop_view;if(val&&Customer.id<1){return Customer.loginModal()}
$scope.my_shop_view=val;return contentUpdated()};$scope.hideInfoWindow=function(){$scope.showInfoWindow=!1};$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){if(toState.name=="classifieds"&&!(/^classifieds/.test(fromState.name))){$scope.my_shop_view=!1;$timeout(function(){$scope.reloadContent(!1)},250)}});function filter_ads(){if($scope.my_shop_view){$scope.filtered_ads=_.orderBy(_.filter($scope.all_ads,{mine:!0}),["created_at_utc"],["desc"])}else{var ads=_.filter($scope.all_ads,{status:"published"});var so=_(cleaned_search_options());var order=so.get("order");var order_by=so.get("order_by");var order_dir=so.get("order_dir");$scope.filtered_ads=_.orderBy(_.filter(ads,function(ad){var show_ad=!0;function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}
if(show_ad&&so.get("query")){var matcher=([ad.title,ad.description].join(" "));show_ad=_.reduce(so.get("query").split(" "),function(show_ad,q){q=_.trim(q);return show_ad&&(q.length===0||(new RegExp(escapeRegExp(q),"i")).test(matcher))},show_ad)}
if(show_ad&&so.get("bookmarks_only")){show_ad=ad.bookmarked}
if(show_ad&&so.get("min_price")){show_ad=(ad.price>=so.get("min_price"))}
if(show_ad&&so.get("max_price")){show_ad=(ad.price<=+so.get("max_price"))}
if(show_ad&&so.get("zip")){show_ad=(ad.zipcode.indexOf(_.trim(so.get("zip")))===0)}
if(show_ad&&so.get("with.pictures")){show_ad=(_.isArray(ad.pictures)&&ad.pictures.length>0)}
if(show_ad&&so.get("with.phone")){show_ad=(_.trim(ad.phone).length>0)}
if(show_ad&&so.get("with.address")){show_ad=(_.trim(ad.address).length>0)}
if(show_ad&&so.get("category")){show_ad=(ad.category_id==so.get("category")||ad.parent_category_id==so.get("category"))}
return show_ad}),[order_by.replace("date","created_at_utc")],[order_dir])}}
function resetMarkers(){_.forEach($scope.markers,function(marker){GoogleMaps.removeMarker(marker)});$scope.markers=[]}
function showAdsOnMap(ads){if(_.isObject($scope.mapCircle)&&_.isFunction($scope.mapCircle.setMap)){$scope.mapCircle.setVisible(!1);$scope.mapCircle.setMap(null);$scope.mapCircle=null}
$scope.map.setCenter($scope.settings.center);$scope.mapCircle=new google.maps.Circle({map:$scope.map,radius:$scope.settings.radius});$scope.mapCircle.setCenter($scope.settings.center);$scope.mapCircle.setOptions({fillOpacity:CIRCLE_FILL_OPACITY,strokeOpacity:CIRCLE_STROKE_OPACITY,strokeWeight:1,fillColor:"#4169e1",strokeColor:"#0432ff"});$scope.map.fitBounds($scope.mapCircle.getBounds());resetMarkers();_.forEach($scope.filtered_ads,function(ad){if(ad.position){var marker={latitude:ad.position.latitude,longitude:ad.position.longitude,config:{id:angular.copy(ad.id),ad:angular.copy(ad)},onClick:(function(marker){$timeout(function(){$scope.showInfoWindow=!0;$scope.currentAd=marker.config.ad})})};$scope.markers.push(GoogleMaps.addMarker(marker))}})}
$scope.adPicture=function(ad){var picSrc=_.isArray(ad.pictures)&&ad.pictures.length>0&&_.trim(_.get(ad.pictures[0],"url",""));if(picSrc.length>0){return picSrc}
return!1};$scope.showAd=function(ad){$state.go("classifieds-view-item",{value_id:$value_id,item_id:ad.id})};function cleaned_search_options(){var options={query:null,min_price:null,max_price:null,zip:null,bookmarks_only:null,with:{pictures:null,phone:null,address:null},category:null,order:DEFAULT_ORDER};if(!_.isObject($scope.search_options)){$scope.search_options={}}
if(!_.isObject($scope.search_options.with)){$scope.search_options.with={}}
var so=_($scope.search_options);var query=_.trim(so.get("query"));if(query.length>0){options.query=query}
var min_price=+so.get("min_price");if(!isNaN(min_price)&&min_price>0){options.min_price=min_price}
var max_price=+so.get("max_price");if(!isNaN(max_price)&&max_price>0){options.max_price=max_price}
var zip=_.trim(so.get("zip"));if(zip.length>0){options.zip=zip}
options.bookmarks_only=so.get("bookmarks_only")||null;options.with.pictures=so.get("with.pictures")||null;options.with.address=so.get("with.address")||null;options.with.phone=so.get("with.phone")||null;var category=+so.get("category");if(!isNaN(category)&&category>0){options.category=category}
var order=_.trim(so.get("order")).match(/^(price|date)_(asc|desc)/);options.order_by=_.get(order,"[1]",DEFAULT_ORDER_BY);options.order_dir=_.get(order,"[2]",DEFAULT_ORDER_DIR);options.order=options.order_by+"_"+options.order_dir;return options}});angular.module("starter").controller("ClassifiedsEditController",function($cordovaCamera,$ionicActionSheet,$ionicHistory,$ionicPopup,$q,$scope,$state,$stateParams,$timeout,$translate,Application,Classifieds,Dialog,GoogleMaps){var $value_id=+$stateParams.value_id;var $advert_id=+$stateParams.item_id;$scope.ad={};$scope.location={};init();function init(){$timeout(function(){$scope.is_loading=!0});Classifieds.load($value_id,!1).then(function(data){$scope.settings=data.settings;$scope.categories=data.categories;$scope.ad=_.find(data.ads,{id:$advert_id})||{email:data.customer_email,phone:data.customer_phone};if(!isNaN($scope.ad.category_id)&&$scope.ad.category_id>0){$scope.ad.category_id=""+(+$scope.ad.category_id)}
if(_.isObject($scope.ad.location)){$scope.ad.address_lat=$scope.ad.location.latitude;$scope.ad.address_lng=$scope.ad.location.longitude}
$scope.ad.description=_.trim(_.get($scope.ad,"description","")).replace(/<br>/g,"\r\n")},function(data){if(_.isObject(data)&&_.isString(data.message)){Dialog.alert("Error",data.message)}
$ionicHistory.goBack()}).finally(function(){$timeout(function(){$scope.is_loading=!1})})}
$scope.disableTap=function(){var container=document.getElementsByClassName('pac-container');angular.element(container).attr('data-tap-disabled','true');angular.element(container).on("click",function(){$timeout(function(){document.getElementById('pac-input').blur()},100)})};$scope.updateAddress=function(){$scope.ad.address_lat=$scope.ad.address_lng=null;$scope.ad.zipcode=null;if(_.isObject($scope.ad.place)){var loc=_.get($scope.ad,"place.geometry.location");if(loc){$scope.ad.address_lat=loc.lat();$scope.ad.address_lng=loc.lng();_.forEach(_.get($scope.ad.place,"address_components"),function(adco){if(_.includes(_.get(adco,"types")||[],"postal_code")){$scope.ad.zipcode=_.get(adco,"long_name")}
if(_.includes(_.get(adco,"types")||[],"country")){$scope.ad.country=_.get(adco,"short_name")}})}}};$scope.save=function(){$scope.is_loading=!0;var advert=angular.copy($scope.ad);advert.pictures=_.filter(_.map(_.get($scope.ad,"pictures",[]),function(pic){if(pic.id){pic.data=null;delete pic.data}
return pic}),function(pic){return _.isObject(pic)&&(!pic.remove||(pic.remove&&pic.id))});Classifieds.save($value_id,advert).then(function(){Dialog.alert($translate.instant("Saved!"),$translate.instant("Ad has been saved successfully"));$ionicHistory.goBack()},function(data){if(_.isArray(_.get(data,"errors"))){Dialog.alert($translate.instant("Error"),$translate.instant("Some errors prevent this ad to be saved:")+"<br /> - "+data.errors.join("<br /> - "))}else{Dialog.alert($translate.instant("Error"),$translate.instant("An unexpected error prevent this ad to be saved!"))}}).finally(function(){$scope.is_loading=!1})};$scope.canAddPicture=function(){return _.reject(_.get($scope.ad,"pictures",[]),{remove:!0}).length<3};$scope.addPicture=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant('Cancel'),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK'),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){if(!_.isArray($scope.ad.pictures))
$scope.ad.pictures=[];$scope.ad.pictures.push({id:null,data:image_url})}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture")},{text:$translate.instant("Import from Library")}],cancelText:$translate.instant("Cancel"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}}});angular.module("starter").controller("ClassifiedsViewController",function($cordovaCamera,$cordovaSocialSharing,$ionicHistory,$ionicLoading,$ionicModal,$ionicPopup,$q,$rootScope,$scope,$state,$stateParams,$timeout,$translate,Application,Customer,Classifieds,Dialog,GoogleMaps,AUTH_EVENTS){var $value_id=+$stateParams.value_id;var $advert_id=+$stateParams.item_id;$scope.ad={};loadData();function errorGoBack(error){Dialog.alert("Error",error);$ionicHistory.goBack()}
function loadData(){$scope.is_loading=!0;$scope.loggedIn=(Customer.id>0);Classifieds.load($value_id,!1).then(function(data){$scope.social_sharing_active=data.social_sharing_active;$scope.ad=_.find(data.ads,{id:$advert_id})||{};$scope.flagged_from_here=(window.localStorage.getItem("flagged_ad_"+$scope.ad.id)==1);if(isNaN(+$scope.ad.id)||+$scope.ad.id<1){errorGoBack()}else{$scope.adblocks={title:{content:$scope.ad.title},description:{content:'<div style="font-weight: bold; text-align: right; float: right; margin: 2px 10px;">'+$scope.ad.formatted_price+'</div>'+'<p>'+$scope.ad.description+'</p>'}};if($scope.ad.pictures.length>0){$scope.adblocks.gallery=_.map($scope.ad.pictures,function(pic){return{src:pic.url}});$scope.adblocks.pictures={gallery:$scope.adblocks.gallery}}
$scope.adblocks.address={label:$scope.ad.title,address:$scope.ad.address,show_address:!1,latitude:$scope.ad.address_lat,longitude:$scope.ad.address_lng,show_geolocation_button:!0,show_website:!1,website:"",show_phone:!1,phone:$scope.ad.phone,};if(!$scope.ad.hide_address){$scope.adblocks.address.show_address=!0}
if(!$scope.ad.hide_phone&&$scope.ad.phone.length>1){$scope.adblocks.address.show_phone=!0}
$scope.adblocks.status={content:"<strong>"+$translate.instant("Status:")+"</strong> "+$translate.instant($scope.ad.formatted_status)}}},function(data){errorGoBack(_.get(data,"message"))}).finally(function(){$scope.is_loading=!1})}
$scope.editAd=function(ad_id){ad_id=parseInt(ad_id,10);$state.go("classifieds-edit-item",{value_id:$value_id,item_id:ad_id})};$scope.updateStatus=function(ad_id,status){$ionicPopup.confirm({title:$translate.instant("Change status"),cssClass:"classifieds",template:$translate.instant("Are you sure you want to change the status of this ad?"),cancelText:$translate.instant("Cancel"),okText:$translate.instant("OK")}).then(function(res){if(res){$ionicLoading.show({template:"<ion-spinner class='spinner-custom'></ion-spinner>"});var handleError=function(data){if(!_.isObject(data)||!_.isString(data.message)){data={message:$translate.instant("An unkown error occured")}}
Dialog.alert($translate.instant("Error"),data.message)};Classifieds.updateStatus($value_id,ad_id,status).then(function(data){if(_.isObject(data)&&data.success){Dialog.alert($translate.instant("Success"),$translate.instant("Status changed successfully"));loadData()}else{handleError(data)}},handleError).finally(function(){$ionicLoading.hide()})}})};var toggleBookmark=function(bookmark,ad_id){$ionicLoading.show({template:"<ion-spinner class='spinner-custom'></ion-spinner>"});var handleError=function(data){if(!_.isObject(data)||!_.isString(data.message)){data={message:$translate.instant("An unkown error occured")}}
Dialog.alert($translate.instant("Error"),data.message)};Classifieds.updateBookmark($value_id,ad_id,bookmark).then(null,handleError).finally(function(){$ionicLoading.hide()})};$scope.bookmarkAd=toggleBookmark.bind($scope,!0);$scope.unbookmarkAd=toggleBookmark.bind($scope,!1);$scope.flagAd=function(ad_id){$ionicLoading.show({template:"<ion-spinner class='spinner-custom'></ion-spinner>"});Classifieds.flagAd($value_id,ad_id).then(function(){window.localStorage.setItem("flagged_ad_"+ad_id,"1");$scope.flagged_from_here=!0;Dialog.alert($translate.instant("Flagged"),"Successfully flagged as inappropriate!")},function(data){if(!_.isObject(data)||!_.isString(data.message)){data={message:$translate.instant("An unkown error occured")}}
Dialog.alert($translate.instant("Error"),data.message)}).finally(function(){$ionicLoading.hide()})};$scope.share=function(){if($scope.is_sharing)return;$scope.is_sharing=!0;var app_name=Application.app_name;var link=DOMAIN+"/application/device/downloadapp/app_id/"+Application.app_id;var subject="";var file="";var content=$scope.ad.title;var message=$translate.instant("Hi. I just found: $1 for $2 in the $3 app.").replace("$1",$scope.ad.title).replace("$2",$scope.ad.formatted_price).replace("$3",app_name);$cordovaSocialSharing.share(message,subject,file,link).then(function(result){$scope.is_sharing=!1},function(err){console.log(err);$scope.is_sharing=!1})};$scope.contact=function(ad_id){if($scope.contactModal)return;$scope.contactModal=!0;var scope=$scope.$new();scope.message={};scope.$close=function(){if(_.isObject($scope.contactModal)){$scope.contactModal.hide()}};scope.send=function(){$ionicLoading.show({template:"<ion-spinner class='spinner-custom'></ion-spinner>"});Classifieds.contact($value_id,ad_id,scope.message).then(function(data){scope.$close();Dialog.alert($translate.instant("Sent!"),$translate.instant("Your message has been sent successfully!"))},function(data){if(!_.isObject(data)||!_.isString(data.message)){data={message:$translate.instant("An unkown error occured")}}
Dialog.alert($translate.instant("Error"),data.message)}).finally(function(){$ionicLoading.hide()})};scope.$on("modal.hidden",function(event,modal){if(modal===$scope.contactModal){$scope.contactModal=!1;try{modal.remove()}catch(e){}}});$ionicModal.fromTemplateUrl('features/classifieds/assets/templates/modals/contact.html',{scope:scope,animation:'slide-in-up'}).then(function(modal){$scope.contactModal=modal;$scope.contactModal.show()})};$scope.$on(AUTH_EVENTS.loginStatusChanged,loadData);$scope.$on("$destroy",$rootScope.$on(Classifieds.EVENTS.ADS_UPDATED,function(){loadData()}))});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.classifieds .ng-hide-animate,.classifieds.ng-hide-animate,.classifieds .ng-hide,.classifieds.ng-hide{-webkit-transition:none!important;transition:none!important;-webkit-animation:none 0;animation:none 0}#classifieds_subheader .ng-hide-animate,#classifieds_subheader.ng-hide-animate,#classifieds_subheader .ng-hide,#classifieds_subheader.ng-hide{-webkit-transition:none!important;transition:none!important;-webkit-animation:none 0;animation:none 0}#classifieds_footer .ng-hide-animate,#classifieds_footer.ng-hide-animate,#classifieds_footer .ng-hide,#classifieds_footer.ng-hide{-webkit-transition:none!important;transition:none!important;-webkit-animation:none 0;animation:none 0}.classifieds .fab{border:none;font-size:1.5em;border-radius:50%;width:50px;height:50px;margin:auto;-webkit-box-shadow:2px 3px 3px 0 rgba(41,41,41,.3);-moz-box-shadow:2px 3px 3px 0 rgba(41,41,41,.3);box-shadow:2px 3px 3px 0 rgba(41,41,41,.3);position:absolute;bottom:20px;right:20px}.classifieds .fab ion-spinner>svg{margin-top:11px}.classifieds #mapContainer{position:absolute;left:0;top:0;width:100%;height:100%}.classifieds #map{position:absolute;left:0;top:0;width:100%;height:100%}.classifieds #map .button{min-height:24px;max-height:24px;padding:5px;line-height:14px;font-size:12px!important}#classifieds_subheader{height:50px;border-top-color:transparent;flex-wrap:wrap;justify-content:flex-start;align-content:flex-start;align-items:flex-start;padding-top:9px;top:44px;transition:height 0.28s ease 0.035s}#classifieds_subheader .buttons-right{margin-top:-2px;margin-left:12px;opacity:1;transition:opacity 0.375s,margin-right 0.45s}#classifieds_subheader .buttons-right .icon{margin:-7px}#classifieds_subheader .buttons-right .icon:before{line-height:29px!important;margin-left:-2px}#classifieds_subheader .buttons-right .button-bar .button:first-child{border-radius:4px 0 0 4px}#classifieds_subheader .buttons-right .button-bar .button:last-child{border-radius:0 4px 4px 0}.platform-ios.platform-cordova:not(.fullscreen) #classifieds_subheader{top:64px}#classifieds_subheader.expanded{top:0;height:100%;padding-top:53px;padding-bottom:39px;transition-delay:0}.platform-ios.platform-cordova:not(.fullscreen) #classifieds_subheader.expanded{top:0;padding-top:73px;padding-bottom:40px}#classifieds_subheader .item-input-wrapper{width:100%;transition:width 0.3s}#classifieds_subheader.expanded .buttons-right{opacity:0;margin-right:-80px}#classifieds_subheader form{width:100%}#classifieds_subheader .search_row{width:100%;opacity:0;transition:opacity 0.3s ease 0.05s;margin-left:0;margin-top:15px;margin-bottom:0}#classifieds_subheader ion-content{height:calc(100vh - 100px);width:100vw;margin-top:46px;margin-bottom:100px}#classifieds_subheader.expanded .search_row{opacity:1}#classifieds_subheader #search_filters{flex-wrap:wrap;display:flex}#classifieds_subheader #search_filters label{font-weight:500}#classifieds_subheader #search_filters .item{width:150px;flex-grow:1}#classifieds_footer .button.small{max-width:32px;padding:1px 6px}#classifieds_footer .button .icon:before,#classifieds_footer .button:before{line-height:31px!important;padding-left:0!important}#classifieds_subheader #search_filters .item input:not([type=\"radio\"]):not([type=\"checkbox\"]),#classifieds_subheader #search_filters .item select{width:100%}#classifieds_subheader #search_filters .full-width{width:100%}#classifieds_subheader #search_filters #withs{display:flex;flex-wrap:wrap}#classifieds_subheader #search_filters #withs label.with{font-weight:400;display:block;padding:10px;line-height:20px;flex-grow:1}.platform-android #classifieds_subheader #search_filters #withs label input,.platform-ios #classifieds_subheader #search_filters #withs label input,.platform-android #classifieds_subheader #bookmarked_ads,.platform-ios #classifieds_subheader #bookmarked_ads{vertical-align:bottom;width:25px;height:25px}#classifieds_subheader #search_filters #withs label input,#classifieds_subheader #bookmarked_ads{margin-bottom:-3px;margin-right:3px}#classifieds_footer{transition:bottom 0.1s}#classifieds_footer.search_expanded{bottom:-45px;transition:bottom 0.1s ease 0.2s}@media screen and (orientation:portrait){.classifieds .info-window{width:100vw;position:absolute;bottom:0;padding:0 2vw}}@media screen and (orientation:landscape){.classifieds{}.classifieds .info-window{width:50vw;position:absolute;bottom:0;left:0;padding:0 2vw}.classifieds .info-window .ad-picture{display:none}}.classifieds .info-window .item{padding-top:10px;padding-bottom:10px;margin:-1px 0!important;border-top:0;border-bottom:0}.classifieds .info-window .info-window-icon{padding:10px;border-bottom:0}.classifieds .info-window .info-window-icon span{font-size:.85rem;font-weight:700;width:85%;display:inline-block}.classifieds .info-window .info-window-icon span.info-window-title{padding-left:8px;padding-bottom:6px}.classifieds .info-window .info-window-icon span.info-window-more,.classifieds .info-window .info-window-icon span.info-window-distance{font-size:.7rem;width:auto}.classifieds .info-window .info-window-icon span.info-window-distance{padding-left:8px}.classifieds .info-window .info-window-icon i.info-close{position:absolute;right:10px;top:8px}.classifieds .sb-cms-address-label{display:none!important}.classifieds .sb-cms-block-address .item{border-top:0!important;border-bottom:0!important;margin:0!important}.classifieds .sb-cms-block-address .item a,.classifieds .sb-cms-block-address .item p{font-size:0.9rem!important;line-height:1.2rem!important;text-decoration:none!important}.classifieds .sb-cms-block-address .item i.icon{font-size:1.25rem!important;opacity:0.75!important}.classifieds .block-email .item{border-top:0!important;border-bottom:0!important;margin:0!important}.classifieds .block-email .item a,.classifieds .block-email .item p{font-size:0.9rem!important;line-height:1.2rem!important;text-decoration:none!important}.classifieds .block-email .item i.icon{font-size:1.25rem!important;opacity:0.75!important}","classifieds")