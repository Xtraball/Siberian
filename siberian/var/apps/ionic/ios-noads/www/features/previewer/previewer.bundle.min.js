angular.module('starter').controller('PreviewerListController',function($rootScope,$scope,$stateParams,$state,$timeout,$window,Customer,Dialog,Previewer,AUTH_EVENTS){angular.extend($scope,{isLoading:!0,isLoggedIn:Customer.isLoggedIn(),cardDesign:!1,collection:[],search:{searchValue:''},imagePath:function(path){return IMAGE_URL+path}});Previewer.setValueId($stateParams.value_id);$scope.$on(AUTH_EVENTS.loginSuccess,function(){$scope.isLoggedIn=!0;$scope.loadContent()});$scope.$on(AUTH_EVENTS.logoutSuccess,function(){$scope.isLoggedIn=!1;$scope.loadContent()});$scope.login=function(){$rootScope.loginFeature=!0;Customer.loginModal($scope)};$scope.resetSearch=function(){$timeout(function(){$scope.search.searchValue=''})};$scope.loadContent=function(){if(!$scope.isLoggedIn){$scope.isLoading=!1;return}
Previewer.findall().then(function(result){$scope.collection=result.collection;$scope.cardDesign=result.cardDesign;$scope.pageTitle=result.pageTitle},function(error){Dialog.alert('Error',error.message,'OK')}).then(function(){$scope.isLoading=!1})};$scope.openApp=function(app){if($rootScope.isNotAvailableInOverview()){return}
if(app.key==='__stats__'){return}
Previewer.loadApp(app)};$scope.toggleStarred=function(event,app){event.stopPropagation();$timeout(function(){app.starred=!app.starred});Previewer.toggleStarred(app.id)};$scope.loadContent()});angular.module("starter").factory("Previewer",function($pwaRequest,$window,$timeout,$q){var factory={value_id:null,currentApp:null,devicePath:cordova.file.dataDirectory,directoryEntry:$q.defer()};factory.setValueId=function(valueId){factory.value_id=valueId};factory.findall=function(){return $pwaRequest.get("previewer/mobile_list/findall",{urlParams:{value_id:factory.value_id}})};factory.toggleStarred=function(appId){return $pwaRequest.post("previewer/mobile_list/togglestarred",{urlParams:{value_id:factory.value_id,appId:appId}})};factory.setDevicePath=function(){if(DEVICE_TYPE===1){factory.devicePath=cordova.file.dataDirectory}else if(DEVICE_TYPE===3){factory.devicePath=cordova.file.cacheDirectory}else{factory.devicePath=cordova.file.tempDirectory}
$window.resolveLocalFileSystemURL(factory.devicePath,function(directoryEntry){factory.directoryEntry.resolve(directoryEntry)})};factory.onError=function(error){console.error(error)};factory.readFile=function(fileEntry){if(DEBUG){fileEntry.file(function(file){var reader=new FileReader();reader.onloadend=function(){console.log("Successful file read: "+this.result)};reader.readAsText(file)},factory.onError)}};factory.writeFile=function(fileEntry,dataObj,callbackSuccess){fileEntry.createWriter(function(fileWriter){fileWriter.onwriteend=function(){factory.readFile(fileEntry);callbackSuccess()};fileWriter.onerror=function(e){factory.onError(e)};var _dataObj=new Blob([dataObj],{type:"text/plain"});fileWriter.write(_dataObj)})};factory.writeModuleFile=function(content,callbackSuccess){factory.directoryEntry.promise.then(function(_directoryEntry){_directoryEntry.getFile("module.js",{create:!0,exclusive:!1},function(fileEntry){factory.writeFile(fileEntry,content,callbackSuccess)},factory.onError)})};factory.fileExists=function(callbackExists,callbackMissing){factory.directoryEntry.promise.then(function(_directoryEntry){_directoryEntry.getFile("module.js",{create:!1},function(fileEntry){if(typeof callbackExists==="function"){callbackExists(fileEntry)}},function(error){if(typeof callbackMissing==="function"){callbackMissing(error)}})})};factory.deleteFile=function(callback){if(typeof callback!=="function"){callback=function(){}}
factory.directoryEntry.promise.then(function(_directoryEntry){_directoryEntry.getFile("module.js",{create:!1},function(fileEntry){fileEntry.remove(callback,callback,callback)},callback)})};factory._loadApp=function(callbackSuccess){var content="IS_PREVIEW = true;"+"DOMAIN = '"+factory.currentApp.domain+"';"+"APP_KEY = '"+factory.currentApp.key+"';"+"PREVIEW_SPLASH = '"+factory.currentApp.domain+factory.currentApp.splashscreen+"';"+"BASE_PATH = '/' + APP_KEY;";factory.writeModuleFile(content,callbackSuccess)};factory.loadApp=function(app){$timeout(function(){factory.currentApp=app},1);$window.webview.subscribeCallback(function(){factory.deleteFile()},function(){factory.deleteFile()});factory.deleteFile(function(){factory._loadApp(function(){$timeout(function(){$window.webview.loadApp()},20)})})};factory.setDevicePath();return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.module-previewer .previewer2-search .clear-search{margin-right:6px;border:0;background:transparent;position:absolute;right:0;z-index:5000;top:14px}.module-previewer.previewer-list p{font-weight:700}.module-previewer.previewer-list .star-right{position:absolute;right:0;transform:translateY(-50%);top:50%;font-size:28px!important;padding:20px}.module-previewer.previewer-list .star-grey{color:lightgrey}.module-previewer.previewer-list .star-gold{color:#d4be01!important}.module-previewer.previewer-list i.icon{font-size:17px}.module-previewer.previewer-list i.icon:before{transform:translateY(1px)}.previewer-load{display:block!important}","previewer")