angular.module("starter").service("AdmobService",function($log,$rootScope,$window){var service={interstitialWeights:{start:{show:.333,skip:.667},low:{show:.025,skip:.975},default:{show:.06,skip:.94},medium:{show:.125,skip:.875}},interstitialState:"start",viewEnterCount:0,getWeight:function(probs){var random=_.random(0,1e3),offset=0,keyUsed="app",match=!1;return _.forEach(probs,function(value,key){offset+=1e3*value,!match&&random<=offset&&(keyUsed=key,match=!0)}),$log.debug("AdMob key used: ",keyUsed),keyUsed},init:function(options){if($rootScope.isNativeApp&&$window.AdMob){var _options={};ionic.Platform.isIOS()&&($log.debug("AdMob init iOS"),_options=options[service.getWeight(options.ios_weight)].ios,service.initWithOptions(_options)),ionic.Platform.isAndroid()&&($log.debug("AdMob init Android"),_options=options[service.getWeight(options.android_weight)].android,service.initWithOptions(_options))}},initWithOptions:function(options){options.banner&&$window.AdMob.createBanner({adId:options.banner_id,adSize:"SMART_BANNER",position:$window.AdMob.AD_POSITION.BOTTOM_CENTER,autoShow:!0}),options.interstitial&&($window.AdMob.prepareInterstitial({adId:options.interstitial_id,autoShow:!1}),$rootScope.$on("$ionicView.enter",function(){service.viewEnterCount=service.viewEnterCount+1,service.viewEnterCount>=12&&(service.interstitialState="medium"),"show"===service.getWeight(service.interstitialWeights[service.interstitialState])&&($window.AdMob.showInterstitial(),$window.AdMob.prepareInterstitial({adId:options.interstitial_id,autoShow:!1}),"start"===service.interstitialState?service.interstitialState="low":service.interstitialState="default",service.viewEnterCount=0)}))}};return service}),angular.module("starter").service("Analytics",function($pwaRequest,$q,$rootScope,$log){var service={data:{},storeInstallation:function(){var params={OS:device.platform,OSVersion:device.version,Device:device.platform,DeviceVersion:device.model,deviceUUID:device.uuid,latitude:null,longitude:null};service.postData("analytics/mobile_store/installation",params)},storeOpening:function(){var deferred=$q.defer(),params={OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};return service.postData("analytics/mobile_store/opening",params).then(function(result){deferred.resolve(result)}).catch(function(error){deferred.reject()}),deferred.promise},storeClosing:function(){if(void 0!==service.data.storeClosingId){var params={id:service.data.storeClosingId};service.postData("analytics/mobile_store/closing",params)}else $log.debug("aborting /analytics/mobile_store/closing, no id.")},storePageOpening:function(page){var params={featureId:page.value_id,OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};service.postData("analytics/mobile_store/pageopening",params)},storeProductOpening:function(product){var params={productId:product.id,name:product.name,OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};service.postData("analytics/mobile_store/productopening",params)},storeProductSold:function(products){var params={products:products,OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};service.postData("analytics/mobile_store/productsold",params)},postData:function(url,params){return isOverview?$pwaRequest.reject("Analytics are disabled in Overview!"):$pwaRequest.post(url,{data:params,cache:!1,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}};return service}),angular.module("starter").service("Application",function($pwaRequest,$q,$rootScope,$session,$timeout,$ionicPlatform,$window,$queue,$log,Dialog,ProgressbarService){var service={is_webview:!IS_NATIVE_APP,known_modules:{calendar:"Event",catalog:"Catalog",custom_page:"Cms",discount:"Discount",fanwall:"Newswall",form:"Form",music_gallery:"MusicPlaylist",newswall:"Newswall",places:"Places",push_notification:"Push",qr_discount:"Push",rss_feed:"Rss",set_meal:"SetMeal",social_gaming:"SocialGaming",twitter:"Twitter",video_gallery:"Videos",wordpress:"Wordpress"},lazyLoadCodes:{calendar:["event"],custom_page:["cms"],fanwall:["newswall"],music_gallery:["media"],places:["cms","places"],qr_discount:["discount"],rss_feed:["rss"],set_meal:["catalog"],video_gallery:["video"],push_notification:["push"]}},_loaded=!1,_loaded_resolver=$q.defer(),_ready=!1,_ready_resolver=$q.defer();service.preLoad=function(pages){},Object.defineProperty(service,"loaded",{get:function(){return _loaded?($log.info("Application loaded, resolving promise"),$q.resolve()):_loaded_resolver.promise},set:function(value){!0===(_loaded=!!value)&&($log.info("Application loaded, resolving promise"),_loaded_resolver.resolve())}}),Object.defineProperty(service,"ready",{get:function(){return _ready?($log.info("Application ready, resolving promise"),$q.resolve()):_ready_resolver.promise},set:function(value){!0===(_ready=!!value)&&($log.info("Application ready, resolving promise"),_ready_resolver.resolve())}}),service.app_id=null,service.app_name=null,service.googlemaps_key=null,service.is_customizing_colors=$window.location.href.indexOf("application/mobile_customization_colors/")>=0,Object.defineProperty(service,"acceptedOfflineMode",{get:function(){return"ok"===$window.localStorage.getItem("sb-offline-mode")}}),service.populate=function(data){service.app_id=data.application.id,service.app_name=data.application.name,service.privacy_policy=data.application.privacy_policy,service.privacy_policy_title=data.application.privacy_policy_title,service.googlemaps_key=data.application.googlemaps_key,service.is_locked=data.application.is_locked,service.offline_content=data.application.offline_content,service.homepage_background=data.application.homepage_background,service.default_background=data.homepage_image,service.colors=data.application.colors,service.ready=!0},service.showCacheDownloadModalOrUpdate=function(){ProgressbarService.init().then(function(){$rootScope.progressBarPercent=0;var offlineResponse=$window.localStorage.getItem("sb-offline-mode");if("ok"===offlineResponse)$log.debug("offline mode has been accepted, updating"),service.updateCache(!1);else if("no"===offlineResponse)$log.debug("offline mode has been refused in the past, not updating");else{$log.debug("offline mode need to be asked");Dialog.confirm("Offline content","Do you want to download all the contents now to access it when offline? If you do, we recommend you to use a WiFi connection.",["Yes","No"],"text-center").then(function(res){res?($window.localStorage.setItem("sb-offline-mode","ok"),$rootScope.openLoaderProgress(),ProgressbarService.createCircle(".ui-progress-view-circle"),service.updateCache(!0)):$window.localStorage.setItem("sb-offline-mode","no")})}})};var _updatingCache=!1,_replace_tokens=function(url){return _.isString(url)?url.replace("%DEVICE_UID%",$session.getDeviceUid()).replace("%CUSTOMER_ID%",$rootScope.customer_id):0};return service.updateCache=function(forceMain){if(window.OfflineMode&&window.OfflineMode.setCanCache(),!0!==_updatingCache){var device_screen=$session.getDeviceScreen();$pwaRequest.get("application/mobile_data/findall",{data:{device_uid:$session.getDeviceUid(),device_width:device_screen.width,device_height:device_screen.height},cache:!1,timeout:3e4}).then(function(data){$log.debug("application/mobile_data/findall",data);var total=data.paths.length+data.assets.length;isNaN(total)&&(total=100);var progress=0,assets_done=JSON.parse($window.localStorage.getItem("sb-offline-mode-assets"));_.isArray(assets_done)||(assets_done=[]);var fileQueue=[],retryQueue=[],delay=500,maxRequest=15;ionic.Platform.isIOS()&&(delay=250,maxRequest=3);var requestCount=0,pathQueue=null,updateFailed=function(asset){(requestCount-=1)<0&&(requestCount=0),pathQueue.paused&&requestCount<=maxRequest&&($log.debug("Start "+requestCount),pathQueue.start()),retryQueue.push(asset)},updateProgress=function(){if(progress+=1,(requestCount-=1)<0&&(requestCount=0),pathQueue.paused&&requestCount<=maxRequest&&($log.debug("Start "+requestCount),pathQueue.start()),$rootScope.isNativeApp){var percent=progress/total;percent.toFixed(2)>$rootScope.progressBarPercent&&($rootScope.progressBarPercent=percent.toFixed(2)),isNaN($rootScope.progressBarPercent)&&($rootScope.progressBarPercent=0),ProgressbarService.updateProgress($rootScope.progressBarPercent),$window.localStorage.setItem("sb-offline-mode-assets",JSON.stringify(assets_done)),$rootScope.progressBarPercent>=1&&(_updatingCache=!1,$timeout(function(){ProgressbarService.remove(),$rootScope.closeLoaderProgress()},1e3))}},endProgress=function(){progress=total,$rootScope.progressBarPercent=1,ProgressbarService.updateProgress($rootScope.progressBarPercent),$window.localStorage.setItem("sb-offline-mode-assets",JSON.stringify(assets_done)),_updatingCache=!1,$timeout(function(){ProgressbarService.remove(),$rootScope.closeLoaderProgress()},1e3)},look_for_images=function(object){_.forEach(object,function(obj,key){if(_.isString(obj)&&/\.(png|jpg|jpeg|gif)$/.test(obj)){var path=_replace_tokens(obj);/^https?:/.test(path)||(path=(DOMAIN+"/"+path).replace(/([^:/])\/+/g,"$1/")),_.includes(data.assets,path)||(total+=1,pathQueue.add({type:"asset",path:path}))}else(_.isArray(obj)||_.isObject(obj))&&look_for_images(obj)})},retry=!0,fetchAssets=function(asset){"path"===asset.type?(requestCount+=1,$pwaRequest.get(asset.path,{cache:!$rootScope.isOverview}).then(function(data){_.isObject(data)&&look_for_images(data),updateProgress()},function(){retry?updateFailed(asset):updateProgress()})):"asset"===asset.type&&(requestCount+=1,$pwaRequest.cacheImage(asset.path).then(function(){updateProgress(),assets_done.push(asset.path)},function(){retry?updateFailed(asset):(updateProgress(),assets_done.push(asset.path))})),requestCount>=maxRequest&&($log.debug("Paused "+requestCount),pathQueue.pause())},options={delay:delay,paused:!0,complete:function(){$log.debug("Queue ends."),updateProgress(),retry=!1;var _retryQueue=retryQueue;retryQueue.length>0?((pathQueue=$queue.queue(fetchAssets,{delay:1e3,paused:!0,complete:function(){$log.debug("Retry queue ends."),updateProgress(),endProgress()}})).addEach(_retryQueue),pathQueue.start()):endProgress()}};_.forEach(data.paths,function(path){fileQueue.push({type:"path",path:_replace_tokens(path)})}),_.forEach(data.assets,function(asset){var path=_replace_tokens(asset);_.includes(assets_done,path)||fileQueue.push({type:"asset",path:path})}),service.fileQueue=fileQueue,(pathQueue=$queue.queue(fetchAssets,options)).addEach(fileQueue),service.loaded.then(function(){forceMain?pathQueue.start():($ionicPlatform.on("pause",function(result){pathQueue.start()}),$ionicPlatform.on("resume",function(result){pathQueue.pause()}))})},function(){_updatingCache=!1})}},service}),angular.module("starter").service("ConnectionService",function($ionicPlatform,$rootScope,$translate,$window,$log,$http,Dialog){var service={},_isOnline=!0;return Object.defineProperty(service,"isOnline",{get:function(){return _isOnline}}),Object.defineProperty(service,"isOffline",{get:function(){return!service.isOnline}}),service.show_popup=null,service.callbackFromNative=function(data){service.isOnline!==data.isOnline&&(_isOnline=data.isOnline,service.show_popup||!$rootScope.isNativeApp||_isOnline||(service.show_popup=!0,$rootScope.onPause||Dialog.alert("Info","You have gone offline","OK",-1).then(function(){service.show_popup=null})),$rootScope.$broadcast("connectionStateChange",data),_isOnline?$log.info("App is now online."):$log.info("App is offline."))},$ionicPlatform.ready(function(){$rootScope.isNativeApp&&$window.OfflineMode&&($window.OfflineMode.setCheckConnectionURL(DOMAIN+"/ping.txt"),$window.OfflineMode.registerCallback(service.callbackFromNative))}),service}),angular.module("starter").service("ContextualMenu",function($ionicSideMenuDelegate,$timeout,HomepageLayout){var _exists,_templateURL,_width,_is_enabled_function,self={};return Object.defineProperty(self,"exists",{get:function(){return _exists}}),Object.defineProperty(self,"templateURL",{get:function(){return _templateURL}}),Object.defineProperty(self,"width",{get:function(){return angular.isNumber(_width)&&_width>0&&_width||275}}),Object.defineProperty(self,"isEnabled",{get:function(){return(angular.isFunction(_is_enabled_function)&&_is_enabled_function||function(){return self.exists})()}}),Object.defineProperty(self,"direction",{get:function(){return"right"===HomepageLayout.properties.menu.position?"left":"right"}}),self.reset=function(){$timeout(function(){_exists=!1,_is_enabled_function=function(){return self.exists},_width=null,_templateURL=null})},self.reset(),self.set=function(templateURL,width,is_enabled_function){return angular.isString(templateURL)&&templateURL.length>0?(_exists=!0,_templateURL=templateURL,_width=width,_is_enabled_function=is_enabled_function):self.reset(),function(){_templateURL===templateURL&&self.reset()}},self.toggle=function(open){var direction=self.direction.slice(0,1).toUpperCase()+self.direction.slice(1);!0!==open&&!1!==open&&(open=!$ionicSideMenuDelegate["isOpen"+direction]()),self.exists&&self.isEnabled&&$ionicSideMenuDelegate["toggle"+direction](open)},self.open=function(){self.toggle(!0)},self.close=function(){self.toggle(!1)},self}),angular.module("starter").service("Country",function($pwaRequest){var service={findAll:function(){return $pwaRequest.get("/application/mobile_country/findall")}};return service}),angular.module("starter").service("Dialog",function($ionicPopup,$timeout,$translate,$q){var service={is_open:!1,stack:[],unStack:function(){service.is_open=!1,service.stack.length>=1&&$timeout(function(){var dialog=service.stack.shift();switch(dialog.type){case"alert":service.renderAlert(dialog.data);break;case"prompt":service.renderPrompt(dialog.data);break;case"confirm":service.renderConfirm(dialog.data);break;case"ionicPopup":service.renderIonicPopup(dialog.data)}},250)},alert:function(title,message,button,dismiss){var deferred=$q.defer();return service.stack.push({type:"alert",data:{title:title,message:message,button:button,dismiss:dismiss,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderAlert:function(data){service.is_open=!0;var alertPromise=null,message=$translate.instant(data.title),cssClass=""===data.title?"popup-no-title":"";if(alertPromise=$ionicPopup.alert({title:$translate.instant(data.title),template:$translate.instant(data.message),cssClass:cssClass,okText:$translate.instant(data.button)}),data.promise.resolve(alertPromise),alertPromise.then(function(){service.unStack()}),"number"==typeof data.dismiss){var duration=data.dismiss;-1===data.dismiss&&(duration=Math.min(Math.max(50*message.length,2e3),7e3)+400),$timeout(function(){alertPromise.close()},duration)}},prompt:function(title,message,type,value){var deferred=$q.defer(),localType=void 0===type?"text":type,localValue=void 0===value?"":value;return service.stack.push({type:"prompt",data:{title:title,message:message,type:localType,value:localValue,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderPrompt:function(data){service.is_open=!0;var cssClass=""===data.title?"popup-no-title":"";return $ionicPopup.prompt({title:$translate.instant(data.title),template:$translate.instant(data.message),okText:$translate.instant(data.button),cssClass:cssClass,inputType:data.type,inputPlaceholder:$translate.instant(data.value)}).then(function(result){void 0===result?data.promise.reject(result):data.promise.resolve(result),service.unStack()})},confirm:function(title,message,buttonsArray,cssClass){var deferred=$q.defer();return service.stack.push({type:"confirm",data:{title:title,message:message,buttons_array:buttonsArray,css_class:cssClass,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderConfirm:function(data){service.is_open=!0;var cssClass=""===data.title?"popup-no-title":"";return $ionicPopup.confirm({title:$translate.instant(data.title),cssClass:data.css_class+" "+cssClass,template:data.message,okText:$translate.instant(data.buttons_array[0]),cancelText:$translate.instant(data.buttons_array[1])}).then(function(result){data.promise.resolve(result),service.unStack()})},ionicPopup:function(config){var deferred=$q.defer();return service.stack.push({type:"ionicPopup",data:{config:config,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderIonicPopup:function(data){return service.is_open=!0,$ionicPopup.show(data.config).then(function(result){data.promise.resolve(result),service.unStack()})}};return service}),angular.module("starter").service("SafePopups",function(Dialog){var service={show:function(type,params){var button={};switch(type){case"alert":return 1===params.buttons.length&&(button=params.buttons[0]),Dialog.alert(params.title,params.template,button);case"confirm":return Dialog.confirm(params.title,params.template,params.buttons,"");default:return Dialog.ionicPopup(params)}}};return service}),angular.module("starter").service("FacebookConnect",function($cordovaOauth,$rootScope,$timeout,$window,$pwaRequest,Customer,Dialog,SB,Loader){var _this=this;return _this.app_id=null,_this.version="v2.7",_this.is_initialized=!1,_this.is_logged_in=!1,_this.access_token=null,_this.permissions=null,_this.fb_login=null,_this.login=function(){if(!$rootScope.isNotAvailableInOverview()){var scope=_this.permissions?_this.permissions.join(","):"",redirectUri=encodeURIComponent(DOMAIN+"/"+APP_KEY+"?login_fb=true"),fbLocation="https://graph.facebook.com/oauth/authorize?client_id="+_this.app_id+"&scope="+scope+"&response_type=token&redirect_uri=";if(DEVICE_TYPE===SB.DEVICE.TYPE_BROWSER)$window.location=fbLocation+redirectUri;else{Loader.show();var options={redirect_uri:"https://localhost/callback"};$pwaRequest.get(fbLocation+options.redirect_uri,{refresh:!0,cache:!1}).then(function(success){},function(error){options.redirect_uri="http://localhost/callback"}).then(function(){$cordovaOauth.facebook(_this.app_id,_this.permissions,options).then(function(result){Customer.loginWithFacebook(result.access_token).then(function(){Customer.login_modal.hide()}).finally(function(){Loader.hide()})},function(error){Dialog.alert("Login error",error,"OK",-1).then(function(){Customer.login_modal.hide(),Loader.hide()})})})}}},_this.logout=function(){_this.is_logged_in=!1,_this.access_token=null},$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$timeout(function(){_this.logout()})}),_this}),angular.module("starter").service("GoogleMaps",function($cordovaGeolocation,$location,$q,$rootScope,$translate,$window,Application){"use strict";var __self={is_loaded:!1,reset:function(){service.directionsRenderer&&(service.directionsRenderer.setPanel(null),service.directionsRenderer.setMap(null));for(var i=0;i<service.markers;i++)google.maps.event.removeListener(service.markers[i],"click"),service.markers[i].setMap(null);service.map=null,service.panel_id=null,service.directionsRenderer=null,service.markers=[],__self.is_loaded=!1},_calculateRoute:function(origin,destination,params,rejectWithResponseAndStatus){var deferred=$q.defer();_.isObject(params)||(params={mode:google.maps.DirectionsTravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC}),_.isObject(params.request)||(params.request={}),this.directionsService||(this.directionsService=new google.maps.DirectionsService);var request=_.merge({origin:new google.maps.LatLng(origin.latitude,origin.longitude),destination:new google.maps.LatLng(destination.latitude,destination.longitude),travelMode:params.mode,unitSystem:params.unitSystem},params.request);return this.directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK)deferred.resolve(response);else{var errorMessage=$translate.instant("ZERO_RESULTS"===status?"There is no route available with these informations.":"An unexpected error occurred while calculating the route.");console.error(errorMessage,status),!0===rejectWithResponseAndStatus?deferred.reject([response,status]):deferred.reject(errorMessage)}}),deferred.promise},_updateBoundsFromPoints:function(bounds,p){var latitude=parseFloat(p.latitude),longitude=parseFloat(p.longitude);return(null===bounds[0][0]||bounds[0][0]>latitude)&&(bounds[0][0]=latitude),(null===bounds[1][0]||bounds[1][0]<latitude)&&(bounds[1][0]=latitude),(null===bounds[0][1]||bounds[0][1]>longitude)&&(bounds[0][1]=longitude),(null===bounds[1][1]||bounds[1][1]<longitude)&&(bounds[1][1]=longitude),bounds},_extendBounds:function(bounds,margin){if(margin){var latitudeMargin=(bounds[1][0]-bounds[0][0])*margin;0===latitudeMargin&&(latitudeMargin=.02),bounds[0][0]-=latitudeMargin,bounds[1][0]+=latitudeMargin;var longitudeMargin=(bounds[1][1]-bounds[0][1])*margin;0===longitudeMargin&&(longitudeMargin=.01),bounds[0][1]-=longitudeMargin,bounds[1][1]+=longitudeMargin}return bounds}},gmap_callbacks=[],gmap_script_appended=!1,gmap_loaded=!1,_init_called=!1;$window.initGMapCallback=function(){if(gmap_script_appended)for(gmap_loaded=!0,console.log("Gmap loaded, calling callbacks");gmap_callbacks.length>0;){var func=gmap_callbacks.shift();_.isFunction(func)&&func.apply($window,arguments)}};var service={USER_INTERACTED_EVENT:"GoogleMaps.UserInteracted",map:null,directionsRenderer:null,panel_id:null,markers:[],lastInfoWindow:null,init:function(){if("undefined"==typeof GoogleMaps&&!gmap_script_appended){if(_init_called)return;_init_called=!0,Application.loaded.then(function(){var google_maps=document.createElement("script");google_maps.type="text/javascript",google_maps.src="https://maps.googleapis.com/maps/api/js?libraries=places&key="+Application.googlemaps_key+"&callback=initGMapCallback",document.body.appendChild(google_maps),gmap_script_appended=!0})}gmap_loaded&&$window.initGMapCallback()},addCallback:function(func){gmap_callbacks.push(func),service.init()},createMap:function(element,options){angular.isObject(options)||(options={}),__self.is_loaded&&__self.reset(),options=_.merge({zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},options),service.map=new google.maps.Map(document.getElementById(element),options),google.maps.event.addListener(service.map,"tilesloaded",function(){console.log("Maps is loaded"),__self.is_loaded=!0});var userInteracted=function(event_name){return function(){$rootScope.$broadcast(service.USER_INTERACTED_EVENT,event_name)}};return google.maps.event.addListener(service.map,"dblclick",userInteracted("dblclick")),google.maps.event.addListener(service.map,"dragend",userInteracted("dragend")),google.maps.event.addDomListener(service.map.getDiv(),"mousewheel",userInteracted("wheel"),!0),google.maps.event.addDomListener(service.map.getDiv(),"DOMMouseScroll",userInteracted("wheel"),!0),service.map},setCenter:function(coordinates){if(coordinates){var center=new google.maps.LatLng(coordinates.latitude,coordinates.longitude);return service.map.setCenter(center)}return $cordovaGeolocation.getCurrentPosition().then(function(position){service.setCenter(position.coords)})},setPanelId:function(panel_id){service.panel_id=panel_id},isLoaded:function(){return __self.is_loaded},addMarker:function(marker,index){var latlng=new google.maps.LatLng(marker.latitude,marker.longitude),icon=null;if(marker.icon&&marker.icon.url){var width=marker.icon.width?marker.icon.width:95,height=marker.icon.height?marker.icon.height:49;icon={url:marker.icon.url,scaledSize:new google.maps.Size(width,height)}}var options=_.merge({position:latlng,map:service.map,icon:icon},marker.markerOptions),mapMarker=new google.maps.Marker(options);if(marker.title){var marker_id="info-marker-"+index,infoWindowContent='<div id="'+marker_id+'"><p style="color:black;">';marker.link&&(infoWindowContent+='<a href="'+marker.link+'">'),infoWindowContent+=marker.title,marker.link&&(infoWindowContent+="</a>");var markerHasAction=_.isObject(marker.action)&&_.isString(marker.action.label)&&_.isFunction(marker.action.onclick);if(markerHasAction){var id="map_marker_infowindow_action_"+Math.ceil(+new Date*Math.random());infoWindowContent+='<div style="margin-top: 15px; "><button id="'+id+'" class="button button-custom">'+marker.action.label+"</button></div>"}infoWindowContent+="</p></div>";var infoWindows=new google.maps.InfoWindow({content:infoWindowContent});markerHasAction&&google.maps.event.addListener(infoWindows,"domready",function(){document.getElementById(id).addEventListener("click",marker.action.onclick)}),google.maps.event.addListener(mapMarker,"click",function(){null!==service.lastInfoWindow&&service.lastInfoWindow.close(),infoWindows.open(service.map,mapMarker),service.lastInfoWindow=infoWindows,marker.hasOwnProperty("onClick")&&"function"==typeof marker.onClick&&google.maps.event.addDomListener(document.getElementById(marker_id),"click",function(event){marker.onClick(angular.extend({},marker.config))})})}return marker.is_centered&&service.setCenter(marker),+index<0?service.markers.push(mapMarker):service.markers.splice(index,0,mapMarker),mapMarker},removeMarker:function(mapMarker){var index=service.markers.indexOf(mapMarker);return index>=0&&(service.markers[index].setMap(null),service.markers.splice(index,1),!0)},replaceMarker:function(mapMarker,marker){return!!service.removeMarker(mapMarker)&&service.addMarker(marker)},addRoute:function(route,custom_directions_renderer,custom_panel_div_id){var renderer=null;_.isObject(custom_directions_renderer)&&_.isFunction(custom_directions_renderer.setDirections)?renderer=custom_directions_renderer:(service.directionsRenderer||(service.directionsRenderer=new google.maps.DirectionsRenderer),renderer=service.directionsRenderer),renderer.setMap(service.map),renderer.setDirections(route);var panelDiv=document.getElementById(custom_panel_div_id||service.panel_id);panelDiv&&renderer.setPanel(panelDiv)},fitToBounds:function(bounds){var sw=new google.maps.LatLng(bounds.latitudeMin,bounds.longitudeMin),ne=new google.maps.LatLng(bounds.latitudeMax,bounds.longitudeMax),mapBounds=new google.maps.LatLngBounds(sw,ne);service.map.fitBounds(mapBounds)},geocode:function(address){var deferred=$q.defer();return this.geocoder||(this.geocoder=new google.maps.Geocoder),this.geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();deferred.resolve({latitude:latitude,longitude:longitude})}else{var errorMessage=$translate.instant("The address you're looking for does not exist.");console.error(errorMessage),deferred.reject(errorMessage)}}),deferred.promise},reverseGeocode:function(position){var deferred=$q.defer();this.geocoder||(this.geocoder=new google.maps.Geocoder);var latlng={lat:position.latitude,lng:position.longitude};return this.geocoder.geocode({location:latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK)deferred.resolve(results);else{var errorMessage=$translate.instant("The address you're looking for does not exists.");deferred.reject(errorMessage)}}),deferred.promise},calculateRoute:function(origin,destination,params,rejectWithResponseAndStatus){var deferred=$q.defer();return origin?__self._calculateRoute(origin,destination,params,rejectWithResponseAndStatus).then(function(route){deferred.resolve(route)},function(err){deferred.reject(err)}):$cordovaGeolocation.getCurrentPosition().then(function(position){__self._calculateRoute(position.coords,destination,params,rejectWithResponseAndStatus).then(function(route){deferred.resolve(route)},function(err){deferred.reject(err)})},function(err){angular.isObject(err)&&1===err.code&&angular.isString(err.message)&&err.message.indexOf("secure origin")&&deferred.reject("Your location could not be found because your application doesn't use SSL."),deferred.reject("gps_disabled")}),deferred.promise},getBoundsFromPoints:function(points,margin){if(points){var bounds=[[null,null],[null,null]];return points.reduce(function(output,p){return p.latitude||console.warn("Invalid latitude."),p.longitude||console.warn("Invalid longitude."),bounds=__self._updateBoundsFromPoints(bounds,p),output},[]),0!==points.length&&margin&&(bounds=__self._extendBounds(bounds,margin)),{latitudeMin:bounds[0][0],latitudeMax:bounds[1][0],longitudeMin:bounds[0][1],longitudeMax:bounds[1][1]}}return null}};return service.init(),service}),angular.module("starter").service("layout_10",function($rootScope){var service={getTemplate:function(){return"templates/home/l10/view.html"},getModalTemplate:function(){return"templates/home/l10/modal.html"},onResize:function(){},features:function(features,moreButton){var thirdOption=features.overview.options[2],fourthOption=features.overview.options[3];return features.overview.options[2]=moreButton,features.overview.options[3]=thirdOption,features.overview.options[4]=fourthOption,features.options=features.options.slice(4,features.options.length),features}};return service}),angular.module("starter").service("layout_17",function($rootScope,$location,$timeout){var service={getTemplate:function(){return"templates/home/l17/view.html"},getModalTemplate:function(){return"templates/home/modal/view.html"},onResize:function(){$timeout(function(){service._resize(),$timeout(function(){service._resize()},500)},100)},features:function(features,more_button){var i,j,temparray,more_options=features.options.slice(12),chunks=[];for(i=0,j=more_options.length;i<j;i+=2)temparray=more_options.slice(i,i+2),chunks.push(temparray);return features.chunks=chunks,features},_resize:function(){var scrollview=document.getElementById("metro-scroll");if(scrollview&&(scrollview.style.display="block"),document.getElementById("metro-scroll")&&document.getElementById("metro-line-2")){var spacing=document.getElementById("metro-scroll").getBoundingClientRect().width/100*2.5,element=document.getElementById("metro-line-2");if(element){var positionInfo=element.getBoundingClientRect();element.style.height=(positionInfo.width-spacing)/4+"px"}for(var lines=document.getElementsByClassName("metro-line"),i=0;i<lines.length;i++)lines[i].style.marginBottom=spacing+"px"}}};return service}),angular.module("starter").service("layout_8",function(){var service={getTemplate:function(){return"templates/home/l8/view.html"},getModalTemplate:function(){return"templates/home/modal/view.html"},onResize:function(){},features:function(features,more_button){var first_option=null,options=[];return 0!==features.options.length&&(first_option=features.options[0],options=features.options.slice(1)),features.first_option=first_option,features.options=options,features}};return service}),angular.module("starter").service("LinkService",function($rootScope,$translate,$window,SB){return{openLink:function(url,options){if(!$rootScope.isNotAvailableInOverview()&&!$rootScope.isNotAvailableOffline()){void 0===options&&(options={hide_navbar:!0,use_external_app:!1});var target="_blank",inAppBrowserOptions=[];switch(!0){case/^(tel:).*/.test(url)&&DEVICE_TYPE===SB.DEVICE.TYPE_ANDROID:target="_self";break;case options.use_external_app:case/.*\.pdf($|\?)/.test(url):case options.hide_navbar&&DEVICE_TYPE===SB.DEVICE.TYPE_IOS:target="_system",inAppBrowserOptions.push("EnableViewPortScale=yes");break;default:options&&options.hide_navbar?(inAppBrowserOptions.push("location=no"),inAppBrowserOptions.push("toolbar=no")):(inAppBrowserOptions.push("location=yes"),inAppBrowserOptions.push("closebuttoncaption="+$translate.instant("Done")),inAppBrowserOptions.push("transitionstyle=crossdissolve"),inAppBrowserOptions.push("toolbar=yes"))}$window.open(url,target,inAppBrowserOptions.join(","))}}}}),angular.module("starter").service("Loader",function($ionicLoading,$translate,$state,$timeout,Dialog){var service={is_open:!1,last_config:"",promise:null,timeout:null,keep_timeout:!1,timeout_count:0,callTimeout:function(){service.timeout=$timeout(function(){service.timeout_count=service.timeout_count+1,service.keep_timeout=!0;var buttons=["Go back home","Continue"];service.timeout_count>=2&&(service.keep_timeout=!1,buttons=["Go back home"]),service.hide(),Dialog.confirm("Feature timeout","It seems the feature your are trying to load is taking too much time!<br />Would you like to continue?",buttons).then(function(result){result||service.timeout_count>=2?(service.keep_timeout=!1,service.hide(),$state.go("home")):(service.show(),service.callTimeout())})},1e3)},show:function(text,config,replace){if(void 0===replace&&(replace=!1),!service.is_open){service.is_open=!0;var template='<ion-spinner class="spinner-custom"></ion-spinner>';void 0!==text&&(template=replace?$translate.instant(text):'<ion-spinner class="spinner-custom"></ion-spinner><br /><span>'+$translate.instant(text)+"</span>"),null===service.last_config&&(service.last_config=angular.extend({template:template},config)),service.promise=$ionicLoading.show(service.last_config),service.timeout_count=0,!0===service.keep_timeout&&service.callTimeout()}return service.promise},hide:function(){return service.is_open=!1,!1===service.keep_timeout&&null!==service.timeout&&($timeout.cancel(service.timeout),service.timeout=null,service.timeout_count=0,service.last_config=null),$ionicLoading.hide()}};return service}),angular.module("starter").service("Location",function($cordovaGeolocation,$q){var service={lastFetch:null,position:null,getLocation:function(config,force){var deferred=$q.defer(),isResolved=!1,localForce=void 0!==force,localConfig=angular.extend({enableHighAccuracy:!0,timeout:1e4,maximumAge:0},config);return!localForce&&null!==service.lastFetch&&service.lastFetch+42e4>Date.now()&&(deferred.resolve(service.position),isResolved=!0),$cordovaGeolocation.getCurrentPosition(localConfig).then(function(position){service.lastFetch=Date.now(),service.position=position,isResolved||deferred.resolve(service.position)},function(){isResolved||deferred.reject()}),deferred.promise},getLatest:function(){var deferred=$q.defer();return null===service.lastFetch?service.getLocation().then(function(position){deferred.resolve(position)},function(){deferred.reject(!1)}):deferred.resolve(service.position),deferred.promise}};return service}),angular.module("starter").service("MediaPlayer",function($interval,$rootScope,$state,$log,$location,$ionicHistory,$stateParams,$timeout,$translate,$window,Application,HomepageLayout,Dialog,Modal,Loader,SB){var service={media:null,is_initialized:!1,is_minimized:!1,is_playing:!1,is_radio:!1,is_shuffling:!1,is_stream:!1,repeat_type:null,shuffle_tracks:[],tracks:[],current_index:0,current_track:null,duration:0,elapsed_time:0,playlistModal:null,value_id:null,use_music_controls:SB.DEVICE.TYPE_BROWSER!==DEVICE_TYPE,createModal:function(scope){service.playlistModal||Modal.fromTemplateUrl("templates/media/music/l1/player/playlist.html",{scope:scope}).then(function(modal){service.playlistModal=modal})},openPlaylist:function(){service.playlistModal&&service.playlistModal.show()},closePlaylist:function(){service.playlistModal&&service.playlistModal.hide()},loading:function(){var message=$translate.instant("Loading");service.is_radio&&(message=$translate.instant("Buffering")),Loader.show(message)}},music_controls_events=function(event){switch(event){case"music-controls-next":service.is_radio||service.next();break;case"music-controls-previous":service.is_radio||service.prev();break;case"music-controls-pause":case"music-controls-play":case"music-controls-toggle-play-pause":service.playPause();break;case"music-controls-destroy":service.destroy()}};return service.init=function(tracks_loader,is_radio,track_index){service.value_id!==$stateParams.value_id&&service.destroy(),service.media&&service.current_track.streamUrl!==tracks_loader.tracks[track_index].streamUrl&&service.destroy(),service.media||(service.value_id=$stateParams.value_id,service.is_radio=is_radio,service.current_index=track_index,tracks_loader&&(service.tracks=tracks_loader.tracks)),service.is_initialized=!0,service.openPlayer(),service.use_music_controls&&(MusicControls.subscribe(music_controls_events),MusicControls.listen())},service.play=function(){service.media.play(),service.is_playing=!0},service.pre_start=function(){service.media&&service.media.pause(),service.is_playing=!1,service.duration=0,service.elapsed_time=0,service.is_media_loaded=!1,service.is_media_stopped=!1},service.start=function(){if(service.current_track=service.tracks[service.current_index],$log.info(service.current_track,service.tracks),-1===service.current_track.streamUrl.indexOf("http://")&&-1===service.current_track.streamUrl.indexOf("https://"))return Loader.hide(),void Dialog.alert("Error","No current stream to load.","OK",-1);service.current_track.albumCover&&(service.current_track.albumCover=service.current_track.albumCover.replace("100x100bb",$window.innerWidth+"x"+$window.innerWidth+"bb")),service.is_stream=service.is_radio,$log.debug(service.current_track),service.media=new Audio(service.current_track.streamUrl),service.media.onended=function(){service.next()},service.play(),service.updateSeekBar(),Loader.hide(),service.updateMusicControls()},service.reset=function(){service.media=null,service.seekbarTimer=null,service.is_shuffling=!1,service.is_initialized=!1,service.is_minimized=!1,$rootScope.$broadcast(SB.EVENTS.MEDIA_PLAYER.HIDE),service.repeat_type=null,service.current_index=0,service.current_track=null,service.shuffle_tracks=[],service.use_music_controls&&(MusicControls.destroy(),MusicControls.subscribe(music_controls_events),MusicControls.listen())},service.destroy=function(){$interval.cancel(service.seekbarTimer),service.media&&service.is_playing&&service.media.pause(),service.reset()},service.openPlayer=function(){$state.go("media-player",{value_id:service.value_id}),service.is_minimized=!1,$rootScope.$broadcast(SB.EVENTS.MEDIA_PLAYER.HIDE),service.media||$timeout(function(){service.pre_start(),service.start()},1e3)},service.playPause=function(){service.is_playing?(service.media.pause(),$interval.cancel(service.seekbarTimer),service.use_music_controls&&MusicControls.updateIsPlaying(!1)):(service.media.play(),service.use_music_controls&&MusicControls.updateIsPlaying(!0)),service.is_playing=!service.is_playing,service.updateMusicControls()},service.prev=function(){"one"===service.repeat_type?service.seekTo(0):service.is_shuffling?(service.shuffle_tracks.length>=service.tracks.length&&"all"===service.repeat_type&&(service.shuffle_tracks=[]),service._randomSong()):"all"===service.repeat_type&&0===service.current_index?service.current_index=service.tracks.length-1:service.current_index>0&&(service.current_index=service.current_index-1),service.pre_start(),service.start()},service.next=function(){"one"===service.repeat_type?service.seekTo(0):(service.is_shuffling?(service.shuffle_tracks.length>=service.tracks.length&&"all"===service.repeat_type&&(service.shuffle_tracks=[]),service._randomSong()):"all"===service.repeat_type&&service.current_index>=service.tracks.length-1?service.current_index=0:service.current_index<service.tracks.length-1&&(service.current_index=service.current_index+1),service.pre_start(),service.start())},service._randomSong=function(){for(var random_index=Math.floor(Math.random()*service.tracks.length);-1!==service.shuffle_tracks.indexOf(random_index)||random_index===service.current_index;)-1!==service.shuffle_tracks.indexOf(random_index)?random_index=Math.floor(Math.random()*service.tracks.length):random_index+=1;service.shuffle_tracks.length>=service.tracks.length&&(random_index=0),service.shuffle_tracks.push(random_index),service.current_index=random_index,service.updateMusicControls()},service.backward=function(){var tmp_seekto=service.elapsed_time-10;tmp_seekto<0?service.prev():service.elapsed_time=tmp_seekto,service.seekTo(service.elapsed_time)},service.forward=function(){var tmp_seekto=service.elapsed_time+10;tmp_seekto>service.media.duration?service.next():service.elapsed_time=tmp_seekto,service.seekTo(service.elapsed_time)},service.willSeek=function(){service.is_playing&&(service.media.pause(),service.is_playing=!1)},service.seekTo=function(position){0===position&&(service.media.pause(),service.is_playing=!1),service.media.currentTime=position,service.is_playing||service.playPause()},service.repeat=function(){switch(service.repeat_type){case null:service.repeat_type="all";break;case"all":service.repeat_type="one";break;case"one":service.repeat_type=null}},service.shuffle=function(){service.shuffle_tracks=[],service.is_shuffling=!service.is_shuffling},service.updateMusicControls=function(){if(service.use_music_controls){var hasPrev=!0,hasNext=!0;service.is_radio&&(hasPrev=!1,hasNext=!1),0===service.current_index&&(hasPrev=!1),service.current_index===service.tracks.length-1&&(hasNext=!1),MusicControls.create({track:service.current_track.name,artist:service.current_track.artistName,cover:service.current_track.albumCover,isPlaying:!0,dismissable:!0,hasPrev:hasPrev,hasNext:hasNext,hasClose:!0,album:service.current_track.albumName,duration:service.media.duration,elapsed:service.media.currentTime,ticker:$translate.instant("Now playing ")+service.current_track.name},function(){$log.debug("success")},function(){$log.debug("error")})}},service.updateSeekBar=function(){service.seekbarTimer=$interval(function(){try{service.is_playing&&(service.elapsed_time=service.media.currentTime),!service.is_radio&&service.is_media_stopped&&service.is_media_loaded&&($interval.cancel(service.seekbarTimer),service.is_media_stopped=!1,service.next())}catch(e){$interval.cancel(service.seekbarTimer)}},100)},service.goBack=function(radio,destroy){radio&&void 0!==destroy?HomepageLayout.getFeatures().then(function(features){var localFeatures=features;if(!Application.is_customizing_colors&&HomepageLayout.properties.options.autoSelectFirst&&localFeatures&&!1!==localFeatures.first_option){for(var featIndex=0,fi=0;fi<localFeatures.options.length;fi+=1){var feat=localFeatures.options[fi];if("code_scan"!==feat.code&&"radio"!==feat.code&&"padlock"!==feat.code){featIndex=fi;break}}localFeatures.options[featIndex].path!=$location.path()&&($ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1}),$location.path(localFeatures.options[featIndex].path).replace())}else $timeout(function(){$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1}),$state.go("home")})}):$ionicHistory.goBack(-1)},service}),angular.module("starter").service("Modal",function($rootScope,$ionicModal,$timeout,$q){var service={is_open:!1,stack:[],current_modal:null,modal_hidden_subscriber:null};return $rootScope.$on("modal.shown",function(){service.is_open=!0,service.modal_hidden_subscriber=$rootScope.$on("modal.hidden",function(){service.modal_hidden_subscriber(),service.current_modal.remove(),service.current_modal=null,service.is_open=!1,service.unStack()})}),service.unStack=function(){service.stack.length>=1?$timeout(function(){var modal=service.stack.shift();switch(modal.type){case"fromTemplateUrl":service.renderFromTemplateUrl(modal.data);break;case"fromTemplate":service.renderFromTemplate(modal.data)}},250):(service.current_modal=null,$timeout(function(){},250))},service.fromTemplateUrl=function(templateUrl,config){var deferred=$q.defer();return service.stack.push({type:"fromTemplateUrl",data:{templateUrl:templateUrl,config:config,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},service.renderFromTemplateUrl=function(data){return $ionicModal.fromTemplateUrl(data.templateUrl,data.config).then(function(modal){service.current_modal=modal,data.promise.resolve(modal)})},service.fromTemplate=function(template,config){var deferred=$q.defer();return service.stack.push({type:"fromTemplate",data:{template:template,config:config,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},service.renderFromTemplate=function(data){return $ionicModal.fromTemplate(data.template,data.config).then(function(modal){service.current_modal=modal,data.promise.resolve(modal)})},service}),angular.module("starter").service("MusicTracksLoader",function($q,$stateParams,MusicTrack){MusicTrack.value_id=$stateParams.value_id;var service={_filterDuplicatedAlbums:function(albums,albumsIds){return albumsIds||(albumsIds=[]),albums=albums.reduce(function(albums,album){return-1===albumsIds.indexOf(album.id)&&(albumsIds.push(album.id),albums.push(album)),albums},[])},loadTracksFromAlbums:function(albums){var deferred=$q.defer();albums=service._filterDuplicatedAlbums(albums,[]);var tracksLoader=service._buildTracksLoader(albums);return deferred.resolve(service.readNextTracks(tracksLoader,50)),deferred.promise},loadTracksFromPlaylists:function(playlists){var deferred=$q.defer(),albumsIds=[],albums=playlists.reduce(function(albums,playlist){var playlistAlbums=service._filterDuplicatedAlbums(playlist.albums,albumsIds);return albums=albums.concat(playlistAlbums)},[]),tracksLoader=service._buildTracksLoader(albums);return deferred.resolve(service.readNextTracks(tracksLoader,50)),deferred.promise},_buildTracksLoader:function(albums){return console.log("_buildTracksLoader",albums),{albums:albums,tracks:[],albumsLoaded:0,errorOccured:!1,fullyLoaded:function(){return this.errorOccured||this.albums.length===this.albumsLoaded},loadMore:function(quantity){return service.readNextTracks(this,quantity)}}},_buildTracksLoaderForSingleAlbum:function(album,tracks){var tracksLoader=service._buildTracksLoader([album]);return tracksLoader.tracks=tracks,tracksLoader.albumsLoaded=1,tracksLoader},loadSingleTrack:function(track){var tracksLoader=service._buildTracksLoader([]);return tracksLoader.tracks=[track],tracksLoader.albumsLoaded=0,tracksLoader},readNextTracks:function(tracksLoader,quantityToLoad){return service.readNextTracksRecursive([],tracksLoader,quantityToLoad)},readNextTracksRecursive:function(tracksLoaded,tracksLoader,quantityToLoad){var deferred=$q.defer(),maxAlbumsToLoadAtOnce=Math.ceil((quantityToLoad-tracksLoaded.length)/15);return 0===maxAlbumsToLoadAtOnce&&(maxAlbumsToLoadAtOnce=1),service.readNextAlbumsTracks(tracksLoader,maxAlbumsToLoadAtOnce).then(function(result){tracksLoaded=tracksLoaded.concat(result.tracksLoaded),!tracksLoader.fullyLoaded()&&tracksLoaded.length<quantityToLoad?deferred.resolve(service.readNextTracksRecursive(tracksLoaded,tracksLoader,quantityToLoad,maxAlbumsToLoadAtOnce)):deferred.resolve({tracksLoader:tracksLoader,tracksLoaded:tracksLoaded})},function(err){console.error("Error while loading tracks.",err),deferred.reject(err),tracksLoader.errorOccured=!0}),deferred.promise},readNextAlbumsTracks:function(tracksLoader,maxAlbumsToLoad){for(var deferred=$q.defer(),promises=[],i=0;i<maxAlbumsToLoad&&!tracksLoader.fullyLoaded();i++,tracksLoader.albumsLoaded++){var album=tracksLoader.albums[tracksLoader.albumsLoaded],param={};"album"==album.element?param.album_id=album.id:param.track_id=album.id,promises.push(MusicTrack.findByAlbum(param))}try{$q.all(promises).then(function(tracksResponses){var tracksLoaded=tracksResponses.reduce(function(tracks,tracksResponse){return tracks=tracks.concat(tracksResponse.tracks)},[]);tracksLoader.tracks=tracksLoader.tracks.concat(tracksLoaded),deferred.resolve({tracksLoader:tracksLoader,tracksLoaded:tracksLoaded})},function(err){console.error("Error while loading tracks.",err),deferred.reject(err)}).finally(function(){})}catch(e){console.error(e.message)}return deferred.promise}};return service}),angular.module("starter").service("Picture",function($cordovaCamera,$ionicActionSheet,$q,$rootScope,$translate,Dialog,SB){var service={isOpen:!1,sheetResolver:null,stack:[],takePicture:function(width,height,quality){if(service.isOpen||$rootScope.isNotAvailableInOverview())return $q.reject();if(void 0===Camera)return Dialog.alert("Error","Camera is not available.","OK",-1).then(function(){return $q.reject()}),$q.reject();service.isOpen=!0;var deferred=$q.defer(),localWidth=void 0===width?1200:width,localHeight=void 0===height?1200:height,localQuality=void 0===quality?90:quality,sourceType=Camera.PictureSourceType.CAMERA,_buttons=[{text:$translate.instant("Import from Library")}];return DEVICE_TYPE!==SB.DEVICE.TYPE_BROWSER&&_buttons.unshift({text:$translate.instant("Take a picture")}),service.sheetResolver=$ionicActionSheet.show({buttons:_buttons,cancelText:$translate.instant("Cancel"),cancel:function(){service.sheetResolver(),deferred.reject({message:$translate.instant("Cancelled")}),service.isOpen=!1},buttonClicked:function(index){0===index&&(sourceType=Camera.PictureSourceType.CAMERA),1===index&&(sourceType=Camera.PictureSourceType.PHOTOLIBRARY);var options={quality:localQuality,destinationType:Camera.DestinationType.DATA_URL,sourceType:sourceType,encodingType:Camera.EncodingType.JPEG,targetWidth:localWidth,targetHeight:localHeight,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};if(DEVICE_TYPE===SB.DEVICE.TYPE_BROWSER){var input=angular.element('<input type="file" accept="image/*">'),selectedFile=function(selectEvent){var file=selectEvent.currentTarget.files[0],reader=new FileReader;reader.onload=function(onloadEvent){input.off("change",selectedFile),onloadEvent.target.result.length>0?(service.sheetResolver(),deferred.resolve({image:onloadEvent.target.result}),service.isOpen=!1):(service.sheetResolver(),service.isOpen=!1)},reader.onerror=function(){service.sheetResolver(),Dialog.alert("Error","An error occurred while loading the picture.","OK",-1).then(function(){service.isOpen=!1})},reader.readAsDataURL(file)};input.on("change",selectedFile),input[0].click()}else $cordovaCamera.getPicture(options).then(function(imageData){service.sheetResolver(),deferred.resolve({image:"data:image/jpeg;base64,"+imageData}),service.isOpen=!1},function(error){service.sheetResolver(),Dialog.alert("Error","An error occurred while taking a picture.","OK",-1).then(function(){service.isOpen=!1}),deferred.reject({message:error})}).catch(function(error){service.sheetResolver(),Dialog.alert("Error","An error occurred while taking a picture.","OK",-1).then(function(){service.isOpen=!1}),deferred.reject({message:error})});return!0}}),deferred.promise}};return service}),angular.module("starter").service("ProgressbarService",function($ocLazyLoad){var service={config:{trail:"#eee",bar_text:"#aaa"},progress_bar:null,init:function(config){return service.config=config,$ocLazyLoad.load("./dist/lazy/progressbar.min.js")},createCircle:function(container){service.progress_bar=new ProgressBar.Circle(container,{color:service.config.bar_text,strokeWidth:2.6,trailWidth:2,trailColor:service.config.trail,easing:"easeInOut",duration:1e3,text:{autoStyleContainer:!1},from:{color:service.config.bar_text,width:2.6},to:{color:service.config.bar_text,width:2.6},step:function(state,circle){circle.path.setAttribute("stroke",state.color),circle.path.setAttribute("stroke-width",state.width);var value=Math.round(100*circle.value());0===value?circle.setText(""):circle.setText(value)}})},updateProgress:function(progress){null!==service.progress_bar&&service.progress_bar.animate(progress)},remove:function(){null!==service.progress_bar&&(service.progress_bar.destroy(),service.progress_bar=null)}};return service}),angular.module("starter").service("PushService",function($cordovaLocalNotification,$location,$log,$q,$rootScope,$translate,$window,$session,Application,Dialog,LinkService,Pages,Push,SB){var service={push:null,settings:{android:{senderID:"01234567890",icon:"ic_icon",iconColor:"#0099C7"},ios:{clearBadge:!0,alert:!0,badge:!0,sound:!0},windows:{}},configure:function(senderID,iconColor){Push.device_type!==SB.DEVICE.TYPE_ANDROID||"01234567890"!==senderID&&""!==senderID?service.settings.android.senderID=senderID:($log.debug("Invalid senderId: "+senderID),service.settings.android.senderID=null),/^#[0-9A-F]{6}$/i.test(iconColor)?service.settings.android.iconColor=iconColor:$log.debug("Invalid iconColor: "+iconColor)},init:function(){$window.PushNotification&&(service.push=$window.PushNotification.init(service.settings))},register:function(){service.init(),service.push&&$rootScope.isNativeApp?(service.push.on("registration",function(data){$log.debug("device_token: "+data.registrationId),Push.device_token=data.registrationId,service.registerDevice()}),service.onNotificationReceived(),service.push.on("error",function(error){$log.debug(error.message)}),service.updateUnreadCount(),Application.loaded.then(function(){service.fetchMessagesOnStart(),$rootScope.$on(SB.EVENTS.PUSH.notificationReceived,function(event,data){var pushFeature=_.filter(Pages.getActivePages(),function(page){return"push_notification"===page.code});pushFeature.length>=1&&(Push.setValueId(pushFeature[0].value_id),Push.findAll(0,!0)),service.displayNotification(data)})})):$log.debug("Unable to initialize push service.")},registerDevice:function(){switch(Push.device_type){case SB.DEVICE.TYPE_ANDROID:service.registerAndroid();break;case SB.DEVICE.TYPE_IOS:service.registerIos()}},registerAndroid:function(){var params={app_id:Application.app_id,app_name:Application.app_name,registration_id:btoa(Push.device_token)};Push.registerAndroidDevice(params)},registerIos:function(){cordova.getAppVersion.getVersionNumber().then(function(appVersion){var deviceName=null;try{deviceName=device.platform}catch(e){$log.debug(e.message)}var deviceModel=null;try{deviceModel=device.model}catch(e){$log.debug(e.message)}var deviceVersion=null;try{deviceVersion=device.version}catch(e){$log.debug(e.message)}var params={app_id:Application.app_id,app_name:Application.app_name,app_version:appVersion,device_token:Push.device_token,device_name:deviceName,device_model:deviceModel,device_version:deviceVersion,push_badge:"enabled",push_alert:"enabled",push_sound:"enabled"};Push.registerIosDevice(params)})},onNotificationReceived:function(){service.push.on("notification",function(data){$rootScope.$broadcast(SB.EVENTS.PUSH.notificationReceived,data),service.push.finish(function(){$log.debug("push finish success")},function(){$log.debug("push finish error")})})},updateUnreadCount:function(){Push.updateUnreadCount().then(function(data){Push.unread_count=data.unread_count,$rootScope.$broadcast(SB.EVENTS.PUSH.unreadPush)})},sendLocalNotification:function(messageId,title,message){$log.debug("-- Push-Service, sending a Local Notification --");var localMessage=angular.copy(message);Push.device_type===SB.DEVICE.TYPE_IOS&&(localMessage="");var params={id:messageId,title:title,text:localMessage};Push.device_type===SB.DEVICE.TYPE_ANDROID&&(params.icon="res://icon.png"),$cordovaLocalNotification.schedule(params),Push.markAsDisplayed(messageId)},fetchMessagesOnStart:function(){Push.getLastMessages(!1).then(function(data){var push=data.push_message;push&&service.displayNotification(push);var inappMessage=data.inapp_message;inappMessage&&(inappMessage.type="inapp",inappMessage.message=inappMessage.text,inappMessage.config={buttons:[{text:$translate.instant("OK"),type:"button-custom",onTap:function(){Push.markInAppAsRead()}}]},null!==inappMessage.cover&&void 0===inappMessage.additionalData&&(inappMessage.additionalData={cover:inappMessage.cover}),service.displayNotification(inappMessage))})},displayNotification:function(messagePayload){$log.debug("PUSH messagePayload",messagePayload),$session.getItem("pushMessageIds").then(function(pushMessageIds){var localPushMessageIds=pushMessageIds;null!==pushMessageIds&&Array.isArray(pushMessageIds)||(localPushMessageIds=[]);var messageId=parseInt(messagePayload.additionalData.message_id,10);if(-1===localPushMessageIds.indexOf(messageId)){localPushMessageIds.push(messageId),$session.setItem("pushMessageIds",localPushMessageIds);var extendedPayload=messagePayload.additionalData;if(void 0!==extendedPayload&&(extendedPayload.cover||extendedPayload.action_value)){var coverUri=extendedPayload.cover;try{0!==coverUri.indexOf("http")&&(coverUri=DOMAIN+extendedPayload.cover)}catch(e){}var isInAppMessage=void 0!==messagePayload.type&&"inapp"===messagePayload.type,config={buttons:[{text:$translate.instant("Cancel"),type:"button-custom",onTap:function(){isInAppMessage&&Push.markInAppAsRead()}},{text:$translate.instant("View"),type:"button-custom",onTap:function(){isInAppMessage&&Push.markInAppAsRead(),!0!==extendedPayload.open_webview&&"true"!==extendedPayload.open_webview?$location.path(extendedPayload.action_value):LinkService.openLink(extendedPayload.action_value)}}],cssClass:"push-popup",title:messagePayload.title,template:'<img src="#COVER_URI#" class="#KLASS#"><span>#MESSAGE#</span>'.replace("#COVER_URI#",coverUri).replace("#KLASS#",extendedPayload.cover?"":" ng-hide").replace("#MESSAGE#",messagePayload.message)};void 0!==messagePayload.config&&(config=angular.extend(config,messagePayload.config)),void 0!==extendedPayload.action_value&&""!==extendedPayload.action_value&&null!==extendedPayload.action_value||(config.buttons=[{text:$translate.instant("OK"),type:"button-custom",onTap:function(){}}]),$log.debug("Message payload (ionicPopup):",messagePayload,config),Dialog.ionicPopup(config)}else{var localTitle=void 0!==messagePayload.title?messagePayload.title:"Notification";$log.debug("Message payload (alert):",messagePayload),Dialog.alert(localTitle,messagePayload.message,"OK")}$rootScope.$broadcast(SB.EVENTS.PUSH.unreadPushs,messagePayload.count)}$log.debug("Will not display duplicated message: ",messagePayload)}).catch(function(err){$log.debug("We got an error with the localForage when trying to display push message: ",messagePayload),$log.debug(err)})}};return window.pushService=service,service}),angular.module("starter").service("$session",function($log,$pwaCache,$q,$window){$log.debug("Init once $session");var service={localstorage_key:"sb-auth-token",session_id:!1,device_uid:null,device_width:512,device_height:512,device_orientation:"portrait",is_loaded:!1,resolver:$q.defer()};return Object.defineProperty(service,"loaded",{get:function(){return service.is_loaded?$q.resolve():service.resolver.promise},set:function(value){service.is_loaded=!!value,!0===service.is_loaded&&service.resolver.resolve()}}),service.setId=function(sessionId){"undefined"!==sessionId&&void 0!==sessionId&&"null"!==sessionId&&null!==sessionId&&""!==sessionId?(service.session_id=sessionId,service.setItem(service.localstorage_key,sessionId),$window.localStorage.setItem("sb-auth-token",sessionId),service.setDeviceUid()):$log.error("Not saving invalid session_id: ",sessionId)},service.getId=function(){return"undefined"!==service.session_id&&void 0!==service.session_id&&"null"!==service.session_id&&null!==service.session_id&&""!==service.session_id&&service.session_id},service.setDeviceUid=function(){void 0===$window.device?service.device_uid="unknown_"+service.getId():"browser"===$window.device.platform?service.device_uid="browser_"+service.getId():service.device_uid=$window.device.uuid,'""'!==service.device_uid&&void 0!==service.device_uid||(service.device_uid="unknown_"+service.getId())},service.getDeviceUid=function(){return service.device_uid},service.clear=function(){service.session_id="",service.removeItem(service.localstorage_key)},service.setDeviceScreen=function(width,height){var orientation=$window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape";return service.device_width=width,service.device_height=height,service.device_orientation=orientation,service.getDeviceScreen()},service.getDeviceScreen=function(){return{width:service.device_width,height:service.device_height,orientation:service.device_orientation}},service.setItem=function(key,value){return $pwaCache.getRegistryCache().setItem(key,value)},service.getItem=function(key){return $pwaCache.getRegistryCache().getItem(key)},service.removeItem=function(key){return $pwaCache.getRegistryCache().removeItem(key)},service.setDeviceScreen($window.innerWidth,$window.innerHeight),service.getItem(service.localstorage_key).then(function(value){var fallback=$window.localStorage.getItem("sb-auth-token");null!==value&&void 0!==value?($log.debug("Set once $session from pwaRegistry on start: ",value),service.setId(value)):null!==fallback&&void 0!==fallback&&($log.debug("Set once $session from fallback localstorage on start: ",fallback),service.setId(fallback)),null===service.device_uid&&service.setDeviceUid(),service.loaded=!0}),service}),angular.module("starter").service("SocialSharing",function($cordovaSocialSharing,$translate,$q,Application){var service={is_sharing:!1,share:function(content,message,subject,link,file){if(service.is_sharing)return $q.reject();service.is_sharing=!0,void 0===content&&(content="this");var download_app_link=DOMAIN+"/application/device/downloadapp/app_id/"+Application.app_id,generic_message=$translate.instant("Hi. I just found $1 in the $2 app.").replace("$1",content).replace("$2",Application.app_name);void 0!==message&&(message=$translate.instant(message).replace("$1",content).replace("$2",Application.app_name));var _link=void 0===link?download_app_link:link,_file=void 0===file?"":file,_message=void 0===message?generic_message:message,_subject=void 0===subject?"":subject,deferred=$q.defer();return $cordovaSocialSharing.share(_message,_subject,_file,_link).then(function(result){deferred.resolve(result),service.is_sharing=!1},function(error){deferred.reject(error),service.is_sharing=!1}),deferred.promise}};return service}),function(root,factory){"function"==typeof define&&define.amd?define([],function(){return factory()}):"object"==typeof exports?module.exports=factory():factory()}(0,function(){"use strict";return angular.module("tmh.dynamicLocale",[]).config(["$provide",function($provide){function makeStateful($delegate){return $delegate.$stateful=!0,$delegate}$provide.decorator("dateFilter",["$delegate",makeStateful]),$provide.decorator("numberFilter",["$delegate",makeStateful]),$provide.decorator("currencyFilter",["$delegate",makeStateful])}]).constant("tmhDynamicLocale.STORAGE_KEY","tmhDynamicLocale.locale").provider("tmhDynamicLocale",["tmhDynamicLocale.STORAGE_KEY",function(STORAGE_KEY){var defaultLocale,nodeToAppend,storage,activeLocale,localeLocationPattern="angular/i18n/angular-locale_{{locale}}.js",storageFactory="tmhDynamicLocaleStorageCache",storageKey=STORAGE_KEY,promiseCache={},extraProperties={};function loadLocale(localeUrl,$locale,localeId,$rootScope,$q,localeCache,$timeout){function overrideValues(oldObject,newObject){activeLocale===localeId&&(angular.forEach(oldObject,function(value,key){newObject[key]?angular.isArray(newObject[key])&&(oldObject[key].length=newObject[key].length):delete oldObject[key]}),angular.forEach(newObject,function(value,key){angular.isArray(newObject[key])||angular.isObject(newObject[key])?(oldObject[key]||(oldObject[key]=angular.isArray(newObject[key])?[]:{}),overrideValues(oldObject[key],newObject[key])):oldObject[key]=newObject[key]}))}if(promiseCache[localeId])return activeLocale=localeId,promiseCache[localeId];var cachedLocale,deferred=$q.defer();return localeId===activeLocale?deferred.resolve($locale):(cachedLocale=localeCache.get(localeId))?(activeLocale=localeId,$rootScope.$evalAsync(function(){overrideValues($locale,cachedLocale),storage.put(storageKey,localeId),$rootScope.$broadcast("$localeChangeSuccess",localeId,$locale),deferred.resolve($locale)})):(activeLocale=localeId,promiseCache[localeId]=deferred.promise,function(url,callback,errorCallback,$timeout){var script=document.createElement("script"),element=nodeToAppend||document.getElementsByTagName("body")[0],removed=!1;script.type="text/javascript",script.readyState?script.onreadystatechange=function(){"complete"!==script.readyState&&"loaded"!==script.readyState||(script.onreadystatechange=null,$timeout(function(){removed||(removed=!0,element.removeChild(script),callback())},30,!1))}:(script.onload=function(){removed||(removed=!0,element.removeChild(script),callback())},script.onerror=function(){removed||(removed=!0,element.removeChild(script),errorCallback())}),script.src=url,script.async=!0,element.appendChild(script)}(localeUrl,function(){var externalLocale=angular.injector(["ngLocale"]).get("$locale");overrideValues($locale,externalLocale),localeCache.put(localeId,externalLocale),delete promiseCache[localeId],$rootScope.$applyAsync(function(){storage.put(storageKey,localeId),$rootScope.$broadcast("$localeChangeSuccess",localeId,$locale),deferred.resolve($locale)})},function(){delete promiseCache[localeId],$rootScope.$applyAsync(function(){activeLocale===localeId&&(activeLocale=$locale.id),$rootScope.$broadcast("$localeChangeError",localeId),deferred.reject(localeId)})},$timeout)),deferred.promise}this.localeLocationPattern=function(value){return value?(localeLocationPattern=value,this):localeLocationPattern},this.appendScriptTo=function(nodeElement){nodeToAppend=nodeElement},this.useStorage=function(storageName){storageFactory=storageName},this.useCookieStorage=function(){this.useStorage("$cookieStore")},this.defaultLocale=function(value){defaultLocale=value},this.storageKey=function(value){return value?(storageKey=value,this):storageKey},this.addLocalePatternValue=function(key,value){extraProperties[key]=value},this.$get=["$rootScope","$injector","$interpolate","$locale","$q","tmhDynamicLocaleCache","$timeout",function($rootScope,$injector,interpolate,locale,$q,tmhDynamicLocaleCache,$timeout){var localeLocation=interpolate(localeLocationPattern);return storage=$injector.get(storageFactory),$rootScope.$evalAsync(function(){var initialLocale;(initialLocale=storage.get(storageKey)||defaultLocale)&&loadLocaleFn(initialLocale)}),{set:loadLocaleFn,get:function(){return activeLocale}};function loadLocaleFn(localeId){var baseProperties={locale:localeId,angularVersion:angular.version.full};return loadLocale(localeLocation(angular.extend({},extraProperties,baseProperties)),locale,localeId,$rootScope,$q,tmhDynamicLocaleCache,$timeout)}}]}]).provider("tmhDynamicLocaleCache",function(){this.$get=["$cacheFactory",function($cacheFactory){return $cacheFactory("tmh.dynamicLocales")}]}).provider("tmhDynamicLocaleStorageCache",function(){this.$get=["$cacheFactory",function($cacheFactory){return $cacheFactory("tmh.dynamicLocales.store")}]}).run(["tmhDynamicLocale",angular.noop]),"tmh.dynamicLocale"}),angular.module("starter").service("$translate",function(){var service={translations:[],instant:function(text){return angular.isDefined(service.translations[text])?service.translations[text]:text}};return service}),angular.module("starter").service("Url",function($location){this.__sanitize=function(str){return str.startsWith("/")&&(str=str.substr(1,str.length-1)),str};var _that=this;return{get:function(uri,params){angular.isDefined(params)||(params={});var add_language=params.add_language;delete params.add_language;var remove_key=params.remove_key;delete params.remove_key,uri=_that.__sanitize(uri);var url=DOMAIN.split("/");for(var i in add_language&&url.push(CURRENT_LANGUAGE),APP_KEY&&!remove_key&&url.push(APP_KEY),url.push(uri),params)angular.isDefined(params[i])&&(url.push(i),url.push(params[i]));return url=url.join("/")},build:function(uri,params){angular.isDefined(params)||(params={});var url=_that.__sanitize(uri),p=[];for(var i in params)angular.isDefined(params[i])&&p.push(i+"="+params[i]);return url=url+"?"+p.join("&")}}}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(str){return this.substring(0,str.length)===str}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(str){return this.substring(this.length-str.length,this.length)===str}),angular.module("starter").service("YouTubeAutoPauser",function($ionicPlatform,$window){var iframes=[],players=[],initialized=!1,loaded=!1,service={};return service.register=function(iframe){var localIframe=angular.element(iframe)[0];loaded?players.push(new YT.Player(localIframe,{})):(initialized||function(){initialized=!0,$window.onYouTubeIframeAPIReady=function(){loaded=!0,players=players.concat(iframes.map(function(iframe){return new YT.Player(iframe,{})})),$ionicPlatform.on("pause",function(result){var filtered_players=[];players.forEach(function(item){angular.isObject(item)&&angular.isFunction(item.pauseVideo)&&angular.isObject(item.a)&&angular.isObject(item.a.parentElement)&&(item.pauseVideo(),filtered_players.push(item))}),players=filtered_players})};var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}(),iframes.push(localIframe))},service});