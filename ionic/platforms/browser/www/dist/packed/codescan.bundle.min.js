angular.module("starter").controller("CodeScanController",function($cordovaBarcodeScanner,$cordovaClipboard,$ionicHistory,$rootScope,$scope,$timeout,$translate,$window,Dialog,SB){$rootScope.isNotAvailableInOverview()?$ionicHistory.goBack():($scope.scan_protocols=["tel:","http:","https:","geo:","smsto:","mailto:","ctc:"],$scope.is_protocol_found=!1,$cordovaBarcodeScanner.scan().then(function(barcodeData){$ionicHistory.goBack(),barcodeData.cancelled||""===barcodeData.text||$timeout(function(){for(var i=0;i<$scope.scan_protocols.length;i++){if(0===barcodeData.text.toLowerCase().indexOf($scope.scan_protocols[i])){if("http:"===$scope.scan_protocols[i]||"https:"===$scope.scan_protocols[i])$window.open(barcodeData.text,"_blank","location=yes");else{var content_url=barcodeData.text;"smsto:"===$scope.scan_protocols[i]&&DEVICE_TYPE===SB.DEVICE.TYPE_IOS?content_url=url.replace(/(smsto|SMSTO):/,"sms:").replace(/([0-9]):(.*)/,"$1"):"geo:"===$scope.scan_protocols[i]&&DEVICE_TYPE===SB.DEVICE.TYPE_IOS&&(content_url=url.replace(/(geo|GEO):/,"https://maps.apple.com/?q=")),$window.open(content_url,"_blank","location=no")}$scope.is_protocol_found=!0;break}if("ctc:"===$scope.scan_protocols[i]){Dialog.confirm("Scan result",barcodeData.text,["Copy","Done"],"text-center").then(function(result){result&&$cordovaClipboard.copy(barcodeData.text).then(function(){},function(){})}),$scope.is_protocol_found=!0;break}}$scope.is_protocol_found||Dialog.alert("Scan result",barcodeData.text,"OK")})},function(error){$ionicHistory.goBack(),Dialog.alert("Error","An error occurred while reading the code.","OK",-1)}))});