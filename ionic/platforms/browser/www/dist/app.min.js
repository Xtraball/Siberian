window.momentjs_loaded=!1,window.extractI18n=!0;var DEBUG=!1;if(void 0===IS_NATIVE_APP){var IS_NATIVE_APP=!1;void 0===cordova||"android"!==cordova.platformId&&"ios"!==cordova.platformId||(IS_NATIVE_APP=!0)}if(void 0===DEVICE_TYPE){var DEVICE_TYPE=3;if(void 0!==cordova)switch(cordova.platformId){case"android":DEVICE_TYPE=1;break;case"ios":DEVICE_TYPE=2;break;default:DEVICE_TYPE=3}}if(void 0===LOGIN_FB)var LOGIN_FB=!1;if(void 0===IS_PREVIEW)var IS_PREVIEW=!1;var isNativeApp=IS_NATIVE_APP,isOverview=-1!==window.location.href.indexOf("/apps/overview/"),lazyLoadResolver=function(code){return{lazy:["$q","$timeout","$ocLazyLoad",function($q,$timeout,$ocLazyLoad){var localCode=angular.copy(code);angular.isArray(localCode)||(localCode=[localCode]);var files=[];localCode.forEach(function(file){files.push("./dist/packed/"+file+".bundle.min.js")});var deferred=$q.defer();return $ocLazyLoad.load(files).then(function(){$timeout(function(){deferred.resolve(!0)},1)}),deferred.promise}]}};angular.module("lodash",[]).factory("_",["$window",function($window){return $window._}]);var semver={compare:function(a,b,specificity){for(var pa=a.split("."),pb=b.split("."),sentinels={major:1,minor:2,patch:3},i=0;i<(sentinels[specificity]||3);i++){if(na=Number(pa[i]),nb=Number(pb[i]),na>nb||!isNaN(na)&&isNaN(nb))return 1;if(na<nb||isNaN(na)&&!isNaN(nb))return-1}return 0},isGreater:function(a,b,specificity){return 1===this.compare(a,b,specificity)},isLess:function(a,b,specificity){return-1===this.compare(a,b,specificity)},isEqual:function(a,b,specificity){return 0===this.compare(a,b,specificity)}},App=angular.module("starter",["ionic","lodash","ngRoute","ngCordova","ngSanitize","ngQueue","ion-gallery","ngImgCrop","ionic-zoom-view","tmh.dynamicLocale","templates","oc.lazyLoad"]).constant("$ionicLoadingConfig",{template:"<ion-spinner></ion-spinner>"}).constant("SB",{EVENTS:{AUTH:{loginSuccess:"auth-login-success",logoutSuccess:"auth-logout-success",registerSuccess:"auth-register-success",editSuccess:"auth-edit-success"},CACHE:{pagesReload:"pages-reload",layoutReload:"layout-reload",clearSocialGaming:"clear-cache-socialgaming",clearDiscount:"clear-cache-discount"},PADLOCK:{unlockFeatures:"padlock-unlock-features",lockFeatures:"padlock-lock-features"},PUSH:{notificationReceived:"push-notification-received",unreadPush:"push-get-unreaded",readPush:"push-mark-as-read"},MEDIA_PLAYER:{HIDE:"media-player-hide",SHOW:"media-player-show"}},DEVICE:{TYPE_ANDROID:1,TYPE_IOS:2,TYPE_BROWSER:3}}).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",logoutSuccess:"auth-logout-success",loginStatusChanged:"auth-login-status-changed",notAuthenticated:"auth-not-authenticated"}).constant("CACHE_EVENTS",{clearSocialGaming:"clear-cache-socialgaming",clearDiscount:"clear-cache-discount"}).constant("PADLOCK_EVENTS",{unlockFeatures:"padlock-unlock-features"}).constant("PUSH_EVENTS",{notificationReceived:"push-notification-received",unreadPushs:"push-get-unreaded",readPushs:"push-mark-as-read"}).config(function($compileProvider,$httpProvider,$ionicConfigProvider,$logProvider){$httpProvider.interceptors.push(function($injector,$log,$q,$session){return{request:function(config){var sessionId=$session.getId();if(!1!==sessionId&&-1===config.url.indexOf(".html")&&config.url.indexOf(DOMAIN)>-1&&!0!==config.noSbToken){var sessionParam="sb-token="+sessionId;config.url.indexOf("?")>1?config.url=config.url+"&"+sessionParam:config.url=config.url+"?"+sessionParam}return config},responseError:function(response){return response.config.url.match(/(templates|layout\/home)\/.*\.html$/)&&"templates/home/l6/view.html"!==response.config.url?($log.debug("System: An error occured while loading your Layout template, fallback on Layout 6."),response.config.url="templates/home/l6/view.html",$injector.get("$pwaRequest")(response.config)):$q.reject(response)}}}),$logProvider.debugEnabled(DEBUG),$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|map|geo|skype|tel|file|smsto):/),$httpProvider.defaults.withCredentials=!0,$ionicConfigProvider.views.swipeBackEnabled(!1),$ionicConfigProvider.backButton.text(""),$ionicConfigProvider.backButton.previousTitleText(!1)}).run(function($injector,$ionicConfig,$ionicHistory,$ionicNavBarDelegate,$ionicPlatform,$ionicPopup,$ionicScrollDelegate,$ionicSlideBoxDelegate,$location,$log,$ocLazyLoad,$pwaRequest,$q,$rootScope,$session,$state,$templateCache,$timeout,$translate,$window,AdmobService,Analytics,Application,Customer,Dialog,Facebook,FacebookConnect,Padlock,Pages,Push,PushService,SB){angular.extend($rootScope,{isNativeApp:IS_NATIVE_APP,isOnline:!0,isOffline:!1,card_design:!1,app_is_loaded:!0,app_is_bo_locked:!1,ui_background_loader:!1,ui_progress_view:!1,loginFeatureBack:!0}),$window.addEventListener("online",function(){$log.info("online"),$rootScope.isOnline=!0,$rootScope.isOffline=!1}),$window.addEventListener("offline",function(){$log.info("offline"),$rootScope.isOnline=!1,$rootScope.isOffline=!0}),$rootScope.openLoaderProgress=function(){$rootScope.ui_background_loader=!1,$rootScope.ui_progress_view=!0},$rootScope.closeLoaderProgress=function(){$rootScope.ui_background_loader=!1,$rootScope.ui_progress_view=!1},$rootScope.backgroundLoaderProgress=function(){$rootScope.ui_background_loader=!0,$rootScope.ui_progress_view=!1},$rootScope.isNotAvailableOffline=function(){return!!$rootScope.isOffline&&(Dialog.alert("Offline mode","This feature is not available in offline mode!","Dismiss",2350),!0)},$rootScope.isNotAvailableInOverview=function(){return!!isOverview&&(Dialog.alert("Overview","This feature is disabled in this preview","Dismiss",-1),!0)},$ionicPlatform.ready(function(){$ionicNavBarDelegate.align("center"),$timeout(function(){$ionicNavBarDelegate.showBar(!1)}),IS_PREVIEW&&($rootScope.previewerNotice=!0);var loadApp=function(refresh){$window.cordova=$window.cordova||{},$window.device=$window.device||{};var networkPromise=$q.defer();$session.loaded.then(function(){var deviceScreen=$session.getDeviceScreen();$pwaRequest.post("front/app/init",{data:{add_language:!0,device_uid:$session.getDeviceUid(),device_width:deviceScreen.width,device_height:deviceScreen.height,version:"4.17.1"},timeout:2e4,cache:!isOverview,refresh:refresh,network_promise:networkPromise}).then(function(data){var load=data.loadBlock,manifest=data.manifestBlock;$translate.translations=data.translationBlock,$session.getId()||$session.setId(data.loadBlock.customer.token),Application.populate(data.loadBlock),$ionicConfig.backButton.icon(Application.getBackIcon()),Customer.populate(data.loadBlock.customer),Customer.setFacebookLogin(data.loadBlock.application.facebook),Pages.populate(data.featureBlock),LOGIN_FB&&Customer.loginWithFacebook(fbtoken);var HomepageLayout=$injector.get("HomepageLayout");if(data.cssBlock&&data.cssBlock.css){var css=document.createElement("style");css.type="text/css",css.innerHTML=data.cssBlock.css,document.body.appendChild(css)}if(!$rootScope.isOverview&&!$rootScope.isNativeApp){var head=angular.element(document.querySelector("head"));manifest.iconUrl&&(head.append('<link rel="apple-touch-icon" href="'+manifest.iconUrl+'" />'),head.append('<link rel="icon" sizes="192x192" href="'+manifest.iconUrl+'" />')),manifest.manifestUrl&&head.append('<link rel="manifest" href="'+DOMAIN+manifest.manifestUrl+'">'),manifest.startupImageUrl&&head.append('<link rel="apple-touch-startup-image" href="'+manifest.startupImageUrl+'" />'),manifest.themeColor&&head.append('<meta name="theme-color" content="'+manifest.themeColor+'" />')}if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),!IS_PREVIEW)try{PushService.configure(load.application.fcmSenderID,load.application.pushIconcolor),PushService.register()}catch(e){$log.error("An error occured while registering device for Push.",e.message)}if(IS_PREVIEW||($rootScope.fetchupdatetimer=null,$ionicPlatform.on("resume",function(resumeResult){$timeout.cancel($rootScope.fetchupdatetimer),$log.info("-- app is resumed --"),Analytics.storeOpening().then(function(result){Analytics.data.storeClosingId=result.id}),$rootScope.onPause=!1}),$rootScope.onPause=!1,$ionicPlatform.on("pause",function(pauseResult){$rootScope.onPause=!0,Analytics.storeClosing();window.fileExists("module.js",function(){},function(){"undefined"!=typeof chcp&&($rootScope.fetchupdatetimer=$timeout(function(){localStorage.getItem(!1)?chcp.isUpdateAvailableForInstallation(function(error,data){if(error)return $log.info("CHCP: Nothing to install"),void $log.info("CHCP: "+error.description);$log.info("CHCP: Current version: "+data.currentVersion),$log.info("CHCP: About to install: "+data.readyToInstallVersion),chcp.installUpdate(function(error){error&&($log.info("CHCP: Something went wrong with the update, will retry later."),$log.info("CHCP: "+error.description))})}):chcp.fetchUpdate(function(error,data){error?(2===error.code?$log.info("CHCP: There is no available update."):$log.info("CHCP: Failed to load the update with error code: "+error.code),$log.info("CHCP: "+error.description),localStorage.setItem("install-update",!1)):($log.info("CHCP: Update success, trying to install."),$log.info("CHCP: Current version: "+data.currentVersion),$log.info("CHCP: About to install: "+data.readyToInstallVersion),chcp.installUpdate(function(error){if(!error)return $log.info("CHCP: Update successfully install, restarting new files."),void localStorage.setItem("install-update",!1);$log.info("CHCP: Something went wrong with the update, will retry later."),$log.info("CHCP: "+error.description)}))})},5e3))})})),load.application.is_bo_locked&&($rootScope.app_is_bo_locked=!0,$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("locked")),void 0!==window.StatusBar)switch(DEVICE_TYPE){case SB.DEVICE.TYPE_ANDROID:!0===load.application.androidStatusBarIsHidden&&window.StatusBar.hide();break;case SB.DEVICE.TYPE_IOS:!0===load.application.iosStatusBarIsHidden&&window.StatusBar.hide()}$rootScope.isNativeApp&&($window.localStorage.getItem("first_running")||($window.localStorage.setItem("first_running","true"),Analytics.storeInstallation()),Application.offline_content&&Application.showCacheDownloadModalOrUpdate()),Analytics.storeOpening().then(function(result){result&&result.id&&(Analytics.data.storeClosingId=result.id)}),$rootScope.app_is_locked=Application.is_locked&&!(Customer.can_access_locked_features||Padlock.unlocked_by_qrcode),$window.colors=load.application.colors,void 0!==window.StatusBar&&window.updateStatusBar($window.colors.header.statusBarColor),load.application.facebook.id&&(FacebookConnect.permissions=Array.isArray(load.application.facebook.scope)?load.application.facebook.scope:[load.application.facebook.scope],FacebookConnect.app_id=load.application.facebook.id);try{AdmobService.init(load.application.admob)}catch(error){$log.error("Unable to initialize AdMob.",error)}Customer.isLoggedIn()?$rootScope.$broadcast(SB.EVENTS.AUTH.loginSuccess):$rootScope.$broadcast(SB.EVENTS.AUTH.logoutSuccess),$rootScope.getTargetForLink=function(){return $rootScope.isNativeApp?"_blank":"_system"},$ionicNavBarDelegate.align("center"),$timeout(function(){$ionicNavBarDelegate.showBar(!1)}),$rootScope.$on("$ionicView.loaded",function(event,loadViewData){"home"!==loadViewData.stateName?$timeout(function(){$ionicNavBarDelegate.showBar(!0)},100):$timeout(function(){$ionicNavBarDelegate.showBar(!!HomepageLayout.properties.options.autoSelectFirst)},100)}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toStateParams,fromState,fromStateParams){parent&&"function"==typeof parent.postMessage&&parent!==window&&parent.postMessage("state.go",DOMAIN)}),$rootScope.$on("$stateChangeStart",function(event,toState,toStateParams,fromState,fromStateParams){$rootScope.app_is_locked=Application.is_locked&&!(Customer.can_access_locked_features||Padlock.unlocked_by_qrcode),$rootScope.app_is_locked&&"padlock-view"!==toState.name?(event.preventDefault(),$state.go("padlock-view")):Customer.can_access_locked_features&&"padlock-view"===toState.name?event.preventDefault():"codescan"===toState.name&&$rootScope.isNotAvailableInOverview()&&event.preventDefault()});var eventMethod=window.addEventListener?"addEventListener":"attachEvent";(0,window[eventMethod])("attachEvent"===eventMethod?"onmessage":"message",function(e){var parts=e.data.split("="),action=parts[0],params={};parts.length>=2&&(action=parts[0],params=parts[1].replace(/(^\?)/,"").split(",").map(function(n){return this[(n=n.split(":"))[0].trim()]=n[1],this}.bind({}))[0]);var offline=void 0!==params.offline&&"true"===params.offline;if("my-account"!==params.state)switch(action){case"state-go":if(params.hasOwnProperty("value_id")){var feature=Pages.getValueId(params.value_id);if(feature&&!feature.is_active)return void Dialog.alert("Error","This feature is no longer available.","OK",2350)}var state=params.state;if(delete params.state,delete params.offline,!offline&&$rootScope.isNotAvailableOffline())return;$state.go(state,params)}else Customer.loginModal()},!1),$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$rootScope.app_is_locked=Application.is_locked&&!(Customer.can_access_locked_features||Padlock.unlocked_by_qrcode),!$rootScope.app_is_locked&&Application.is_locked&&$state.go("home")}),$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$rootScope.app_is_locked=Application.is_locked&&!Padlock.unlocked_by_qr_code,$rootScope.app_is_locked&&($ionicHistory.nextViewOptions({disableBack:!0}),$state.go("padlock-view"))}),$rootScope.$on("$ionicView.beforeEnter",function(){Analytics.storeClosing()}),$rootScope.unlockUpdate=0,$rootScope.checkForUpdate=function(){$rootScope.isNativeApp?IS_PREVIEW?$log.info("Stop update, This an App preview."):$rootScope.unlockUpdate<5?$rootScope.unlockUpdate=$rootScope.unlockUpdate+1:($rootScope.unlockUpdate=0,Dialog.alert("CHCP","Checking for update ...","OK",-1),chcp.fetchUpdate(function(fetchUpdateError,fetchUpdateData){fetchUpdateError?($log.info("CHCP: Failed to load the update with error code: "+fetchUpdateError.code),2===fetchUpdateError.code?Dialog.alert("CHCP","There is no available update.","Dismiss",-1):Dialog.alert("CHCP",fetchUpdateError.description,"Dismiss",-1)):Dialog.alert("CHCP","Successfully downloaded update, installing...","Dismiss",-1).then(function(){$log.info("CHCP: Current version: "+fetchUpdateData.currentVersion),$log.info("CHCP: About to install: "+fetchUpdateData.readyToInstallVersion),chcp.installUpdate(function(installUpdateError){installUpdateError?($log.info("CHCP: Something went wrong with the update, will retry later.",-1),Dialog.alert("CHCP",installUpdateError.description,"Dismiss")):Dialog.alert("CHCP","Update successfully installed, restarting new files.","Dismiss",-1)})})})):$log.info("Stop update, Android or iOS is required.")},$rootScope.isOverview=isOverview,$rootScope.isOverview&&($window.overview={features:{}},$window.isHomepage=function(){return $location.path()===BASE_PATH},$window.clearCache=function(url){$templateCache.remove(BASE_PATH+"/"+url)},$window.reload=function(path){path&&path!==$location.path()||($ionicHistory.clearCache(),$state.reload())},$window.reloadTabbar=function(){HomepageLayout.unsetData()},$window.setPath=function(path,replace){$window.isSamePath(path)?$window.reload():path.length&&$timeout(function(){$location.path(path),replace&&$location.replace()})},$window.getPath=function(){return $location.path()},$window.isSamePath=function(path){return $location.path()===path},$window.showHomepage=function(){"homepage"===HomepageLayout.properties.menu.visibility?$window.setPath(BASE_PATH):HomepageLayout.getFeatures().then(function(features){$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});for(var visibleOptions=features.options.filter(function(option){return option.is_visible}),fi=0;fi<visibleOptions.length;fi+=1){var feat=visibleOptions[fi];if(["code_scan","radio","padlock","tabbar_account"].indexOf(feat.code)>=0){fi;break}}visibleOptions[fi]&&$window.setPath(visibleOptions[fi].path,!0)})},$window.back=function(){$ionicHistory.goBack()},$window.setLayoutId=function(valueId,layoutId){HomepageLayout.setLayoutId(valueId,layoutId)},parent&&"function"==typeof parent.postMessage&&parent!==window&&parent.postMessage("overview.loaded",DOMAIN)),$rootScope.onlineOnly=$rootScope.isNotAvailableOffline,$rootScope.showMobileFeatureOnlyError=$rootScope.isNotAvailableInOverview,Application.loaded=!0,networkPromise.promise.then(function(networkPromiseResult){Pages.populate(networkPromiseResult.featureBlock),$rootScope.$broadcast(SB.EVENTS.CACHE.layoutReload)},function(){}).then(function(){$timeout(function(){Application.preLoad(Pages.data.pages)},100)}),$ocLazyLoad.load("./dist/lazy/moment.min.js").then(function(){window.momentjs_loaded=!0;try{var tmpLang=language.replace("_","-").toLowerCase();moment.locale([tmpLang,"en"])}catch(e){moment.locale("en")}console.log("moment locale",moment.locale())}),$ocLazyLoad.load("./dist/lazy/angular-carousel.min.js"),window.Features.featuresToLoadOnStart.forEach(function(bundle){$log.info("Loading on Start: ",bundle),$ocLazyLoad.load([bundle.path],{cache:!1}).then(function(success){if($injector.has(bundle.factory))try{$injector.get(bundle.factory).onStart()}catch(e){}}).catch(function(error){})}),$injector.get("ProgressbarService").init(load.application.colors.loader);var currentState=$ionicHistory.currentStateName();$rootScope.app_is_locked&&"padlock-view"!==currentState&&$state.go("padlock-view"),IS_PREVIEW&&($timeout(function(){$rootScope.previewerNotice=!1},3e3),$window.registerTap(3,function(){$window.webview.close()}))}).catch(function(error){!0===refresh&&$timeout(loadApp(!1),1)})})};$timeout(loadApp(!0),1)})});