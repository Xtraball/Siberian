angular.module("starter").controller("CategoryListController",function($filter,$scope,$state,$stateParams,Catalog){angular.extend($scope,{is_loading:!1,value_id:$stateParams.value_id,collection:[],use_pull_refresh:!0,pull_to_refresh:!1,card_design:!1}),Catalog.setValueId($stateParams.value_id),$scope.loadContent=function(pullToRefresh){$scope.is_loading=!0,Catalog.findAll(pullToRefresh).then(function(data){if(data.page_title&&($scope.page_title=data.page_title),$scope.categories=data.categories,$scope.tooltip={collection:$scope.categories,current_item:$scope.categories[0],button_label:"",button_icon:"icon ion-sb-more-round",onItemClicked:function(category){$scope.showTooltip(category)}},$scope.categories.length){var last_category=_.filter($scope.categories,_.matches({name:_.get(Catalog.getLastCategory(),"name",null)}));if(1===last_category.length)$scope.showTooltip(last_category[0]);else{var category=$scope.categories[0];category.children&&(category=category.children[0]),$scope.current_category=category,$scope.showTooltip($scope.current_category)}}}).then(function(){$scope.pull_to_refresh&&($scope.$broadcast("scroll.refreshComplete"),$scope.pull_to_refresh=!1),$scope.is_loading=!1})},$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0,$scope.loadContent(!0)},$scope.showTooltip=function(category){category.children?category.show_children=!category.show_children:($scope.collection=category.collection,$scope.collection_chunks=$filter("chunk")($scope.collection,2),$scope.current_category=category,$scope.tooltip.current_item=$scope.current_category,$scope.tooltip.button_label="",$scope.tooltip.button_icon="icon ion-sb-more-round",Catalog.collection=category.collection,Catalog.setLastCategory(category))},$scope.showItem=function(item){$state.go("catalog-product-view",{value_id:$scope.value_id,product_id:item.id})},$scope.loadContent(!1)}).controller("CategoryProductViewController",function($scope,$stateParams,Catalog){angular.extend($scope,{is_loading:!1,value_id:$stateParams.value_id,product_id:$stateParams.product_id,card_design:!0}),Catalog.setValueId($stateParams.value_id),$scope.loadContent=function(){$scope.is_loading=!0,Catalog.getProduct($scope.product_id).then(function(product){$scope.product=product,$scope.page_title=product.name}).then(function(){$scope.is_loading=!1})},$scope.loadContent()}),angular.module("starter").factory("Catalog",function($pwaRequest){var factory={value_id:null,last_category:null,collection:[],extendedOptions:{},setValueId:function(value_id){factory.value_id=value_id},setLastCategory:function(category){factory.last_category=category},getLastCategory:function(){return factory.last_category},setExtendedOptions:function(options){factory.extendedOptions=options},preFetch:function(){factory.findAll()},findAll:function(refresh){return this.value_id||$pwaRequest.reject("[Factory::Catalog.findAll] missing value_id"),$pwaRequest.get("catalog/mobile_category_list/findall",angular.extend({urlParams:{value_id:this.value_id},refresh:refresh},factory.extendedOptions))},find:function(product_id){return this.value_id||$pwaRequest.reject("[Factory::Catalog.find] missing value_id"),$pwaRequest.get("catalog/mobile_category_product_view/find",{urlParams:{value_id:this.value_id,product_id:product_id}})},getProduct:function(product_id){if(!this.value_id)return $pwaRequest.reject("[Factory::Catalog.getProduct] missing value_id");var product=_.get(_.filter(factory.collection,function(product){return product.id==product_id})[0],"embed_payload",!1);return product?$pwaRequest.resolve(product):factory.find(product_id)}};return factory}),angular.module("starter").controller("SetMealListController",function($filter,$scope,$state,$stateParams,$timeout,SetMeal){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,displayed_per_page:10,load_more:!1,use_pull_refresh:!0,pull_to_refresh:!1,card_design:!1}),SetMeal.setValueId($stateParams.value_id),$scope.loadContent=function(loadMore){$scope.is_loading=!0,SetMeal.findAll(SetMeal.collection.length,!1).then(function(data){return data.collection.length?(SetMeal.collection=SetMeal.collection.concat(data.collection),$scope.collection=SetMeal.collection,$scope.collection_chunks=$filter("chunk")($scope.collection,2)):($scope.collection=SetMeal.collection,$scope.collection_chunks=$filter("chunk")($scope.collection,2)),$scope.displayed_per_page=data.displayed_per_page,$scope.page_title=data.page_title,data}).then(function(data){loadMore&&$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.is_loading=!1,$timeout(function(){$scope.load_more=data.collection.length===$scope.displayed_per_page},250)})},$scope.loadMore=function(){$scope.loadContent(!0)},$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0,$scope.load_more=!1,SetMeal.findAll(0,!0).then(function(data){data.collection&&(SetMeal.collection=data.collection,$scope.collection=SetMeal.collection),$scope.load_more=data.collection.length===data.displayed_per_page}).then(function(){$scope.$broadcast("scroll.refreshComplete"),$scope.pull_to_refresh=!1})},$scope.showItem=function(item){$state.go("set-meal-view",{value_id:$scope.value_id,set_meal_id:item.id})},$scope.loadContent(!1)}).controller("SetMealViewController",function($ionicHistory,$scope,$stateParams,Loader,SetMeal){angular.extend($scope,{is_loading:!1,value_id:$stateParams.value_id}),SetMeal.setValueId($stateParams.value_id),SetMeal.setSetMealId($stateParams.set_meal_id),$scope.loadContent=function(){Loader.show(),SetMeal.getSetMeal().then(function(set_meal){$scope.set_meal=set_meal,$scope.page_title=set_meal.name},function(){$ionicHistory.goBack()}).then(function(){Loader.hide()})},$scope.loadContent()}),angular.module("starter").factory("SetMeal",function($pwaRequest){var factory={value_id:null,set_meal_id:null,displayed_per_page:null,extendedOptions:{},collection:[],setValueId:function(valueId){factory.value_id!==valueId&&(factory.collection=[]),factory.value_id=valueId},setSetMealId:function(setMealId){factory.set_meal_id=setMealId},setExtendedOptions:function(options){factory.extendedOptions=options},preFetch:function(page){factory.findAll()},findAll:function(offset,refresh){return this.value_id?$pwaRequest.get("catalog/mobile_setmeal_list/findall",angular.extend({urlParams:{value_id:this.value_id,offset:offset},refresh:refresh},factory.extendedOptions)):$pwaRequest.reject("[Factory::SetMeal.findAll] missing value_id")},find:function(setMealId){var localSetMealId=setMealId;return void 0===localSetMealId&&(localSetMealId=factory.setMealId),this.value_id||localSetMealId?$pwaRequest.get("catalog/mobile_setmeal_view/find",{urlParams:{value_id:this.value_id,set_meal_id:localSetMealId}}):$pwaRequest.reject("[Factory::SetMeal.find] missing value_id or set_meal_id")},getSetMeal:function(){if(!this.value_id)return $pwaRequest.reject("[Factory::SetMeal.getSetMeal] missing value_id");var set_meal=_.get(_.filter(factory.collection,function(filter_set_meal){return filter_set_meal.id==factory.set_meal_id})[0],"embed_payload",!1);return set_meal?$pwaRequest.resolve(set_meal):factory.find()}};return factory});