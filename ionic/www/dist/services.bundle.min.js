angular.module("starter").service("AdmobService",function($log,$rootScope,$window){var service={interstitialWeights:{start:{show:.333,skip:.667},low:{show:.025,skip:.975},default:{show:.06,skip:.94},medium:{show:.125,skip:.875}},interstitialState:"start",viewEnterCount:0,options:{},forbiddenStates:[],getWeight:function(probs){var random=_.random(0,1e3),offset=0,keyUsed="app",match=!1;return _.forEach(probs,function(value,key){offset+=1e3*value,!match&&random<=offset&&(keyUsed=key,match=!0)}),$log.debug("AdMob key used: ",keyUsed),keyUsed},init:function(options){if($rootScope.isNativeApp&&$window.AdMob){var whom="app";ionic.Platform.isIOS()&&($log.debug("AdMob init iOS"),whom=service.getWeight(options.ios_weight),service.options=options[whom].ios,service.initWithOptions()),ionic.Platform.isAndroid()&&($log.debug("AdMob init Android"),whom=service.getWeight(options.android_weight),service.options=options[whom].android,service.initWithOptions())}},initWithOptions:function(){service.loadBanner(),service.prepareInterstitial()},loadBanner:function(){service.options.banner?($log.info("init admob banner"),$window.AdMob.removeBanner(),$window.AdMob.createBanner({adId:service.options.banner_id,adSize:"SMART_BANNER",position:$window.AdMob.AD_POSITION.BOTTOM_CENTER,autoShow:!0})):$log.info("!ko init admob banner")},removeBanner:function(){service.options.banner&&$window.AdMob.removeBanner()},forbidStates:function(states){service.forbiddenStates=service.forbiddenStates.concat(states)},prepareInterstitial:function(){service.options.interstitial?($log.info("init interstitial banner"),$window.AdMob.prepareInterstitial({adId:service.options.interstitial_id,autoShow:!1}),$rootScope.$on("$ionicView.enter",function(event,data){var canReloadBanner=!1;-1===service.forbiddenStates.indexOf(data.stateName)?(canReloadBanner=!0,service.viewEnterCount=service.viewEnterCount+1,service.viewEnterCount>=12&&(service.interstitialState="medium"),"show"===service.getWeight(service.interstitialWeights[service.interstitialState])?(document.addEventListener("onAdDismiss",service._reload),$window.AdMob.showInterstitial(),$window.AdMob.prepareInterstitial({adId:service.options.interstitial_id,autoShow:!1}),"start"===service.interstitialState?service.interstitialState="low":service.interstitialState="default",service.viewEnterCount=0):canReloadBanner&&service._reload()):service.removeBanner()})):$log.info("!ko init interstitial banner")},_reload:function(){service.loadBanner(),document.removeEventListener("onAdDismiss",service._reload)}};return service}),angular.module("starter").service("Analytics",function($pwaRequest,$session,$q,$rootScope,$log){var service={data:{},pool:[],storeInstallation:function(){var params={date:Math.round(Date.now()/1e3),OS:device.platform,OSVersion:device.version,Device:device.platform,DeviceVersion:device.model,deviceUUID:device.uuid,latitude:null,longitude:null};service.postData("_installation",params)},storeOpening:function(){var deferred=$q.defer(),params={date:Math.round(Date.now()/1e3),OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};return service.postData("_opening",params).then(function(result){deferred.resolve(result)}).catch(function(error){deferred.reject()}),deferred.promise},storeClosing:function(){if(void 0!==service.data.storeClosingId){var params={date:Math.round(Date.now()/1e3),id:service.data.storeClosingId};service.postData("_closing",params)}else $log.debug("aborting /analytics/mobile_store/closing, no id.")},storePageOpening:function(page){var params={date:Math.round(Date.now()/1e3),featureId:page.value_id,OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};service.postData("_pageopening",params)},storeProductOpening:function(product){var params={date:Math.round(Date.now()/1e3),productId:product.id,name:product.name,OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};service.postData("_productopening",params)},storeProductSold:function(products){var params={date:Math.round(Date.now()/1e3),products:products,OS:cordova.device?device.platform:"Browser",OSVersion:cordova.device?device.version:null,Device:cordova.device?device.platform:"Browser",DeviceVersion:cordova.device?device.model:null,deviceUUID:cordova.device?device.uuid:null,latitude:null,longitude:null,locale:CURRENT_LANGUAGE};service.postData("_productsold",params)},postData:function(url,params){if(!isOverview){var request={url:url,params:params};service.pool.length<10?(service.pool.push(request),$session.setItem("analytics_pool",service.pool)):$session.getItem("analytics_pool").then(function(pool){pool&&(service.pool=pool),service.pool.push(request),service.commitPool()})}return $pwaRequest.reject("Analytics are disabled in Overview!")},commitPool:function(){$pwaRequest.post("analytics/mobile_pool/submit",{data:service.pool,cache:!1,headers:{"Content-Type":"application/x-www-form-urlencoded"}}),$session.setItem("analytics_pool",[])}};return $session.getItem("analytics_pool").then(function(pool){pool&&(service.pool=pool),service.commitPool()}),service}),angular.module("starter").service("Application",function($pwaRequest,$q,$rootScope,$session,$timeout,$ionicPlatform,$window){var service={is_webview:!IS_NATIVE_APP,known_modules:{calendar:"Event",catalog:"Catalog",custom_page:"Cms",discount:"Discount",fanwall:"Newswall",form:"Form",music_gallery:"MusicPlaylist",newswall:"Newswall",places:"Places",push_notification:"Push",qr_discount:"Push",rss_feed:"Rss",set_meal:"SetMeal",social_gaming:"SocialGaming",twitter:"Twitter",video_gallery:"Videos",wordpress:"Wordpress"},lazyLoadCodes:{calendar:["event"],custom_page:["cms"],fanwall:["newswall"],music_gallery:["media"],places:["cms","places"],qr_discount:["discount"],rss_feed:["rss"],set_meal:["catalog"],video_gallery:["video"],push_notification:["push"]}},_loaded=!1,_loaded_resolver=$q.defer(),_ready=!1,_ready_resolver=$q.defer();return service.preLoad=function(pages){},Object.defineProperty(service,"loaded",{get:function(){return _loaded?$q.resolve():_loaded_resolver.promise},set:function(value){!0===(_loaded=!!value)&&_loaded_resolver.resolve()}}),Object.defineProperty(service,"ready",{get:function(){return _ready?$q.resolve():_ready_resolver.promise},set:function(value){!0===(_ready=!!value)&&_ready_resolver.resolve()}}),service.app_id=null,service.app_name=null,service.googlemaps_key=null,service.is_customizing_colors=$window.location.href.indexOf("application/mobile_customization_colors/")>=0,service.populate=function(data){service.app_id=data.application.id,service.app_name=data.application.name,service.privacyPolicy=data.application.privacyPolicy,service.gdpr=data.application.gdpr,service.googlemaps_key=data.application.gmapsKey,service.is_locked=data.application.is_locked,service.homepage_background=data.application.useHomepageBackground,service.backButton=data.application.backButton,service.backButtonClass=data.application.backButtonClass,service.leftToggleClass=data.application.leftToggleClass,service.rightToggleClass=data.application.rightToggleClass,service.myAccount=data.application.myAccount,service.default_background=data.homepageImage,service.colors=data.application.colors,service.ready=!0},service.reloadLocale=function(language){return $pwaRequest.post("front/app/translations",{data:{user_language:language},timeout:3e4,refresh:!0})},service.getBackIcon=function(){if(null!==service.backButtonClass)return service.backButtonClass;if(void 0!==service.backButton)switch(service.backButton){case"ion-android-arrow-back":case"ion-arrow-left-a":case"ion-arrow-left-b":case"ion-arrow-left-c":case"ion-arrow-return-left":case"ion-chevron-left":case"ion-home":case"ion-ios-arrow-back":case"ion-ios-arrow-left":case"ion-ios-arrow-thin-left":case"ion-ios-home-outline":case"ion-ios-home":case"ion-ios-undo-outline":case"ion-ios-undo":case"ion-reply":return"icon "+service.backButton;default:return"icon ion-ios-arrow-back"}return"icon ion-ios-arrow-back"},service.getLeftToggleIcon=function(){return null!==service.leftToggleClass?service.leftToggleClas:"icon ion-navicon-round"},service.getRightToggleIcon=function(){return null!==service.rightToggleClass?service.rightToggleClass:"icon ion-navicon-round"},service}),angular.module("starter").service("ContextualMenu",function($rootScope,$timeout,$q){var service={settings:{isReady:$q.defer(),isEnabled:!1,width:275,preferredSide:"right",templateUrl:null},reset:function(){},set:function(templateURL,width){service.init(templateURL,width)},init:function(templateUrl,width,preferredSide){-1!==["left","right",void 0].indexOf(preferredSide)?$timeout(function(){service.settings.isReady=$q.defer(),service.settings.isEnabled=!0,service.settings.templateUrl=templateUrl,service.settings.width=width,service.settings.preferredSide=void 0===preferredSide?service.settings.preferredSide:preferredSide,$rootScope.$broadcast("contextualMenu.init")}):console.error("ContextualMenu.init: invalid preferredSide, must be `left` or `right`.")},clear:function(){$timeout(function(){service.settings.isReady=$q.defer(),service.settings.isEnabled=!1,service.settings.templateUrl=null,service.settings.width=275,service.settings.preferredSide="right",$rootScope.$broadcast("contextualMenu.init")})},open:function(){service.settings.isReady.promise.then(function(){$timeout(function(){$rootScope.$broadcast("contextualMenu.open")},20)})},close:function(){service.settings.isReady.promise.then(function(){$rootScope.$broadcast("contextualMenu.close")})},toggle:function(){service.settings.isReady.promise.then(function(){$timeout(function(){$rootScope.$broadcast("contextualMenu.toggle")},20)})}};return service}),angular.module("starter").service("Country",function($pwaRequest,$q){var service={lastError:null,fetched:!1,countries:[],findAll:function(){var defer=$q.defer();return service.fetched?defer.resolve(service.countries):$pwaRequest.get("/application/mobile_country/findall").then(function(countries){service.countries=countries,service.fetched=!0,defer.resolve(service.countries)},function(error){defer.reject(error)}),defer.promise}};return service}),angular.module("starter").service("CropImage",function($rootScope,$q,$ionicPopup,$translate){var service={openPopup:function(url){var scope=$rootScope.$new(!0);scope.cropModal={original:url,result:null},scope.popupShowing=!1;var deferred=$q.defer();return $ionicPopup.show({template:'<div style="position: absolute"      class="cropper">    <img-crop ng-if="popupShowing"               image="cropModal.original"               result-image="cropModal.result"               area-type="square"               result-image-size="256"               result-image-format="image/jpeg"               result-image-quality="0.9"></img-crop></div>',cssClass:"avatar-crop",scope:scope,buttons:[{text:$translate.instant("Cancel"),type:"button-default",onTap:function(e){return!1}},{text:$translate.instant("OK"),type:"button-positive",onTap:function(e){return!0}}]}).then(function(result){result?deferred.resolve(scope.cropModal.result):deferred.reject()}),scope.popupShowing=!0,deferred.promise}};return service}),angular.module("starter").service("CustomTab",function(SB,LinkService){return{openLink:function(url,options){console.log("CustomTab.openLink",url,options),DEVICE_TYPE===SB.DEVICE.TYPE_BROWSER&&LinkService.openLink(url,options,!0),cordova&&cordova.plugins&&cordova.plugins.browsertab?cordova.plugins.browsertab.openUrl(url,options):console.error("Plugin BrowserTab is missing.")}}}),angular.module("starter").service("DatetimePicker",function($ocLazyLoad,$translate,$q){var service={loadedPromise:$q.defer(),defaults:{headers:!0,months:[$translate.instant("January","datepicker"),$translate.instant("February","datepicker"),$translate.instant("March","datepicker"),$translate.instant("April","datepicker"),$translate.instant("May","datepicker"),$translate.instant("June","datepicker"),$translate.instant("July","datepicker"),$translate.instant("September","datepicker"),$translate.instant("October","datepicker"),$translate.instant("November","datepicker"),$translate.instant("December","datepicker")],monthsShort:[$translate.instant("Jan.","datepicker"),$translate.instant("Feb.","datepicker"),$translate.instant("Mar.","datepicker"),$translate.instant("Apr.","datepicker"),$translate.instant("May.","datepicker"),$translate.instant("Jun.","datepicker"),$translate.instant("Jul.","datepicker"),$translate.instant("Sep.","datepicker"),$translate.instant("Oct.","datepicker"),$translate.instant("Nov.","datepicker"),$translate.instant("Dec.","datepicker")],weekDays:[$translate.instant("Sunday","datepicker"),$translate.instant("Monday","datepicker"),$translate.instant("Tuesday","datepicker"),$translate.instant("Wednesday","datepicker"),$translate.instant("Thursday","datepicker"),$translate.instant("Friday","datepicker"),$translate.instant("Saturday","datepicker")],weekDaysShort:[$translate.instant("Sun.","datepicker"),$translate.instant("Mon.","datepicker"),$translate.instant("Tue.","datepicker"),$translate.instant("Wed.","datepicker"),$translate.instant("Thu.","datepicker"),$translate.instant("Fri.","datepicker"),$translate.instant("Sat.","datepicker")],text:{title:$translate.instant("Pick a date and time","datepicker"),cancel:$translate.instant("Cancel","datepicker"),confirm:$translate.instant("OK","datepicker"),year:$translate.instant("Year","datepicker"),month:$translate.instant("Month","datepicker"),day:$translate.instant("Day","datepicker"),hour:$translate.instant("Hour","datepicker"),minute:$translate.instant("Minute","datepicker"),second:$translate.instant("Second","datepicker"),millisecond:$translate.instant("Millisecond","datepicker")}}};return $ocLazyLoad.load(["./dist/lazy/picker/picker.min.css","./dist/lazy/picker/picker.js"]).then(function(){Picker.setDefaults(service.defaults),service.loadedPromise.resolve()}),service.isLoaded=function(){return service.loadedPromise.promise},service}),angular.module("starter").service("Dialog",function($ionicPopup,$timeout,$translate,$q){var service={is_open:!1,stack:[],unStack:function(){service.is_open=!1,service.stack.length>=1&&$timeout(function(){var dialog=service.stack.shift();switch(dialog.type){case"alert":service.renderAlert(dialog.data);break;case"prompt":service.renderPrompt(dialog.data);break;case"confirm":service.renderConfirm(dialog.data);break;case"ionicPopup":service.renderIonicPopup(dialog.data)}},250)},alert:function(title,message,button,dismiss,context){var deferred=$q.defer();return service.stack.push({type:"alert",data:{title:title,message:message,button:button,dismiss:dismiss,context:context,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderAlert:function(data){service.is_open=!0;var alertPromise=null,message=$translate.instant(data.title),cssClass=""===data.title?"popup-no-title":"";if(alertPromise=$ionicPopup.alert({title:$translate.instant(data.title,data.context),template:$translate.instant(data.message,data.context),cssClass:cssClass,okText:$translate.instant(data.button,data.context)}),data.promise.resolve(alertPromise),alertPromise.then(function(){service.unStack()}),"number"==typeof data.dismiss){var duration=data.dismiss;-1===data.dismiss&&(duration=Math.min(Math.max(50*message.length,2e3),7e3)+400),$timeout(function(){alertPromise.close()},duration)}},prompt:function(title,message,type,value,buttonsArray,cssClass,context){var deferred=$q.defer(),localType=void 0===type?"text":type,localValue=void 0===value?"":value,localButtonsArray=void 0===buttonsArray?["OK","CANCEL"]:buttonsArray;return service.stack.push({type:"prompt",data:{title:title,message:message,type:localType,value:localValue,buttons_array:localButtonsArray,css_class:cssClass,context:context,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderPrompt:function(data){service.is_open=!0;var cssClass=""===data.title?"popup-no-title":"";return $ionicPopup.prompt({title:$translate.instant(data.title,data.context),template:$translate.instant(data.message,data.context),okText:$translate.instant(data.buttons_array[0],data.context),cancelText:$translate.instant(data.buttons_array[1],data.context),cssClass:cssClass,inputType:data.type,inputPlaceholder:$translate.instant(data.value,data.context)}).then(function(result){void 0===result?data.promise.reject(result):data.promise.resolve(result),service.unStack()})},confirm:function(title,message,buttonsArray,cssClass,context){var deferred=$q.defer();return service.stack.push({type:"confirm",data:{title:title,message:message,buttons_array:buttonsArray,css_class:cssClass,context:context,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderConfirm:function(data){service.is_open=!0;var cssClass=""===data.title?"popup-no-title":"";return $ionicPopup.confirm({title:$translate.instant(data.title,data.context),cssClass:data.css_class+" "+cssClass,template:$translate.instant(data.message,data.context),okText:$translate.instant(data.buttons_array[0],data.context),cancelText:$translate.instant(data.buttons_array[1],data.context)}).then(function(result){data.promise.resolve(result),service.unStack()})},ionicPopup:function(config){var deferred=$q.defer();return service.stack.push({type:"ionicPopup",data:{config:config,promise:deferred}}),1!==service.stack.length||service.is_open||service.unStack(),deferred.promise},renderIonicPopup:function(data){return service.is_open=!0,$ionicPopup.show(data.config).then(function(result){data.promise.resolve(result),service.unStack()})}};return service}),angular.module("starter").service("SafePopups",function(Dialog){var service={show:function(type,params){var button={};switch(type){case"alert":return 1===params.buttons.length&&(button=params.buttons[0]),Dialog.alert(params.title,params.template,button);case"confirm":return Dialog.confirm(params.title,params.template,params.buttons,"");default:return Dialog.ionicPopup(params)}}};return service}),angular.module("starter").service("FacebookConnect",function($cordovaOauth,$rootScope,$timeout,$window,$pwaRequest,Customer,Dialog,SB,Loader){var _this=this;return _this.app_id=null,_this.version="v2.7",_this.is_initialized=!1,_this.is_logged_in=!1,_this.access_token=null,_this.permissions=null,_this.fb_login=null,_this.login=function(){if(!$rootScope.isNotAvailableInOverview()){var scope=_this.permissions?_this.permissions.join(","):"",redirectUri=encodeURIComponent(DOMAIN+"/"+APP_KEY+"?login_fb=true"),fbLocation="https://graph.facebook.com/oauth/authorize?client_id="+_this.app_id+"&scope="+scope+"&response_type=token&redirect_uri=";if(DEVICE_TYPE===SB.DEVICE.TYPE_BROWSER)$window.location=fbLocation+redirectUri;else{Loader.show();var options={redirect_uri:"https://localhost/callback"};$pwaRequest.get(fbLocation+options.redirect_uri,{refresh:!0,cache:!1}).then(function(success){},function(error){options.redirect_uri="http://localhost/callback"}).then(function(){$cordovaOauth.facebook(_this.app_id,_this.permissions,options).then(function(result){Customer.loginWithFacebook(result.access_token).then(function(){Customer.login_modal.hide()}).finally(function(){Loader.hide()})},function(error){Dialog.alert("Login error",error,"OK",-1).then(function(){Customer.login_modal.hide(),Loader.hide()})})})}}},_this.logout=function(){_this.is_logged_in=!1,_this.access_token=null},$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$timeout(function(){_this.logout()})}),_this}),angular.module("starter").service("GoogleMaps",function($cordovaGeolocation,$location,$q,$rootScope,$translate,$window,Application){"use strict";var __self={is_loaded:!1,reset:function(){service.directionsRenderer&&(service.directionsRenderer.setPanel(null),service.directionsRenderer.setMap(null));for(var i=0;i<service.markers;i++)google.maps.event.removeListener(service.markers[i],"click"),service.markers[i].setMap(null);service.map=null,service.panel_id=null,service.directionsRenderer=null,service.markers=[],__self.is_loaded=!1},_calculateRoute:function(origin,destination,params,rejectWithResponseAndStatus){var deferred=$q.defer();_.isObject(params)||(params={mode:google.maps.DirectionsTravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC}),_.isObject(params.request)||(params.request={}),this.directionsService||(this.directionsService=new google.maps.DirectionsService);var request=_.merge({origin:new google.maps.LatLng(origin.latitude,origin.longitude),destination:new google.maps.LatLng(destination.latitude,destination.longitude),travelMode:params.mode,unitSystem:params.unitSystem},params.request);return this.directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK)deferred.resolve(response);else{var errorMessage=$translate.instant("ZERO_RESULTS"===status?"There is no route available with these informations.":"An unexpected error occurred while calculating the route.");console.error(errorMessage,status),!0===rejectWithResponseAndStatus?deferred.reject([response,status]):deferred.reject(errorMessage)}}),deferred.promise},_updateBoundsFromPoints:function(bounds,p){var latitude=parseFloat(p.latitude),longitude=parseFloat(p.longitude);return(null===bounds[0][0]||bounds[0][0]>latitude)&&(bounds[0][0]=latitude),(null===bounds[1][0]||bounds[1][0]<latitude)&&(bounds[1][0]=latitude),(null===bounds[0][1]||bounds[0][1]>longitude)&&(bounds[0][1]=longitude),(null===bounds[1][1]||bounds[1][1]<longitude)&&(bounds[1][1]=longitude),bounds},_extendBounds:function(bounds,margin){if(margin){var latitudeMargin=(bounds[1][0]-bounds[0][0])*margin;0===latitudeMargin&&(latitudeMargin=.02),bounds[0][0]-=latitudeMargin,bounds[1][0]+=latitudeMargin;var longitudeMargin=(bounds[1][1]-bounds[0][1])*margin;0===longitudeMargin&&(longitudeMargin=.01),bounds[0][1]-=longitudeMargin,bounds[1][1]+=longitudeMargin}return bounds}},gmap_callbacks=[],gmap_script_appended=!1,gmap_loaded=!1,_init_called=!1;$window.initGMapCallback=function(){if(gmap_script_appended)for(gmap_loaded=!0;gmap_callbacks.length>0;){var func=gmap_callbacks.shift();_.isFunction(func)&&func.apply($window,arguments)}};var service={USER_INTERACTED_EVENT:"GoogleMaps.UserInteracted",map:null,directionsRenderer:null,panel_id:null,markers:[],markerCluster:null,lastInfoWindow:null,init:function(){if("undefined"==typeof GoogleMaps&&!gmap_script_appended){if(_init_called)return;_init_called=!0,Application.loaded.then(function(){var google_maps=document.createElement("script");google_maps.type="text/javascript",google_maps.src="https://maps.googleapis.com/maps/api/js?libraries=geometry,places&key="+Application.googlemaps_key+"&callback=initGMapCallback",document.body.appendChild(google_maps),gmap_script_appended=!0})}gmap_loaded&&$window.initGMapCallback()},addCallback:function(func){gmap_callbacks.push(func),service.init()},createMap:function(element,options){angular.isObject(options)||(options={}),__self.is_loaded&&__self.reset(),options=_.merge({zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},options),service.map=new google.maps.Map(document.getElementById(element),options),google.maps.event.addListener(service.map,"tilesloaded",function(){console.log("Maps is loaded"),__self.is_loaded=!0});var userInteracted=function(event_name){return function(){$rootScope.$broadcast(service.USER_INTERACTED_EVENT,event_name)}};return google.maps.event.addListener(service.map,"dblclick",userInteracted("dblclick")),google.maps.event.addListener(service.map,"dragend",userInteracted("dragend")),google.maps.event.addDomListener(service.map.getDiv(),"mousewheel",userInteracted("wheel"),!0),google.maps.event.addDomListener(service.map.getDiv(),"DOMMouseScroll",userInteracted("wheel"),!0),service.map},setCenter:function(coordinates){if(coordinates){var center=new google.maps.LatLng(coordinates.latitude,coordinates.longitude);return service.map.setCenter(center)}return $cordovaGeolocation.getCurrentPosition().then(function(position){service.setCenter(position.coords)})},setPanelId:function(panel_id){service.panel_id=panel_id},isLoaded:function(){return __self.is_loaded},addCluster:function(){service.markerCluster=new MarkerClusterer(service.map,service.markers,{maxZoom:16,minimumClusterSize:3,imagePath:"./img/cluster/m"})},addMarker:function(marker,index){var latlng=new google.maps.LatLng(marker.latitude,marker.longitude),icon=null;if(marker.icon&&marker.icon.url){var width=marker.icon.width?marker.icon.width:95,height=marker.icon.height?marker.icon.height:49;icon={url:marker.icon.url,scaledSize:new google.maps.Size(width,height)}}var options=_.merge({position:latlng,map:service.map,icon:icon},marker.markerOptions),mapMarker=new google.maps.Marker(options);return mapMarker.onClick=marker.onClick,mapMarker.config=marker.config,_.isFunction(marker.onClick)&&google.maps.event.addListener(mapMarker,"click",function(){mapMarker.onClick(mapMarker)}),marker.is_centered&&service.setCenter(marker),+index<0?service.markers.push(mapMarker):service.markers.splice(index,0,mapMarker),mapMarker},removeMarker:function(mapMarker){var index=service.markers.indexOf(mapMarker);return index>=0&&(service.markers[index].setMap(null),service.markers.splice(index,1),!0)},replaceMarker:function(mapMarker,marker){return!!service.removeMarker(mapMarker)&&service.addMarker(marker)},addRoute:function(route,custom_directions_renderer,custom_panel_div_id){var renderer=null;_.isObject(custom_directions_renderer)&&_.isFunction(custom_directions_renderer.setDirections)?renderer=custom_directions_renderer:(service.directionsRenderer||(service.directionsRenderer=new google.maps.DirectionsRenderer),renderer=service.directionsRenderer),renderer.setMap(service.map),renderer.setDirections(route);var panelDiv=document.getElementById(custom_panel_div_id||service.panel_id);panelDiv&&renderer.setPanel(panelDiv)},fitToBounds:function(bounds){var sw=new google.maps.LatLng(bounds.latitudeMin,bounds.longitudeMin),ne=new google.maps.LatLng(bounds.latitudeMax,bounds.longitudeMax),mapBounds=new google.maps.LatLngBounds(sw,ne);service.map.fitBounds(mapBounds)},geocode:function(address){var deferred=$q.defer();return this.geocoder||(this.geocoder=new google.maps.Geocoder),this.geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();deferred.resolve({latitude:latitude,longitude:longitude})}else{var errorMessage=$translate.instant("The address you're looking for does not exist.");console.error(errorMessage),deferred.reject(errorMessage)}}),deferred.promise},reverseGeocode:function(position){var deferred=$q.defer();this.geocoder||(this.geocoder=new google.maps.Geocoder);var latlng={lat:position.latitude,lng:position.longitude};return this.geocoder.geocode({location:latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK)deferred.resolve(results);else{var errorMessage=$translate.instant("The address you're looking for does not exists.");deferred.reject(errorMessage)}}),deferred.promise},calculateRoute:function(origin,destination,params,rejectWithResponseAndStatus){var deferred=$q.defer();return origin?__self._calculateRoute(origin,destination,params,rejectWithResponseAndStatus).then(function(route){deferred.resolve(route)},function(err){deferred.reject(err)}):$cordovaGeolocation.getCurrentPosition().then(function(position){__self._calculateRoute(position.coords,destination,params,rejectWithResponseAndStatus).then(function(route){deferred.resolve(route)},function(err){deferred.reject(err)})},function(err){angular.isObject(err)&&1===err.code&&angular.isString(err.message)&&err.message.indexOf("secure origin")&&deferred.reject("Your location could not be found because your application doesn't use SSL."),deferred.reject("gps_disabled")}),deferred.promise},getBoundsFromPoints:function(points,margin){if(points){var bounds=[[null,null],[null,null]];return points.reduce(function(output,p){return p.latitude||console.warn("Invalid latitude."),p.longitude||console.warn("Invalid longitude."),bounds=__self._updateBoundsFromPoints(bounds,p),output},[]),0!==points.length&&margin&&(bounds=__self._extendBounds(bounds,margin)),{latitudeMin:bounds[0][0],latitudeMax:bounds[1][0],longitudeMin:bounds[0][1],longitudeMax:bounds[1][1]}}return null}},ready=!1,readyResolver=$q.defer();return Object.defineProperty(service,"ready",{get:function(){return ready?$q.resolve():readyResolver.promise},set:function(value){!0===(ready=!!value)&&readyResolver.resolve()}}),service.init(),service}),angular.module("starter").service("InAppLinks",function($rootScope,$state,$injector,$ocLazyLoad,Customer,Codescan,Dialog,Pages){var service={parseEvent:function(event){if(0!==event.data.indexOf("state-go"))return!1;var parts=event.data.split("="),action=parts[0],params={};return parts.length>=2&&(action=parts[0],(params=parts[1].replace(/(^\?)/,"").split(",").map(function(n){return this[(n=n.split(":"))[0].trim()]=n[1],this}.bind({}))[0]).action=action),params.offline=void 0!==params.offline&&"true"===params.offline,params},parseElement:function(element){var params=element.attributes["data-params"].value;return(params=params.replace(/(^\?)/,"").split(",").map(function(n){return this[(n=n.split(":"))[0].trim()]=n[1],this}.bind({}))[0]).state=element.attributes["data-state"].value,params.offline=void 0!==element.attributes["data-offline"]&&"true"===element.attributes["data-offline"].value,params},action:function(params){if("my-account"===params.state)Customer.loginModal();else if("codescan"===params.state)Codescan.scanGeneric();else if(!params.offline&&$rootScope.isOffline)$rootScope.isNotAvailableOffline();else{if(params.hasOwnProperty("value_id")){var feature=Pages.getValueId(params.value_id);if(feature&&!feature.is_active)return void Dialog.alert("Error","This feature is no longer available.","OK",2350);if(feature.hasOwnProperty("open_callback_class")&&null!==feature.open_callback_class){try{$ocLazyLoad.load(feature.lazy_load.split(",")).then(function(){$injector.get(feature.open_callback_class).openCallback(feature)},function(){Dialog.alert("Error","This feature is no longer available.","OK",2350)})}catch(e){Dialog.alert("Error","This feature is no longer available.","OK",2350)}return}}$state.go(params.state,params)}},handlerGlobal:function(event){var params=service.parseEvent(event);!1!==params&&service.action(params)},handlerLink:function(element){var params=service.parseElement(element);angular.element(element).bind("click",function(e){e.preventDefault(),service.action(params)})},listen:function(){var eventMethod=window.addEventListener?"addEventListener":"attachEvent";(0,window[eventMethod])("attachEvent"===eventMethod?"onmessage":"message",service.handlerGlobal,!1)}};return service}),angular.module("starter").service("layout_10",function($rootScope){var service={getTemplate:function(){return"templates/home/l10/view.html"},getModalTemplate:function(){return"templates/home/l10/modal.html"},onResize:function(){},features:function(features,moreButton){var thirdOption=features.overview.options[2],fourthOption=features.overview.options[3];return features.overview.options[2]=moreButton,features.overview.options[3]=thirdOption,features.overview.options[4]=fourthOption,features.options=features.options.slice(4,features.options.length),features}};return service}),angular.module("starter").service("layout_17",function($rootScope,$location,$timeout){var service={getTemplate:function(){return"templates/home/l17/view.html"},getModalTemplate:function(){return"templates/home/modal/view.html"},onResize:function(){$timeout(function(){service._resize(),$timeout(function(){service._resize()},500)},100)},features:function(features,more_button){var i,j,temparray,more_options=features.options.slice(12),chunks=[];for(i=0,j=more_options.length;i<j;i+=2)temparray=more_options.slice(i,i+2),chunks.push(temparray);return features.chunks=chunks,features},_resize:function(){var scrollview=document.getElementById("metro-scroll");if(scrollview&&(scrollview.style.display="block"),document.getElementById("metro-scroll")&&document.getElementById("metro-line-2")){var spacing=document.getElementById("metro-scroll").getBoundingClientRect().width/100*2.5,element=document.getElementById("metro-line-2");if(element){var positionInfo=element.getBoundingClientRect();element.style.height=(positionInfo.width-spacing)/4+"px"}for(var lines=document.getElementsByClassName("metro-line"),i=0;i<lines.length;i++)lines[i].style.marginBottom=spacing+"px"}}};return service}),angular.module("starter").service("layout_8",function(){var service={getTemplate:function(){return"templates/home/l8/view.html"},getModalTemplate:function(){return"templates/home/modal/view.html"},onResize:function(){},features:function(features,more_button){var first_option=null,options=[];return 0!==features.options.length&&(first_option=features.options[0],options=features.options.slice(1)),features.first_option=first_option,features.options=options,features}};return service}),angular.module("starter").service("Lightbox",function($ocLazyLoad,$q){var service={loadedPromise:$q.defer(),defaults:{captions:!0,buttons:"auto",fullScreen:!1,noScrollbars:!0,animation:"slideIn"}};return $ocLazyLoad.load(["./dist/lazy/baguette/baguetteBox.min.css","./dist/lazy/baguette/baguetteBox.min.js"]).then(function(){service.loadedPromise.resolve()}),service.isLoaded=function(){return service.loadedPromise.promise},service.run=function(container,options){service.isLoaded().then(function(){baguetteBox.run(container,angular.extend({},service.defaults,options))})},service}),angular.module("starter").service("LinkService",function($rootScope,$translate,$window,SB){return{openLink:function(url,options,external_browser){var supportedOptions=["location","hidden","beforeload","clearcache","clearsessioncache","closebuttoncaption","closebuttoncolor","footer","footercolor","hardwareback","hidenavigationbuttons","hideurlbar","navigationbuttoncolor","toolbarcolor","lefttoright","zoom","mediaPlaybackRequiresUserAction","shouldPauseOnSuspend","useWideViewPort","cleardata","disallowoverscroll","toolbar","toolbartranslucent","lefttoright","enableViewportScale","allowInlineMediaPlayback","keyboardDisplayRequiresUserAction","suppressesIncrementalRendering","presentationstyle","transitionstyle","toolbarposition","hidespinner"],inAppBrowserOptions=[],testMedia=function(url){return/.*\.(pdf|mp3|wav|mp4|avi)($|\?)/.test(url)},testTelSms=function(url){return/^(tel|sms|whatsapp):.*/.test(url)};void 0===options&&(options={global:{},android:{},ios:{}});var _globalOptions=options.global,_deviceOptions={};try{switch(DEVICE_TYPE){case SB.DEVICE.TYPE_ANDROID:_deviceOptions=options.android;break;case SB.DEVICE.TYPE_IOS:_deviceOptions=options.ios}}catch(e){_deviceOptions={}}var _options=angular.extend({},{toolbarcolor:$window.colors.header.backgroundColorHex,location:"no",toolbar:"yes",zoom:"no",enableViewPortScale:"yes",closebuttoncaption:$translate.instant("Done"),transitionstyle:"crossdissolve"},_deviceOptions),_external_browser=void 0!==external_browser&&external_browser,_custom_tab=!1;if(_globalOptions&&_globalOptions.browser)switch(_globalOptions.browser){case"in_app_browser":!0;break;case"custom_tab":_custom_tab=!0;break;case"external_browser":_external_browser=!0}for(var key in _options)if(supportedOptions.indexOf(key)>-1){var value=_options[key];inAppBrowserOptions.push(key+"="+value)}var finalOptions=inAppBrowserOptions.join(","),customTabOptions={tabColor:$window.colors.header.backgroundColorHex,secondaryToolbarColor:$window.colors.header.backgroundColorHex,showTitle:!0,instantAppsEnabled:!1,enableUrlBarHiding:!1,selectBrowser:!1};return isOverview?testTelSms(url)?window.open(url):testMedia(url)||_external_browser||_custom_tab?parent.window.open(url,"link-service-popup","width=480,height=800"):cordova.InAppBrowser.open(url,"_blank","location=yes"):DEVICE_TYPE===SB.DEVICE.TYPE_BROWSER?testTelSms(url)?window.open(url):testMedia(url)||_external_browser||_custom_tab?window.open(url,"_system","width=480,height=800"):cordova.InAppBrowser.open(url,"_blank","location=yes"):DEVICE_TYPE===SB.DEVICE.TYPE_ANDROID?testMedia(url)||testTelSms(url)?cordova.InAppBrowser.open(url,"_system",""):_external_browser?cordova.InAppBrowser.open(url,"_system","location=yes"):_custom_tab?cordova.plugins.browsertab.openUrl(url,customTabOptions):cordova.InAppBrowser.open(url,"_blank",finalOptions):DEVICE_TYPE===SB.DEVICE.TYPE_IOS?testMedia(url)||testTelSms(url)?cordova.InAppBrowser.open(url,"_system",""):_external_browser?cordova.InAppBrowser.open(url,"_system","location=yes"):_custom_tab?cordova.plugins.browsertab.openUrl(url,customTabOptions):cordova.InAppBrowser.open(url,"_blank",finalOptions):cordova.InAppBrowser.open(url,"_blank",finalOptions)}}}),angular.module("starter").service("Loader",function($ionicLoading,$translate,$state,$timeout,Dialog){var service={is_open:!1,promise:null,timeout:null,keep_timeout:!1,timeout_count:0,absolute_timeout:null,callTimeout:function(){service.timeout=$timeout(function(){service.timeout_count=service.timeout_count+1,service.keep_timeout=!0;var buttons=["Go back home","Continue"];service.timeout_count>=2&&(service.keep_timeout=!1,buttons=["Go back home"]),service.hide(),Dialog.confirm("Feature timeout","It seems the feature your are trying to load is taking too much time!<br />Would you like to continue?",buttons).then(function(result){result||service.timeout_count>=2?(service.keep_timeout=!1,service.hide(),$state.go("home")):(service.show(),service.callTimeout())})},1e3)},show:function(text,config,replace){if(void 0===replace&&(replace=!1),!service.is_open){service.is_open=!0;var template='<ion-spinner class="spinner-custom"></ion-spinner>';void 0!==text&&(template=replace?$translate.instant(text):'<ion-spinner class="spinner-custom"></ion-spinner><br /><span>'+$translate.instant(text)+"</span>");var localConfig=angular.extend({template:template},config);service.promise=$ionicLoading.show(localConfig),service.timeout_count=0,!0===service.keep_timeout&&service.callTimeout(),service.startAbsoluteTimeout()}return service.promise},startAbsoluteTimeout:function(){service.absolute_timeout=$timeout(function(){service.hide()},3e4)},clearAbsoluteTimeout:function(){null!==service.absolute_timeout&&($timeout.cancel(service.absolute_timeout),service.absolute_timeout=null)},hide:function(){return service.is_open=!1,!1===service.keep_timeout&&null!==service.timeout&&($timeout.cancel(service.timeout),service.timeout=null,service.timeout_count=0),service.clearAbsoluteTimeout(),$ionicLoading.hide()}};return service}),angular.module("starter").service("Location",function($rootScope,$cordovaGeolocation,$q,Dialog,Loader){var service={PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3,debug:!1,lastFetch:null,position:null,isEnabled:!0,getLocation:function(config,force){var deferred=$q.defer(),isResolved=!1,localForce=void 0!==force,localConfig=angular.extend({enableHighAccuracy:!0,timeout:1e4,maximumAge:0},config),localRequestLocation=function(deferred){!localForce&&null!==service.lastFetch&&service.lastFetch+42e3>Date.now()&&(deferred.resolve(service.position),isResolved=!0),$cordovaGeolocation.getCurrentPosition(localConfig).then(function(position){service.lastFetch=Date.now(),service.position=position,service.debug&&console.log("position ok",position),isResolved||deferred.resolve(service.position)},function(error){service.debug&&console.log("position ko"),error.code!==service.TIMEOUT&&error.code!==service.PERMISSION_DENIED&&error.code!==service.POSITION_UNAVAILABLE||localReject(deferred),isResolved||deferred.reject()})},localReject=function(deferred){service.isEnabled=!1,deferred.reject()};if(!1===service.isEnabled)service.debug&&console.log("service disabled"),deferred.reject();else if(void 0!==cordova.plugins.permissions){var permissions=cordova.plugins.permissions;permissions.checkPermission(permissions.ACCESS_FINE_LOCATION,function(status){status.hasPermission?localRequestLocation(deferred):permissions.requestPermission(permissions.ACCESS_FINE_LOCATION,function(success){localRequestLocation(deferred)},function(error){localReject(deferred)})},function(error){permissions.requestPermission(permissions.ACCESS_FINE_LOCATION,function(success){localRequestLocation(deferred)},function(error){localReject(deferred)})})}else localRequestLocation(deferred);return deferred.promise},requestPermission:function(){var deferred=$q.defer();if(void 0!==cordova.plugins.permissions){var permissions=cordova.plugins.permissions;permissions.checkPermission(permissions.ACCESS_FINE_LOCATION,function(status){status.hasPermission||permissions.requestPermission(permissions.ACCESS_FINE_LOCATION,function(success){service.isEnabled=!0,deferred.resolve(service.position)},function(error){service.isEnabled=!1,deferred.reject()})},function(error){permissions.requestPermission(permissions.ACCESS_FINE_LOCATION,function(success){service.isEnabled=!0,deferred.resolve(service.position)},function(error){service.isEnabled=!1,deferred.reject()})})}else deferred.reject();return deferred.promise},requestLocation:function(success,error){Dialog.confirm("Error","We were unable to request your location.<br />Please check that the application is allowed to use the GPS and that your device GPS is on.",["TRY AGAIN","DISMISS"],-1,"location").then(function(success){success&&(service.isEnabled=!0,Loader.show(),service.getLocation({timeout:3e4,enableHighAccuracy:!1},!0).then(function(payload){if($rootScope.$broadcast("location.request.success"),Loader.hide(),Dialog.alert("Success","We finally got you location","OK",2350,"location"),success&&"function"==typeof success)try{success()}catch(e){}},function(){if($rootScope.$broadcast("location.request.error"),Loader.hide(),Dialog.alert("Error","We were unable to request your location.<br />Please check that the application is allowed to use the GPS and that your device GPS is on.","OK",3700,"location"),error&&"function"==typeof error)try{error()}catch(e){}}))})},getLatest:function(){var deferred=$q.defer();return null===service.lastFetch?service.getLocation().then(function(position){deferred.resolve(position)},function(){deferred.reject(!1)}):deferred.resolve(service.position),deferred.promise}};return service}),angular.module("starter").service("MediaPlayer",function($interval,$rootScope,$stateParams,$timeout,$translate,$window,Dialog,Modal,SB){var service={media:null,transAudio:null,isInitialized:!1,isMinimized:!0,isPlaying:!1,isRadio:!1,isShuffling:!1,repeatType:"playlist",tracks:[],currentIndex:0,currentTrack:null,currentTab:"cover",isBuffering:!1,listenEvents:!0,calledReset:!1,isPrev:!1,isNext:!1,isStop:!1,isSelecting:!1,duration:0,elapsedTime:0,playerModal:null,playerModalIsOpen:!1,value_id:null,decodeCallback:function(result){try{return JSON.parse(result)}catch(e){if(-1!==e.message.indexOf("Unexpected token"))return result}return result},blankListener:function(event){},musicControlsEventsHandler:function(event){var response=service.decodeCallback(event);switch(response.message){case"music-controls-next":service.isRadio||service.next();break;case"music-controls-previous":service.isRadio||service.prev();break;case"music-controls-pause":case"music-controls-play":case"music-controls-media-button":case"music-controls-toggle-play-pause":service.playPause();break;case"music-controls-destroy":service.reset();break;case"music-controls-seek-to":const seekToInSeconds=response.position;MusicControls.updateElapsed({elapsed:seekToInSeconds,isPlaying:!0})}},mediaNativeChangeCallback:function(change){if(console.log("mediaNativeChangeCallback",change),service.listenEvents){var response=service.decodeCallback(change);MediaNative.MEDIA_STOPPED!==parseInt(response,10)||service.calledReset||service.isPrev||service.isNext||service.isStop||service.isSelecting?null!==service.media&&service.media.getDuration(function(){service.duration=service.media._duration},function(){}):service.next()}},mediaNativeErrorCallback:function(error){if(service.listenEvents){var response=service.decodeCallback(error);try{switch(parseInt(response,10)){case MediaError.MEDIA_ERR_NONE_ACTIVE:break;case MediaError.MEDIA_ERR_ABORTED:Dialog.alert("Error","Media playing was aborted.","OK",-1,"media");break;case MediaError.MEDIA_ERR_NETWORK:Dialog.alert("Error","A network error occurred while loading the media.","OK",-1,"media");break;case MediaError.MEDIA_ERR_DECODE:Dialog.alert("Error","Unable to decode this media type.","OK",-1,"media");break;case MediaError.MEDIA_ERR_NONE_SUPPORTED:Dialog.alert("Error","This media type is not supported.","OK",-1,"media");break;case MediaError.MEDIA_ERR_PLAY_REJECT:Dialog.alert("Error","Tap to continue playing.","OK",-1,"media").then(function(){service.play()})}}catch(e){}}},mediaNativeSuccessCallback:function(success){console.log("mediaNativeSuccessCallback",success)},init:function(tracksLoader,isRadio,trackIndex){(service.value_id!==$stateParams.value_id||service.media&&service.currentTrack.streamUrl!==tracksLoader.tracks[trackIndex].streamUrl)&&service.reset(),service._initCallback(tracksLoader,isRadio,trackIndex)},_initCallback:function(tracksLoader,isRadio,trackIndex){service.media||(service.value_id=$stateParams.value_id,service.isRadio=isRadio,service.currentIndex=trackIndex,$rootScope.$broadcast(SB.EVENTS.MEDIA_PLAYER.SHOW,{isRadio:service.isRadio}),tracksLoader&&(service.tracks=tracksLoader.tracks)),service.openPlayer()},play:function(){service.media&&(service.isPlaying=!0,service.media.play(),service.updateSeekBar(),service.updateMusicControls())},pause:function(){service.media&&(service.isPlaying=!1,service.cancelSeekBar(),service.media.pause(),MusicControls.updateIsPlaying(service.isPlaying))},stop:function(){service.media&&(service.isPlaying=!1,service.isStop=!0,service.cancelSeekBar(),service.media.stop(),MusicControls.updateIsPlaying(service.isPlaying))},preStart:function(){try{!0===DISABLE_BATTERY_OPTIMIZATION&&MusicControls.disableBatteryOptimization()}catch(e){}service.pause(),service.duration=0,service.elapsedTime=0,service.isMediaLoaded=!1,service.isMediaStopped=!1},start:function(){service.currentTrack=service.tracks[service.currentIndex],-1!==service.currentTrack.streamUrl.indexOf("http://")||-1!==service.currentTrack.streamUrl.indexOf("https://")?(service.currentTrack.albumCover&&(service.currentTrack.albumCover=service.currentTrack.albumCover.replace("100x100bb",$window.innerWidth+"x"+$window.innerWidth+"bb")),service.media&&(service.stop(),service.media.release()),service.media=new MediaNative({src:service.currentTrack.streamUrl,isStream:service.isRadio?1:0},service.mediaNativeSuccessCallback,service.mediaNativeErrorCallback,service.mediaNativeChangeCallback),SB.DEVICE.TYPE_BROWSER===DEVICE_TYPE?(service.isNext||service.isPrev||service.isSelecting)&&service.play():service.play(),service.calledReset=!1,service.isPrev=!1,service.isNext=!1,service.isStop=!1,service.isSelecting=!1):Dialog.alert("Error","No current media to load.","OK",-1)},reset:function(){service.calledReset=!0,$interval.cancel(service.seekbarTimer),MusicControls.subscribe(service.blankListener),service._releaseMediaPlayer(),MusicControls.destroy()},_releaseMediaPlayer:function(){service.media&&(service.pause(),service.stop(),service.media.release()),service.media=null,service.seekbarTimer=null,service.isShuffling=!1,service.isInitialized=!1,$rootScope.$broadcast(SB.EVENTS.MEDIA_PLAYER.HIDE),null!==service.playerModal&&(service.playerModal.remove(),service.playerModal=null,service.playerModalIsOpen=!1),service.repeatType="playlist",service.currentIndex=0,service.currentTrack=null},openPlayer:function(){service.isInitialized||null!==service.playerModal?service.openPlayerModal("cover"):Modal.fromTemplateUrl("templates/media/music/l1/player/modal/player.html",{scope:angular.extend($rootScope.$new(!0),{close:service.closePlayerModal})}).then(function(modal){service.isInitialized=!0,service.playerModal=modal,service.media||$timeout(function(){service.preStart(),service.start()},1e3),service.openPlayerModal("cover")})},openPlayerModal:function(tab){service.currentTab=void 0===tab?"cover":tab,service.isRadio&&(service.currentTab="cover"),service.playerModal&&service.playerModal.isShown()||null!==service.playerModal&&(service.playerModal.show(),service.playerModalIsOpen=!0)},closePlayerModal:function(){service.playerModal&&!service.playerModal.isShown()||null!==service.playerModal&&(service.playerModal.hide(),service.playerModalIsOpen=!1)},playPause:function(){service.isPlaying?service.pause():service.play()},selectTrack:function(index){service.currentTab="cover",service.isSelecting=!0,service.currentIndex=index,service.preStart(),service.start()},hasPrev:function(){return!service.isRadio&&0!==service.currentIndex},prev:function(){if(!service.isRadio)if("one"!==service.repeatType){if(service.isPrev=!0,service.isShuffling)service._randomSong();else if("playlist"===service.repeatType){if(service.currentIndex--,service.currentIndex<0)return service.currentIndex=0,service.pause(),void(service.isPrev=!1)}else"loop"===service.repeatType&&(service.currentIndex--,service.currentIndex<0&&(service.currentIndex=service.tracks.length-1));service.preStart(),service.start()}else service.seekTo(0)},hasNext:function(){return!service.isRadio&&service.currentIndex!==service.tracks.length-1},next:function(){service.isRadio||("one"!==service.repeatType?(service.isNext=!0,service.isShuffling?service._randomSong():"playlist"===service.repeatType?(service.currentIndex++,service.currentIndex>=service.tracks.length&&(service.currentIndex=0)):"loop"===service.repeatType&&(service.currentIndex++,service.currentIndex>=service.tracks.length&&(service.currentIndex=0)),service.preStart(),service.start()):service.seekTo(0))},_randomSong:function(){var randomIndex=-1;do{randomIndex=Math.floor(Math.random()*service.tracks.length)}while(randomIndex===service.currentIndex);service.currentIndex=randomIndex},backward:function(){var localSeekto=service.elapsedTime-10;localSeekto<0?service.prev():service.elapsedTime=localSeekto,service.seekTo(service.elapsedTime)},forward:function(){var localSeekto=service.elapsedTime+10;localSeekto>service.media.duration?service.next():service.elapsedTime=localSeekto,service.seekTo(service.elapsedTime)},seekTo:function(position){0===position&&service.pause(),service.media.seekTo(1e3*position),service.isPlaying||service.playPause()},repeat:function(){switch(service.repeatType){case"playlist":service.repeatType="loop";break;case"loop":service.repeatType="one",service.isShuffling=!1;break;case"one":service.repeatType="playlist"}},shuffle:function(){service.isShuffling=!service.isShuffling,service.isShuffling&&(service.repeatType="loop")},updateMusicControls:function(){var hasPrev=0!==service.currentIndex,hasNext=service.currentIndex!==service.tracks.length-1;service.media.getCurrentPosition(function(){},function(){});var mcDictionnary={track:service.currentTrack.name,artist:service.currentTrack.artistName,cover:service.currentTrack.albumCover,isPlaying:!0,dismissable:!0,hasPrev:hasPrev,hasNext:hasNext,hasClose:!0,album:service.currentTrack.albumName,duration:service&&service.media&&service.media._duration?1*service.media._duration:0,elapsed:service&&service.media&&service.media._position?1*service.media._position:0,ticker:$translate.instant("Now playing","media")+" "+service.currentTrack.name};MusicControls.subscribe(service.musicControlsEventsHandler),MusicControls.listen(),$timeout(function(){MusicControls.create(mcDictionnary,function(){MusicControls.updateIsPlaying(service.isPlaying)},function(){})},20)},cancelSeekBar:function(){$interval.cancel(service.seekbarTimer)},updateSeekBar:function(){service.lastTime=-.001,service.cancelSeekBar(),service.seekbarTimer=$interval(function(){try{service.media.getCurrentPosition(function(success){service.media&&(service.elapsedTime=service.media._position,-.001===service.media._position||service.lastTime===service.media._position?service.isBuffering=!0:(service.lastTime=service.media._position,service.isBuffering=!1))},function(error){service.cancelSeekBar(),service.next()})}catch(e){service.cancelSeekBar()}},500)}};return service}),angular.module("starter").service("ModalScrollDelegate",function($ionicScrollDelegate){return{$getByHandle:function(name){return $ionicScrollDelegate.$getByHandle(name)._instances.filter(function(element){return element.$$delegateHandle==name})[0]}}}),angular.module("starter").service("Modal",function($ionicModal,$timeout,$q){var service={stack:[],current_modal:null,unStack:function(){service.stack.length>=1?$timeout(function(){var modal=service.stack.shift();switch(modal.type){case"fromTemplateUrl":service.renderFromTemplateUrl(modal.data);break;case"fromTemplate":service.renderFromTemplate(modal.data)}},1):service.current_modal=null},fromTemplateUrl:function(templateUrl,config){var deferred=$q.defer();return service.stack.push({type:"fromTemplateUrl",data:{templateUrl:templateUrl,config:config,promise:deferred}}),service.unStack(),deferred.promise},renderFromTemplateUrl:function(data){return $ionicModal.fromTemplateUrl(data.templateUrl,data.config).then(function(modal){service.current_modal=modal,data.promise.resolve(modal)})},fromTemplate:function(template,config){var deferred=$q.defer();return service.stack.push({type:"fromTemplate",data:{template:template,config:config,promise:deferred}}),service.unStack(),deferred.promise},renderFromTemplate:function(data){return $ionicModal.fromTemplate(data.template,data.config).then(function(modal){service.current_modal=modal,data.promise.resolve(modal)})}};return service}),angular.module("starter").service("MusicTracksLoader",function($q,$stateParams,MusicTrack){MusicTrack.value_id=$stateParams.value_id;var service={_filterDuplicatedAlbums:function(albums,albumsIds){return albumsIds||(albumsIds=[]),albums=albums.reduce(function(albums,album){return-1===albumsIds.indexOf(album.id)&&(albumsIds.push(album.id),albums.push(album)),albums},[])},loadTracksFromAlbums:function(albums){var deferred=$q.defer();albums=service._filterDuplicatedAlbums(albums,[]);var tracksLoader=service._buildTracksLoader(albums);return deferred.resolve(service.readNextTracks(tracksLoader,50)),deferred.promise},loadTracksFromPlaylists:function(playlists){var deferred=$q.defer(),albumsIds=[],albums=playlists.reduce(function(albums,playlist){var playlistAlbums=service._filterDuplicatedAlbums(playlist.albums,albumsIds);return albums=albums.concat(playlistAlbums)},[]),tracksLoader=service._buildTracksLoader(albums);return deferred.resolve(service.readNextTracks(tracksLoader,50)),deferred.promise},_buildTracksLoader:function(albums){return{albums:albums,tracks:[],albumsLoaded:0,errorOccured:!1,fullyLoaded:function(){return this.errorOccured||this.albums.length===this.albumsLoaded},loadMore:function(quantity){return service.readNextTracks(this,quantity)}}},_buildTracksLoaderForSingleAlbum:function(album,tracks){var tracksLoader=service._buildTracksLoader([album]);return tracksLoader.tracks=tracks,tracksLoader.albumsLoaded=1,tracksLoader},loadSingleTrack:function(track){var tracksLoader=service._buildTracksLoader([]);return tracksLoader.tracks=[track],tracksLoader.albumsLoaded=0,tracksLoader},readNextTracks:function(tracksLoader,quantityToLoad){return service.readNextTracksRecursive([],tracksLoader,quantityToLoad)},readNextTracksRecursive:function(tracksLoaded,tracksLoader,quantityToLoad){var deferred=$q.defer(),maxAlbumsToLoadAtOnce=Math.ceil((quantityToLoad-tracksLoaded.length)/15);return 0===maxAlbumsToLoadAtOnce&&(maxAlbumsToLoadAtOnce=1),service.readNextAlbumsTracks(tracksLoader,maxAlbumsToLoadAtOnce).then(function(result){tracksLoaded=tracksLoaded.concat(result.tracksLoaded),!tracksLoader.fullyLoaded()&&tracksLoaded.length<quantityToLoad?deferred.resolve(service.readNextTracksRecursive(tracksLoaded,tracksLoader,quantityToLoad,maxAlbumsToLoadAtOnce)):deferred.resolve({tracksLoader:tracksLoader,tracksLoaded:tracksLoaded})},function(err){console.error("Error while loading tracks.",err),deferred.reject(err),tracksLoader.errorOccured=!0}),deferred.promise},readNextAlbumsTracks:function(tracksLoader,maxAlbumsToLoad){for(var deferred=$q.defer(),promises=[],i=0;i<maxAlbumsToLoad&&!tracksLoader.fullyLoaded();i++,tracksLoader.albumsLoaded++){var album=tracksLoader.albums[tracksLoader.albumsLoaded],param={};"album"==album.element?param.album_id=album.id:param.track_id=album.id,promises.push(MusicTrack.findByAlbum(param))}try{$q.all(promises).then(function(tracksResponses){var tracksLoaded=tracksResponses.reduce(function(tracks,tracksResponse){return tracks=tracks.concat(tracksResponse.tracks)},[]);tracksLoader.tracks=tracksLoader.tracks.concat(tracksLoaded),deferred.resolve({tracksLoader:tracksLoader,tracksLoaded:tracksLoaded})},function(err){console.error("Error while loading tracks.",err),deferred.reject(err)}).finally(function(){})}catch(e){console.error(e.message)}return deferred.promise}};return service}),angular.module("starter").service("Picture",function($cordovaCamera,$ionicActionSheet,$q,$rootScope,$translate,Dialog,SB){var service={isOpen:!1,sheetResolver:null,stack:[],takePicture:function(width,height,quality){if(service.isOpen)return $q.reject();if(void 0===Camera)return Dialog.alert("Error","Camera is not available.","OK",-1).then(function(){return $q.reject()}),$q.reject();service.isOpen=!0;var deferred=$q.defer(),localWidth=void 0===width?1200:width,localHeight=void 0===height?1200:height,localQuality=void 0===quality?90:quality,sourceType=Camera.PictureSourceType.CAMERA,_buttons=[{text:$translate.instant("Import from Library")}];return DEVICE_TYPE!==SB.DEVICE.TYPE_BROWSER&&_buttons.unshift({text:$translate.instant("Take a picture")}),service.sheetResolver=$ionicActionSheet.show({buttons:_buttons,cancelText:$translate.instant("Cancel"),cancel:function(){service.sheetResolver(),deferred.reject({message:$translate.instant("Cancelled")}),service.isOpen=!1},buttonClicked:function(index){0===index&&(sourceType=Camera.PictureSourceType.CAMERA),1===index&&(sourceType=Camera.PictureSourceType.PHOTOLIBRARY);var options={quality:localQuality,destinationType:Camera.DestinationType.DATA_URL,sourceType:sourceType,encodingType:Camera.EncodingType.JPEG,targetWidth:localWidth,targetHeight:localHeight,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};if(DEVICE_TYPE===SB.DEVICE.TYPE_BROWSER){var input=angular.element('<input type="file" accept="image/*">'),selectedFile=function(selectEvent){var file=selectEvent.currentTarget.files[0],reader=new FileReader;reader.onload=function(onloadEvent){input.off("change",selectedFile),onloadEvent.target.result.length>0?(service.sheetResolver(),deferred.resolve({image:onloadEvent.target.result}),service.isOpen=!1):(service.sheetResolver(),service.isOpen=!1)},reader.onerror=function(onerrorEvent){service.sheetResolver(),Dialog.alert("Error","An error occurred while loading the picture.","OK",-1).then(function(){service.isOpen=!1})},reader.readAsDataURL(file)};document.body._onfocus=document.body.onfocus,document.body.onfocus=function(filePickerClosed){service.isOpen=!1,document.body.onfocus=document.body._onfocus},input.on("change",selectedFile),input[0].click()}else $cordovaCamera.getPicture(options).then(function(imageData){service.sheetResolver(),deferred.resolve({image:"data:image/jpeg;base64,"+imageData}),service.isOpen=!1},function(error){service.sheetResolver(),Dialog.alert("Error","An error occurred while taking a picture.","OK",-1).then(function(){service.isOpen=!1}),deferred.reject({message:error})}).catch(function(error){service.sheetResolver(),Dialog.alert("Error","An error occurred while taking a picture.","OK",-1).then(function(){service.isOpen=!1}),deferred.reject({message:error})});return!0}}),deferred.promise}};return service}),angular.module("starter").service("Popover",function($rootScope,$ionicPopover,$timeout,$q){var service={isOpen:!1,stack:[],currentPopover:null,popoverHiddenSubscriber:null};return $rootScope.$on("popover.shown",function(){service.isOpen=!0,service.popoverHiddenSubscriber=$rootScope.$on("popover.hidden",function(){service.popoverHiddenSubscriber(),service.currentPopover.remove(),service.currentPopover=null,service.isOpen=!1,service.unStack()})}),service.unStack=function(){service.stack.length>=1?$timeout(function(){var popover=service.stack.shift();switch(popover.type){case"fromTemplateUrl":service.renderFromTemplateUrl(popover.data);break;case"fromTemplate":service.renderFromTemplate(popover.data)}},1):(service.currentPopover=null,$timeout(function(){},1))},service.fromTemplateUrl=function(templateUrl,config){var deferred=$q.defer();return service.stack.push({type:"fromTemplateUrl",data:{templateUrl:templateUrl,config:config,promise:deferred}}),1!==service.stack.length||service.isOpen||service.unStack(),deferred.promise},service.renderFromTemplateUrl=function(data){return $ionicPopover.fromTemplateUrl(data.templateUrl,data.config).then(function(popover){service.currentPopover=popover,data.promise.resolve(popover)})},service.fromTemplate=function(template,config){var deferred=$q.defer();return service.stack.push({type:"fromTemplate",data:{template:template,config:config,promise:deferred}}),1!==service.stack.length||service.isOpen||service.unStack(),deferred.promise},service.renderFromTemplate=function(data){return $ionicPopover.fromTemplate(data.template,data.config).then(function(popover){service.currentPopover=popover,data.promise.resolve(popover)})},service}),angular.module("starter").service("ProgressbarService",function($ocLazyLoad){var service={config:{trail:"#eee",bar_text:"#aaa"},progress_bar:null,init:function(config){return service.config=config,$ocLazyLoad.load("./dist/lazy/progressbar.min.js")},createCircle:function(container){service.progress_bar=new ProgressBar.Circle(container,{color:service.config.bar_text,strokeWidth:2.6,trailWidth:2,trailColor:service.config.trail,easing:"easeInOut",duration:1e3,text:{autoStyleContainer:!1},from:{color:service.config.bar_text,width:2.6},to:{color:service.config.bar_text,width:2.6},step:function(state,circle){circle.path.setAttribute("stroke",state.color),circle.path.setAttribute("stroke-width",state.width);var value=Math.round(100*circle.value());0===value?circle.setText(""):circle.setText(value)}})},updateProgress:function(progress){null!==service.progress_bar&&service.progress_bar.animate(progress)},remove:function(){null!==service.progress_bar&&(service.progress_bar.destroy(),service.progress_bar=null)}};return service}),angular.module("starter").service("PushService",function($cordovaLocalNotification,$location,$log,$q,$rootScope,$translate,$window,$session,Application,Dialog,LinkService,Pages,Push,SB){var service={push:null,isReady:null,isReadyPromise:null,settings:{android:{senderID:"01234567890",icon:"ic_icon",iconColor:"#0099C7",sound:!0,vibrate:!0},ios:{clearBadge:!0,alert:!0,badge:!0,sound:!0},windows:{}},configure:function(senderID,iconColor){Push.device_type!==SB.DEVICE.TYPE_ANDROID||"01234567890"!==senderID&&""!==senderID?service.settings.android.senderID=senderID:($log.debug("Invalid senderId: "+senderID),service.settings.android.senderID=null),/^#[0-9A-F]{6}$/i.test(iconColor)?service.settings.android.iconColor=iconColor:$log.debug("Invalid iconColor: "+iconColor)},init:function(){$window.PushNotification&&(service.push=$window.PushNotification.init(service.settings))},isRegistered:function(){var type;return SB.DEVICE.TYPE_ANDROID===DEVICE_TYPE&&(type="android"),SB.DEVICE.TYPE_IOS===DEVICE_TYPE&&(type="ios"),Push.isRegistered({type:type})},register:function(){service.isReady=$q.defer(),service.isReadyPromise=service.isReady.promise,service.init(),service.push&&$rootScope.isNativeApp?(service.push.on("registration",function(data){console.log("[Push] device_token: ",data.registrationId),Push.device_token=data.registrationId,service.registerDevice(),service.isReady.resolve()}),service.onNotificationReceived(),service.push.on("error",function(error){console.error("[Push]",error),service.isRegistered().then(function(success){service.isReady.resolve()},function(error){service.isReady.reject(),Dialog.alert("Push registration failed",error.message,"OK",-1)})}),service.updateUnreadCount(),Application.loaded.then(function(){service.fetchMessagesOnStart(),$rootScope.$on(SB.EVENTS.PUSH.notificationReceived,function(event,data){var pushFeature=_.filter(Pages.getActivePages(),function(page){return"push_notification"===page.code});pushFeature.length>=1&&(Push.setValueId(pushFeature[0].value_id),Push.findAll(0,!0)),service.displayNotification(data)})})):($log.debug("Unable to initialize push service."),service.isReady.reject()),$rootScope.isNativeApp||(Application.loaded.then(function(){service.fetchMessagesOnStart()}),service.isReady.reject())},registerDevice:function(){return Push.device_type===SB.DEVICE.TYPE_ANDROID?service.registerAndroid():Push.device_type===SB.DEVICE.TYPE_IOS?service.registerIos():$q.reject("Unsupported device type for Push")},registerAndroid:function(){var params={app_id:Application.app_id,app_name:Application.app_name,registration_id:btoa(Push.device_token)};return Push.registerAndroidDevice(params)},registerIos:function(){var deviceName=null;try{deviceName=device.platform}catch(e){$log.debug(e.message)}var deviceModel=null;try{deviceModel=device.model}catch(e){$log.debug(e.message)}var deviceVersion=null;try{deviceVersion=device.version}catch(e){$log.debug(e.message)}var params={app_id:Application.app_id,app_name:Application.app_name,device_token:Push.device_token,device_name:deviceName,device_model:deviceModel,device_version:deviceVersion,push_badge:"enabled",push_alert:"enabled",push_sound:"enabled"};return Push.registerIosDevice(params)},onNotificationReceived:function(){service.push.on("notification",function(data){$rootScope.$broadcast(SB.EVENTS.PUSH.notificationReceived,data),service.push.finish(function(){$log.debug("push finish success")},function(){$log.debug("push finish error")})})},updateUnreadCount:function(){Push.updateUnreadCount().then(function(data){Push.unread_count=data.unread_count,$rootScope.$broadcast(SB.EVENTS.PUSH.unreadPush)})},sendLocalNotification:function(messageId,title,message){$log.debug("-- Push-Service, sending a Local Notification --");var localMessage=angular.copy(message);Push.device_type===SB.DEVICE.TYPE_IOS&&(localMessage="");var params={id:messageId,title:title,text:localMessage};Push.device_type===SB.DEVICE.TYPE_ANDROID&&(params.icon="res://icon.png");try{$cordovaLocalNotification.schedule(angular.extend(params,{sound:DEVICE_TYPE===SB.DEVICE.TYPE_IOS?"res://Sounds/sb_beep2.caf":"res://sb_beep2.mp3"}))}catch(e){$cordovaLocalNotification.schedule(params)}Push.markAsDisplayed(messageId)},fetchMessagesOnStart:function(){Push.getLastMessages(!1).then(function(data){var push=data.push_message;push&&service.displayNotification(push);var inappMessage=data.inapp_message;inappMessage&&(inappMessage.type="inapp",inappMessage.message=inappMessage.text,inappMessage.config={buttons:[{text:$translate.instant("OK"),type:"button-custom",onTap:function(){Push.markInAppAsRead()}}]},null!==inappMessage.cover&&void 0===inappMessage.additionalData&&(inappMessage.additionalData={cover:inappMessage.cover}),service.displayNotification(inappMessage))})},displayNotification:function(messagePayload){$log.debug("PUSH messagePayload",messagePayload),$session.getItem("pushMessageIds").then(function(pushMessageIds){var localPushMessageIds=pushMessageIds;null!==pushMessageIds&&Array.isArray(pushMessageIds)||(localPushMessageIds=[]);var messageId=parseInt(messagePayload.additionalData.message_id,10);if(-1===localPushMessageIds.indexOf(messageId)){localPushMessageIds.push(messageId),$session.setItem("pushMessageIds",localPushMessageIds);var extendedPayload=messagePayload.additionalData;if(void 0!==extendedPayload&&(extendedPayload.cover||extendedPayload.action_value)){var coverUri=extendedPayload.cover;try{0!==coverUri.indexOf("http")&&(coverUri=DOMAIN+extendedPayload.cover)}catch(e){}var isInAppMessage=void 0!==messagePayload.type&&"inapp"===messagePayload.type,config={buttons:[{text:$translate.instant("Cancel"),type:"button-custom",onTap:function(){isInAppMessage&&Push.markInAppAsRead()}},{text:$translate.instant("View"),type:"button-custom",onTap:function(){isInAppMessage&&Push.markInAppAsRead(),!0!==extendedPayload.open_webview&&"true"!==extendedPayload.open_webview?$location.path(extendedPayload.action_value):LinkService.openLink(extendedPayload.action_value,{},!1)}}],cssClass:"push-popup",title:messagePayload.title,template:'<img src="#COVER_URI#" class="#KLASS#"><span>#MESSAGE#</span>'.replace("#COVER_URI#",coverUri).replace("#KLASS#",extendedPayload.cover?"":" ng-hide").replace("#MESSAGE#",messagePayload.message)},trimmedTitle=messagePayload.title.trim(),trimmedMessage=messagePayload.message.trim();0===trimmedTitle.length&&0===trimmedMessage.length?$log.debug("Silent push (empty title, message)",messagePayload):!0===extendedPayload.isSilent?$log.debug("Silent push (forced silent)",messagePayload):(void 0!==messagePayload.config&&(config=angular.extend(config,messagePayload.config)),void 0!==extendedPayload.action_value&&""!==extendedPayload.action_value&&null!==extendedPayload.action_value||(config.buttons=[{text:$translate.instant("OK"),type:"button-custom",onTap:function(){}}]),$log.debug("Message payload (ionicPopup):",messagePayload,config),Dialog.ionicPopup(config))}else{var otherTrimmedTitle=messagePayload.title.trim(),otherTrimmedMessage=messagePayload.message.trim();if(0===otherTrimmedTitle.length&&0===otherTrimmedMessage.length)$log.debug("Silent push (empty title, message)",messagePayload);else{var localTitle=void 0!==messagePayload.title?messagePayload.title:"Notification";$log.debug("Message payload (alert):",messagePayload),Dialog.alert(localTitle,messagePayload.message,"OK")}}$rootScope.$broadcast(SB.EVENTS.PUSH.unreadPushs,messagePayload.count)}$log.debug("Will not display duplicated message: ",messagePayload)}).catch(function(err){$log.debug("We got an error with the localForage when trying to display push message: ",messagePayload),$log.debug(err)})}};return window.pushService=service,service}),angular.module("starter").service("$session",function($log,$pwaCache,$q,$window){$log.debug("Init once $session");var service={localstorage_key:"sb-auth-token",session_id:!1,device_uid:null,device_width:512,device_height:512,device_orientation:"portrait",is_loaded:!1,resolver:$q.defer()};return Object.defineProperty(service,"loaded",{get:function(){return service.is_loaded?$q.resolve():service.resolver.promise},set:function(value){service.is_loaded=!!value,!0===service.is_loaded&&service.resolver.resolve()}}),service.setId=function(sessionId){"undefined"!==sessionId&&void 0!==sessionId&&"null"!==sessionId&&null!==sessionId&&""!==sessionId?(service.session_id=sessionId,service.setItem(service.localstorage_key,sessionId),$window.localStorage.setItem(service.localstorage_key,sessionId),service.setDeviceUid()):$log.error("Not saving invalid session_id: ",sessionId)},service.getId=function(){return"undefined"!==service.session_id&&void 0!==service.session_id&&"null"!==service.session_id&&null!==service.session_id&&""!==service.session_id&&service.session_id},service.setDeviceUid=function(){void 0===$window.device?service.device_uid="unknown_"+service.getId():"browser"===$window.device.platform?service.device_uid="browser_"+service.getId():service.device_uid=$window.device.uuid,'""'!==service.device_uid&&void 0!==service.device_uid||(service.device_uid="unknown_"+service.getId())},service.getDeviceUid=function(){return service.device_uid},service.clear=function(){service.session_id="",service.removeItem(service.localstorage_key)},service.setDeviceScreen=function(width,height){var orientation=$window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape";return service.device_width=width,service.device_height=height,service.device_orientation=orientation,service.getDeviceScreen()},service.getDeviceScreen=function(){return{width:service.device_width,height:service.device_height,orientation:service.device_orientation}},service.setItem=function(key,value){return $pwaCache.getRegistryCache().setItem(key,value)},service.getItem=function(key){return $pwaCache.getRegistryCache().getItem(key)},service.removeItem=function(key){return $pwaCache.getRegistryCache().removeItem(key)},service.setDeviceScreen($window.innerWidth,$window.innerHeight),service.getItem(service.localstorage_key).then(function(value){var fallback=$window.localStorage.getItem(service.localstorage_key);null!=value?($log.debug("Set once $session from pwaRegistry on start: ",value),service.setId(value)):null!=fallback&&($log.debug("Set once $session from fallback localstorage on start: ",fallback),service.setId(fallback)),null===service.device_uid&&service.setDeviceUid(),service.loaded=!0}),service}),angular.module("starter").service("SocialSharing",function($cordovaSocialSharing,$translate,$q,Application){var service={is_sharing:!1,share:function(content,message,subject,link,file){if(service.is_sharing)return $q.reject();service.is_sharing=!0,void 0===content&&(content="this");var download_app_link=DOMAIN+"/application/device/downloadapp/app_id/"+Application.app_id,generic_message=$translate.instant("Hi. I just found $1 in the $2 app.").replace("$1",content).replace("$2",Application.app_name);void 0!==message&&(message=$translate.instant(message).replace("$1",content).replace("$2",Application.app_name));var _link=void 0===link?download_app_link:link,_file=void 0===file?"":file,_message=void 0===message?generic_message:message,_subject=void 0===subject?"":subject,deferred=$q.defer();return $cordovaSocialSharing.share(_message,_subject,_file,_link).then(function(result){deferred.resolve(result),service.is_sharing=!1},function(error){deferred.reject(error),service.is_sharing=!1}),deferred.promise}};return service}),angular.module("starter").service("$translate",function($injector){var service={translations:[],extractBulk:[],instant:function(text,context){service.debugExtract(text,context);var translated=text;return void 0===context?(service.translations.hasOwnProperty(text)&&(translated=service.translations[text]),translated):(service.translations.hasOwnProperty("_context")&&service.translations._context.hasOwnProperty(context)&&service.translations._context[context].hasOwnProperty(text)?translated=service.translations._context[context][text]:service.translations.hasOwnProperty(text)&&(translated=service.translations[text]),translated)},debugExtract:function(text,context){try{if(!0===window.extractI18n){if(void 0===context)return;var _t=btoa(text),_c=void 0===context?"":btoa(context);service.extractBulk.push({text:_t,context:_c})}}catch(e){}},debugPost:function(){$injector.get("$pwaRequest").post("/translation/extract/index",{data:service.extractBulk,cache:!1}).then(function(){service.extractBulk=[]})}};return window.debugPost=service.debugPost,service}),angular.module("starter").service("Url",function($location){this.__sanitize=function(str){return str.startsWith("/")&&(str=str.substr(1,str.length-1)),str};var _that=this;return{get:function(uri,params){angular.isDefined(params)||(params={});var add_language=params.add_language;delete params.add_language;var remove_key=params.remove_key;delete params.remove_key,uri=_that.__sanitize(uri);var url=DOMAIN.split("/");for(var i in add_language&&url.push(CURRENT_LANGUAGE),APP_KEY&&!remove_key&&url.push(APP_KEY),url.push(uri),params)angular.isDefined(params[i])&&(url.push(i),url.push(params[i]));return url=url.join("/")},build:function(uri,params){angular.isDefined(params)||(params={});var url=_that.__sanitize(uri),p=[];for(var i in params)angular.isDefined(params[i])&&p.push(i+"="+params[i]);return url=url+"?"+p.join("&")}}}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(str){return this.substring(0,str.length)===str}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(str){return this.substring(this.length-str.length,this.length)===str}),angular.module("starter").service("YouTubeAutoPauser",function($ionicPlatform,$window){var iframes=[],players=[],initialized=!1,loaded=!1,service={};return service.register=function(iframe){var localIframe=angular.element(iframe)[0];loaded?players.push(new YT.Player(localIframe,{})):(initialized||function(){initialized=!0,$window.onYouTubeIframeAPIReady=function(){loaded=!0,players=players.concat(iframes.map(function(iframe){return new YT.Player(iframe,{})})),$ionicPlatform.on("pause",function(result){var filtered_players=[];players.forEach(function(item){angular.isObject(item)&&angular.isFunction(item.pauseVideo)&&angular.isObject(item.a)&&angular.isObject(item.a.parentElement)&&(item.pauseVideo(),filtered_players.push(item))}),players=filtered_players})};var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}(),iframes.push(localIframe))},service});